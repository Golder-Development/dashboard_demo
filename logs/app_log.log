2025/03/04 02:16:05 PM INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 02:16:05 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\utils',), kwargs={}
2025/03/04 02:16:06 PM INFO:get_git_version executed successfully
2025/03/04 02:16:07 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\data',), kwargs={}
2025/03/04 02:16:07 PM INFO:get_git_version executed successfully
2025/03/04 02:16:07 PM INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 02:16:07 PM INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 02:16:07 PM INFO:Running App setup...
2025/03/04 02:16:07 PM INFO:Running App setup...
2025/03/04 02:16:07 PM DEBUG:Calling setup_package with args=(), kwargs={}
2025/03/04 02:16:07 PM DEBUG:Calling setup_package with args=(), kwargs={}
2025/03/04 02:16:07 PM INFO:Setting up the package
2025/03/04 02:16:07 PM INFO:Setting up the package
2025/03/04 02:16:07 PM INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 02:16:07 PM INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 02:16:07 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1',), kwargs={}
2025/03/04 02:16:07 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1',), kwargs={}
2025/03/04 02:16:07 PM INFO:get_git_version executed successfully
2025/03/04 02:16:07 PM INFO:get_git_version executed successfully
2025/03/04 02:16:07 PM INFO:Version: v20.143
2025/03/04 02:16:07 PM INFO:Version: v20.143
2025/03/04 02:16:07 PM DEBUG:Calling initialize_session_state with args=(), kwargs={}
2025/03/04 02:16:07 PM DEBUG:Calling initialize_session_state with args=(), kwargs={}
2025/03/04 02:16:07 PM INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:16:07 PM INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:16:07 PM DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 02:16:07 PM DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 02:16:07 PM DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 02:16:07 PM DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 02:16:07 PM DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:16:07 PM DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:16:07 PM DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 02:16:07 PM DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 02:16:07 PM DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 02:16:07 PM DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 02:16:07 PM DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:16:07 PM DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:16:07 PM DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:16:07 PM DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:16:07 PM DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:16:07 PM DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:16:07 PM DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:16:07 PM DEBUG:Initialised perc_target with value: 0.5
2025/03/04 02:16:07 PM DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:16:07 PM DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 02:16:07 PM DEBUG:Initialised perc_target with value: 0.5
2025/03/04 02:16:07 PM DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:16:07 PM DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 02:16:07 PM DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:16:07 PM DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 02:16:07 PM DEBUG:Initialised data_dir with value: data
2025/03/04 02:16:07 PM DEBUG:Initialised output_dir with value: output
2025/03/04 02:16:07 PM DEBUG:Initialised logs_dir with value: logs
2025/03/04 02:16:07 PM DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 02:16:07 PM DEBUG:Initialised components_dir with value: components
2025/03/04 02:16:07 PM DEBUG:Initialised data_dir with value: data
2025/03/04 02:16:07 PM DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 02:16:07 PM DEBUG:Initialised output_dir with value: output
2025/03/04 02:16:07 PM DEBUG:Initialised utils_dir with value: utils
2025/03/04 02:16:07 PM DEBUG:Initialised logs_dir with value: logs
2025/03/04 02:16:07 PM DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:16:07 PM DEBUG:Initialised components_dir with value: components
2025/03/04 02:16:07 PM DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:16:07 PM DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 02:16:07 PM DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 02:16:07 PM DEBUG:Initialised utils_dir with value: utils
2025/03/04 02:16:07 PM DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:16:07 PM DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:16:07 PM DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:16:07 PM DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:16:07 PM DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:16:07 PM DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 02:16:07 PM DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 02:16:07 PM DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:16:07 PM DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 02:16:07 PM DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:16:07 PM DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 02:16:07 PM DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:16:07 PM DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 02:16:07 PM DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 02:16:07 PM DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 02:16:07 PM DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 02:16:07 PM DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 02:16:07 PM DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 02:16:07 PM DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 02:16:07 PM DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 02:16:07 PM DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 02:16:07 PM DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 02:16:07 PM DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 02:16:07 PM DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 02:16:07 PM DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 02:16:07 PM DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:16:07 PM DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 02:16:07 PM DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 02:16:07 PM DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 02:16:07 PM INFO:Session_state variables initialized
2025/03/04 02:16:07 PM DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 02:16:07 PM DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 02:16:07 PM DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 02:16:07 PM DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 02:16:07 PM DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:16:07 PM DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 02:16:07 PM DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 02:16:07 PM DEBUG:components_dir: components
2025/03/04 02:16:07 PM INFO:Session_state variables initialized
2025/03/04 02:16:07 PM DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:16:07 PM DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 02:16:07 PM DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:16:07 PM DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 02:16:07 PM DEBUG:output_dir: output
2025/03/04 02:16:07 PM DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 02:16:07 PM DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:16:07 PM DEBUG:components_dir: components
2025/03/04 02:16:07 PM DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 02:16:07 PM DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:16:07 PM DEBUG:logs_dir: logs
2025/03/04 02:16:07 PM DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:16:07 PM DEBUG:utils_dir: utils
2025/03/04 02:16:07 PM DEBUG:output_dir: output
2025/03/04 02:16:07 PM DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 02:16:07 PM DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:16:07 PM DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 02:16:07 PM DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 02:16:07 PM DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 02:16:07 PM DEBUG:logs_dir: logs
2025/03/04 02:16:07 PM DEBUG:LOG_LEVEL: ERROR
2025/03/04 02:16:07 PM DEBUG:utils_dir: utils
2025/03/04 02:16:07 PM DEBUG:perc_target: 0.5
2025/03/04 02:16:07 PM DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 02:16:07 PM DEBUG:reference_dir: reference_files
2025/03/04 02:16:07 PM DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 02:16:07 PM DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 02:16:07 PM DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 02:16:07 PM DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:16:07 PM DEBUG:LOG_LEVEL: ERROR
2025/03/04 02:16:07 PM DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 02:16:07 PM DEBUG:perc_target: 0.5
2025/03/04 02:16:07 PM DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:16:07 PM DEBUG:reference_dir: reference_files
2025/03/04 02:16:07 PM DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:16:07 PM DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 02:16:07 PM DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:16:07 PM DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:16:07 PM DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:16:07 PM DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 02:16:07 PM DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 02:16:07 PM DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 02:16:07 PM DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:16:07 PM DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 02:16:07 PM DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:16:07 PM DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:16:07 PM DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:16:07 PM DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:16:07 PM DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 02:16:07 PM DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:16:07 PM DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 02:16:07 PM DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 02:16:07 PM DEBUG:app_pages_dir: app_pages
2025/03/04 02:16:07 PM DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 02:16:07 PM DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:16:07 PM DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 02:16:07 PM DEBUG:data_dir: data
2025/03/04 02:16:07 PM DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:16:07 PM DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:16:07 PM DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:16:07 PM INFO:Session state Setup complete
2025/03/04 02:16:07 PM INFO:initialize_session_state executed successfully
2025/03/04 02:16:07 PM DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:16:07 PM INFO:Package setup complete
2025/03/04 02:16:07 PM DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:16:07 PM INFO:setup_package executed successfully
2025/03/04 02:16:07 PM DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 02:16:07 PM DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 02:16:07 PM INFO:Running Menu setup...
2025/03/04 02:16:07 PM DEBUG:app_pages_dir: app_pages
2025/03/04 02:16:07 PM DEBUG:Calling pagesetup with args=(), kwargs={}
2025/03/04 02:16:07 PM DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:16:07 PM DEBUG:data_dir: data
2025/03/04 02:16:07 PM DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:16:07 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\app_pages',), kwargs={}
2025/03/04 02:16:07 PM DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:16:07 PM DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:16:07 PM INFO:Session state Setup complete
2025/03/04 02:16:07 PM INFO:initialize_session_state executed successfully
2025/03/04 02:16:07 PM INFO:Package setup complete
2025/03/04 02:16:07 PM INFO:setup_package executed successfully
2025/03/04 02:16:07 PM INFO:Running Menu setup...
2025/03/04 02:16:07 PM DEBUG:Calling pagesetup with args=(), kwargs={}
2025/03/04 02:16:07 PM INFO:get_git_version executed successfully
2025/03/04 02:16:07 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\components',), kwargs={}
2025/03/04 02:16:07 PM INFO:get_git_version executed successfully
2025/03/04 02:16:07 PM DEBUG:Calling get_git_version with args=(), kwargs={}
2025/03/04 02:16:07 PM DEBUG:Calling get_git_version with args=(), kwargs={}
2025/03/04 02:16:07 PM INFO:get_git_version executed successfully
2025/03/04 02:16:07 PM INFO:get_git_version executed successfully
2025/03/04 02:16:07 PM INFO:App Version: v20.164
2025/03/04 02:16:07 PM INFO:App Version: v20.164
2025/03/04 02:16:07 PM INFO:Switched to page: Head Line Figures
2025/03/04 02:16:07 PM INFO:Switched to page: Introduction
2025/03/04 02:16:07 PM DEBUG:Calling hlf_body with args=(), kwargs={}
2025/03/04 02:16:07 PM DEBUG:Calling load_and_filter_data with args=(), kwargs={'filter_key': None, 'pagereflabel': 'headlinefigures'}
2025/03/04 02:16:07 PM ERROR:Error in load_and_filter_data: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 452, in __getitem__
    return self._getitem(widget_id, key)
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 497, in _getitem
    raise KeyError
KeyError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 130, in __getattr__
    return self[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 101, in __getitem__
    return get_session_state()[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\safe_session_state.py", line 96, in __getitem__
    return self._state[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 454, in __getitem__
    raise KeyError(_missing_key_error_message(key))
KeyError: 'st.session_state has no key "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 33, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\components\modular_page_blocks.py", line 23, in load_and_filter_data
    cleaned_df = st.session_state.data_clean
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 132, in __getattr__
    raise AttributeError(_missing_attr_error_message(key))
AttributeError: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
2025/03/04 02:16:07 PM INFO:pagesetup executed successfully
2025/03/04 02:16:07 PM ERROR:Error in hlf_body: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 452, in __getitem__
    return self._getitem(widget_id, key)
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 497, in _getitem
    raise KeyError
KeyError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 130, in __getattr__
    return self[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 101, in __getitem__
    return get_session_state()[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\safe_session_state.py", line 96, in __getitem__
    return self._state[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 454, in __getitem__
    raise KeyError(_missing_key_error_message(key))
KeyError: 'st.session_state has no key "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 33, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\app_pages\headlinefigures.py", line 27, in hlf_body
    load_and_filter_data(filter_key=filter_key,
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 39, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 33, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\components\modular_page_blocks.py", line 23, in load_and_filter_data
    cleaned_df = st.session_state.data_clean
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 132, in __getattr__
    raise AttributeError(_missing_attr_error_message(key))
AttributeError: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
2025/03/04 02:16:08 PM ERROR:Error in pagesetup: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 452, in __getitem__
    return self._getitem(widget_id, key)
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 497, in _getitem
    raise KeyError
KeyError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 130, in __getattr__
    return self[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 101, in __getitem__
    return get_session_state()[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\safe_session_state.py", line 96, in __getitem__
    return self._state[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 454, in __getitem__
    raise KeyError(_missing_key_error_message(key))
KeyError: 'st.session_state has no key "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 33, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\politicalpartyanalysis.py", line 73, in pagesetup
    app.run()  # Run the  app
  File "H:\VScode\dashboard_demo-1\app_pages\multi_page.py", line 47, in run
    page["function"]()  # Run the selected page's function
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 39, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 33, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\app_pages\headlinefigures.py", line 27, in hlf_body
    load_and_filter_data(filter_key=filter_key,
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 39, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 33, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\components\modular_page_blocks.py", line 23, in load_and_filter_data
    cleaned_df = st.session_state.data_clean
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 132, in __getattr__
    raise AttributeError(_missing_attr_error_message(key))
AttributeError: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
2025/03/04 02:16:08 PM INFO:No data found in session state, running firstload()
2025/03/04 02:16:08 PM CRITICAL:Menu setup crashed: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 452, in __getitem__
    return self._getitem(widget_id, key)
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 497, in _getitem
    raise KeyError
KeyError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 130, in __getattr__
    return self[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 101, in __getitem__
    return get_session_state()[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\safe_session_state.py", line 96, in __getitem__
    return self._state[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 454, in __getitem__
    raise KeyError(_missing_key_error_message(key))
KeyError: 'st.session_state has no key "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py", line 46, in <module>
    politicalpartyanalysis.pagesetup()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 39, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 33, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\politicalpartyanalysis.py", line 73, in pagesetup
    app.run()  # Run the  app
  File "H:\VScode\dashboard_demo-1\app_pages\multi_page.py", line 47, in run
    page["function"]()  # Run the selected page's function
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 39, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 33, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\app_pages\headlinefigures.py", line 27, in hlf_body
    load_and_filter_data(filter_key=filter_key,
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 39, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 33, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\components\modular_page_blocks.py", line 23, in load_and_filter_data
    cleaned_df = st.session_state.data_clean
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 132, in __getattr__
    raise AttributeError(_missing_attr_error_message(key))
AttributeError: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
2025/03/04 02:16:08 PM DEBUG:Calling initialise_data with args=(), kwargs={}
2025/03/04 02:16:08 PM INFO:Running first load function.
2025/03/04 02:16:08 PM DEBUG:Calling firstload with args=(), kwargs={}
2025/03/04 02:16:08 PM DEBUG:Calling load_data_to_session with args=('raw_data', <function get_raw_data at 0x000001F84CE54940>), kwargs={}
2025/03/04 02:16:08 PM DEBUG:Calling get_raw_data with args=(), kwargs={}
2025/03/04 02:16:08 PM DEBUG:Calling load_raw_data with args=(), kwargs={'main_file': 'raw_data', 'cleaned_file': 'raw_data_clean', 'output_csv': True, 'dedupe_donors': True, 'dedupe_regentity': True, 'originaldatafilepath': 'source_data_fname', 'processeddatafilepath': 'imported_raw_fname'}
2025/03/04 02:16:08 PM DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 02:16:08 PM DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 02:16:08 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'output\\imported_raw.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:16:08 PM INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:16:08 PM INFO:Saved file path: output\imported_raw.csv
2025/03/04 02:16:08 PM DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:16:08 PM INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:16:08 PM DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:16:08 PM INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:16:08 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:16:08 PM INFO:Current modification time: 1740757862.6744745
2025/03/04 02:16:08 PM INFO:Last modification time: None
2025/03/04 02:16:08 PM INFO:is_file_updated executed successfully
2025/03/04 02:16:08 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:16:08 PM INFO:Loading raw data...
2025/03/04 02:16:08 PM DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 02:16:08 PM DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 02:16:08 PM INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 02:16:09 PM INFO:Data saved to output\imported_raw.csv
2025/03/04 02:16:09 PM DEBUG:Calling raw_data_cleanup with args=(), kwargs={'loaddata_df':            ECRef              RegulatedEntityName    RegulatedEntityType        Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                  ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    £1,876.56   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    £2,700.00   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    £4,852.58   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    £2,500.00   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    £4,524.05   29/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
...          ...                              ...                    ...          ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   £10,000.00          NaN                NaN  ...              3945              NaN  74198.0             NaN            NaN         False
65274   C0242461               Vote Leave Limited  Permitted Participant  £100,000.00          NaN                NaN  ...              3945              NaN  74184.0             NaN            NaN         False
65275   C0243560               Vote Leave Limited  Permitted Participant   £40,000.00          NaN                NaN  ...              3945              NaN  74576.0             NaN            NaN         False
65276   C0319710  Conservative and Unionist Party        Political Party   £50,000.00          NaN      Central Party  ...                52              NaN  34241.0             NaN  Great Britain         False
65277   C0319727  Conservative and Unionist Party        Political Party   £15,000.00          NaN      Central Party  ...                52              NaN  74743.0             NaN  Great Britain         False

[65278 rows x 29 columns], 'dedupe_donors': True, 'dedupe_regentity': True, 'output_csv': True, 'originaldatafilepath': 'output\\imported_raw.csv', 'processeddatafilepath': 'cleaned_donations_fname'}
2025/03/04 02:16:09 PM INFO:Cleaning up raw data
2025/03/04 02:16:09 PM ERROR:Session state variables not initialized!
2025/03/04 02:16:09 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': None, 'savedfilepath': 'output\\cleaned_donations.csv', 'timestamp_key': 'cleaned_raw_data_last_modified'}
2025/03/04 02:16:09 PM INFO:Original file path: None
2025/03/04 02:16:09 PM INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 02:16:09 PM ERROR:Error: originalfilepath is None!
2025/03/04 02:16:09 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:16:09 PM INFO:Data loaded, shape: (65278, 29)
2025/03/04 02:16:10 PM DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns], 'entity': 'RegulatedEntity', 'map_filename': 'regentity_map_fname', 'output_csv': True}
2025/03/04 02:16:10 PM INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 02:16:10 PM INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:16:10 PM DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:16:10 PM INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 02:16:10 PM INFO:dedupe_entity_file executed successfully
2025/03/04 02:16:11 PM DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...       CleanedRegulatedEntityName CleanedRegulatedEntityId RegulatedEntityId              RegulatedEntityName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                      Andy Street                   8015.0            8015.0                      Andy Street
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                      Andy Street                   8015.0            8015.0                      Andy Street
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                      Andy Street                   8015.0            8015.0                      Andy Street
...          ...                              ...                    ...        ...  ...                              ...                      ...               ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party

[65278 rows x 33 columns], 'entity': 'Donor', 'map_filename': 'donor_map_fname', 'output_csv': True}
2025/03/04 02:16:11 PM INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 02:16:11 PM INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 02:16:11 PM DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 02:16:11 PM INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 02:16:11 PM INFO:dedupe_entity_file executed successfully
2025/03/04 02:16:11 PM INFO:Raw Data cleanup completed
2025/03/04 02:16:11 PM INFO:Data shape: (65278, 37)
2025/03/04 02:16:12 PM INFO:Data saved to output\cleaned_donations.csv
2025/03/04 02:16:12 PM INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 02:16:12 PM INFO:raw_data_cleanup executed successfully
2025/03/04 02:16:12 PM INFO:load_raw_data executed successfully
2025/03/04 02:16:12 PM INFO:get_raw_data executed successfully
2025/03/04 02:16:12 PM INFO:load_data_to_session executed successfully
2025/03/04 02:16:12 PM DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:16:12 PM DEBUG:Calling load_data_to_session with args=('data_clean', <function get_cleaned_data at 0x000001F84CE54DC0>), kwargs={}
2025/03/04 02:16:12 PM DEBUG:Calling get_cleaned_data with args=(), kwargs={}
2025/03/04 02:16:12 PM DEBUG:Calling load_cleaned_data with args=(), kwargs={'originaldatafilepath': 'cleaned_donations_fname', 'processeddatafilepath': 'cleaned_data_fname', 'datafile': 'raw_data', 'streamlitrun': True, 'output_csv': True, 'main_file': 'raw_data', 'cleaned_file': 'data_clean'}
2025/03/04 02:16:12 PM DEBUG:Rows in Raw Data: 65278
2025/03/04 02:16:12 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_donations.csv', 'savedfilepath': 'output\\cleaned_data.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:16:12 PM INFO:Original file path: output\cleaned_donations.csv
2025/03/04 02:16:12 PM INFO:Saved file path: output\cleaned_data.csv
2025/03/04 02:16:12 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_donations.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:16:12 PM INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 02:16:12 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_donations.csv',), kwargs={}
2025/03/04 02:16:12 PM INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 02:16:12 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:16:12 PM INFO:Current modification time: 1741097772.5749083
2025/03/04 02:16:12 PM INFO:Last modification time: 1740757862.6744745
2025/03/04 02:16:12 PM INFO:is_file_updated executed successfully
2025/03/04 02:16:12 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:16:12 PM ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 02:16:12 PM INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 02:16:12 PM DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 02:16:13 PM DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 02:16:14 PM DEBUG:Calling map_mp_to_party with args=(           ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ...  DonorId                        DonorName EventCount YearReceived MonthReceived YearMonthReceived
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
...          ...                              ...                    ...        ...          ...                ...  ...      ...                              ...        ...          ...           ...               ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...  74198.0      Shaftesbury Investments Ltd          1         2016             4            201604
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...  74184.0                Mr Jeremy Hosking          1         2016             2            201602
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...  23556.0                    Anthony Clake          1         2016             6            201606
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...   2146.0                Mr Peter A Dubens          1         2017             5            201705
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...  74743.0                 Mr Ravi S Kailas          1         2017             5            201705

[65278 rows x 41 columns],), kwargs={}
2025/03/04 02:16:14 PM DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 02:16:14 PM DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 02:16:14 PM DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:16:14 PM DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 02:16:14 PM DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:16:14 PM ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 02:16:14 PM ERROR:Attempting to remove duplicates
2025/03/04 02:16:15 PM DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 02:16:15 PM DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 02:16:15 PM INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 02:16:15 PM INFO:map_mp_to_party executed successfully
2025/03/04 02:16:15 PM DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 02:16:15 PM DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 02:16:15 PM DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 02:16:15 PM DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 02:16:15 PM DEBUG:Calling load_election_dates with args=(), kwargs={}
2025/03/04 02:16:15 PM DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:16:15 PM DEBUG:try to load previous election dates from file.
2025/03/04 02:16:15 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'reference_files\\elections.csv', 'timestamp_key': 'election_dates_last_modified'}
2025/03/04 02:16:15 PM INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:16:15 PM INFO:Saved file path: reference_files\elections.csv
2025/03/04 02:16:15 PM DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'election_dates_last_modified'), kwargs={}
2025/03/04 02:16:15 PM INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:16:15 PM DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:16:15 PM INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:16:15 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:16:15 PM INFO:Current modification time: 1740757862.6744745
2025/03/04 02:16:15 PM INFO:Last modification time: None
2025/03/04 02:16:15 PM INFO:is_file_updated executed successfully
2025/03/04 02:16:15 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:16:15 PM ERROR:Failed to load election dates from file.
2025/03/04 02:16:15 PM INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 02:16:15 PM INFO:Election Dates loaded vis pdpy.
2025/03/04 02:16:15 PM DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 02:16:15 PM INFO:Election Dates Loaded Successfully.
2025/03/04 02:16:15 PM DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 02:16:15 PM DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 02:16:15 PM INFO:load_election_dates executed successfully
2025/03/04 02:16:35 PM DEBUG:Clean Data Prep 353: Election dates: 65278
2025/03/04 02:16:35 PM DEBUG:Clean Data Prep 386: End of clean: 65278
2025/03/04 02:16:36 PM INFO:Cleaned Data completed, shape: (65278, 55)
2025/03/04 02:16:36 PM INFO:load_cleaned_data executed successfully
2025/03/04 02:16:36 PM INFO:get_cleaned_data executed successfully
2025/03/04 02:16:36 PM INFO:load_data_to_session executed successfully
2025/03/04 02:16:36 PM DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:16:36 PM DEBUG:Calling load_data_to_session with args=('data_donor', <function get_donor_data at 0x000001F84CE54EE0>), kwargs={}
2025/03/04 02:16:36 PM DEBUG:Calling get_donor_data with args=(), kwargs={}
2025/03/04 02:16:36 PM DEBUG:Calling load_donorList_data with args=(), kwargs={'main_file': 'data_clean', 'cleaned_file': 'data_donor', 'streamlitrun': True, 'output_csv': True, 'originaldatafilepath': 'cleaned_data_fname', 'cleaneddatafilepath': 'cleaned_donorlist_fname'}
2025/03/04 02:16:36 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_data.csv', 'savedfilepath': 'output\\cleaned_donorlist.csv', 'timestamp_key': 'load_donorlist_data_last_modified'}
2025/03/04 02:16:36 PM INFO:Original file path: output\cleaned_data.csv
2025/03/04 02:16:36 PM INFO:Saved file path: output\cleaned_donorlist.csv
2025/03/04 02:16:36 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_data.csv', 'load_donorlist_data_last_modified'), kwargs={}
2025/03/04 02:16:36 PM INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 02:16:36 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_data.csv',), kwargs={}
2025/03/04 02:16:36 PM INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 02:16:36 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:16:36 PM INFO:Current modification time: 1741097796.514979
2025/03/04 02:16:36 PM INFO:Last modification time: None
2025/03/04 02:16:36 PM INFO:is_file_updated executed successfully
2025/03/04 02:16:36 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:16:36 PM INFO:Donor data saved to output\cleaned_donorlist.csv
2025/03/04 02:16:36 PM INFO:Donor Data summary completed
2025/03/04 02:16:36 PM INFO:Data shape: (25576, 5)
2025/03/04 02:16:36 PM INFO:load_donorList_data executed successfully
2025/03/04 02:16:36 PM INFO:get_donor_data executed successfully
2025/03/04 02:16:36 PM INFO:load_data_to_session executed successfully
2025/03/04 02:16:36 PM DEBUG:st.session_state.data_donor: 25576
2025/03/04 02:16:36 PM DEBUG:st.session_state.data_clean: 65278
2025/03/04 02:16:36 PM DEBUG:Calling load_data_to_session with args=('data_regentity', <function get_regentity_data at 0x000001F84CE55000>), kwargs={}
2025/03/04 02:16:36 PM DEBUG:Calling get_regentity_data with args=(), kwargs={}
2025/03/04 02:16:36 PM DEBUG:Calling load_regulated_entity_data with args=(), kwargs={'main_file': 'data_clean', 'cleaned_file': 'data_regentity', 'streamlitrun': True, 'output_csv': True, 'originaldatafilepath': 'cleaned_data_fname', 'cleaneddatafilepath': 'cleaned_regentity_fname'}
2025/03/04 02:16:36 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_data.csv', 'savedfilepath': 'output\\cleaned_regentity.csv', 'timestamp_key': 'load_donorlist_data_last_modified'}
2025/03/04 02:16:36 PM INFO:Original file path: output\cleaned_data.csv
2025/03/04 02:16:36 PM INFO:Saved file path: output\cleaned_regentity.csv
2025/03/04 02:16:36 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_data.csv', 'load_donorlist_data_last_modified'), kwargs={}
2025/03/04 02:16:36 PM INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 02:16:36 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_data.csv',), kwargs={}
2025/03/04 02:16:36 PM INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 02:16:36 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:16:36 PM INFO:Current modification time: 1741097796.514979
2025/03/04 02:16:36 PM INFO:Last modification time: 1741097796.514979
2025/03/04 02:16:36 PM INFO:is_file_updated executed successfully
2025/03/04 02:16:36 PM INFO:Loading preprocessed data. Using output\cleaned_regentity.csv dated load_donorlist_data_last_modified instead of output\cleaned_data.csv
2025/03/04 02:16:36 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:16:36 PM INFO:load_regulated_entity_data executed successfully
2025/03/04 02:16:36 PM INFO:get_regentity_data executed successfully
2025/03/04 02:16:36 PM INFO:load_data_to_session executed successfully
2025/03/04 02:16:36 PM DEBUG:st.session_state.data_regentity: 1364
2025/03/04 02:16:36 PM DEBUG:st.session_state.data_donor: 25576
2025/03/04 02:16:36 PM DEBUG:st.session_state.data_clean: 65278
2025/03/04 02:16:36 PM INFO:firstload executed successfully
2025/03/04 02:16:36 PM INFO:initialise_data executed successfully
2025/03/04 02:19:37 PM INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 02:19:37 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\utils',), kwargs={}
2025/03/04 02:19:37 PM INFO:get_git_version executed successfully
2025/03/04 02:19:38 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\data',), kwargs={}
2025/03/04 02:19:38 PM INFO:get_git_version executed successfully
2025/03/04 02:19:38 PM INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 02:19:38 PM INFO:Running App setup...
2025/03/04 02:19:38 PM DEBUG:Calling setup_package with args=(), kwargs={}
2025/03/04 02:19:38 PM INFO:Setting up the package
2025/03/04 02:19:38 PM INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 02:19:38 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1',), kwargs={}
2025/03/04 02:19:38 PM INFO:get_git_version executed successfully
2025/03/04 02:19:38 PM INFO:Version: v20.143
2025/03/04 02:19:38 PM DEBUG:Calling initialize_session_state with args=(), kwargs={}
2025/03/04 02:19:38 PM INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:19:38 PM DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 02:19:38 PM DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 02:19:38 PM DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:19:38 PM DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 02:19:38 PM DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 02:19:38 PM DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:19:38 PM DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:19:38 PM DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:19:38 PM DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:19:38 PM DEBUG:Initialised perc_target with value: 0.5
2025/03/04 02:19:38 PM DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 02:19:38 PM DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:19:38 PM DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 02:19:38 PM DEBUG:Initialised data_dir with value: data
2025/03/04 02:19:38 PM DEBUG:Initialised output_dir with value: output
2025/03/04 02:19:38 PM DEBUG:Initialised logs_dir with value: logs
2025/03/04 02:19:38 PM DEBUG:Initialised components_dir with value: components
2025/03/04 02:19:38 PM DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 02:19:38 PM DEBUG:Initialised utils_dir with value: utils
2025/03/04 02:19:38 PM DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:19:38 PM DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:19:38 PM DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 02:19:38 PM DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:19:38 PM DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:19:38 PM DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:19:38 PM DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 02:19:38 PM DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 02:19:38 PM DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 02:19:38 PM DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 02:19:38 PM DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 02:19:38 PM DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 02:19:38 PM DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 02:19:38 PM DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 02:19:38 PM DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 02:19:38 PM DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 02:19:38 PM DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:19:38 PM DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 02:19:38 PM INFO:Session_state variables initialized
2025/03/04 02:19:38 PM DEBUG:output_dir: output
2025/03/04 02:19:38 PM DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:19:38 PM DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 02:19:38 PM DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 02:19:38 PM DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:19:38 PM DEBUG:perc_target: 0.5
2025/03/04 02:19:38 PM DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:19:38 PM DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:19:38 PM DEBUG:data_dir: data
2025/03/04 02:19:38 PM DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:19:38 PM DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:19:38 PM DEBUG:reference_dir: reference_files
2025/03/04 02:19:38 PM DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 02:19:38 PM DEBUG:LOG_LEVEL: ERROR
2025/03/04 02:19:38 PM DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:19:38 PM DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 02:19:38 PM DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 02:19:38 PM DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:19:38 PM DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 02:19:38 PM DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:19:38 PM DEBUG:components_dir: components
2025/03/04 02:19:38 PM DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:19:38 PM DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:19:38 PM DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 02:19:38 PM DEBUG:app_pages_dir: app_pages
2025/03/04 02:19:38 PM DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 02:19:38 PM DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 02:19:38 PM DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:19:38 PM DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 02:19:38 PM DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 02:19:38 PM DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:19:38 PM DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 02:19:38 PM DEBUG:logs_dir: logs
2025/03/04 02:19:38 PM DEBUG:utils_dir: utils
2025/03/04 02:19:38 PM DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 02:19:38 PM DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:19:38 PM DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 02:19:38 PM INFO:Session state Setup complete
2025/03/04 02:19:38 PM INFO:initialize_session_state executed successfully
2025/03/04 02:19:38 PM INFO:Package setup complete
2025/03/04 02:19:38 PM INFO:setup_package executed successfully
2025/03/04 02:19:38 PM INFO:Running Menu setup...
2025/03/04 02:19:38 PM DEBUG:Calling pagesetup with args=(), kwargs={}
2025/03/04 02:19:38 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\app_pages',), kwargs={}
2025/03/04 02:19:38 PM INFO:get_git_version executed successfully
2025/03/04 02:19:38 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\components',), kwargs={}
2025/03/04 02:19:38 PM INFO:get_git_version executed successfully
2025/03/04 02:19:38 PM DEBUG:Calling get_git_version with args=(), kwargs={}
2025/03/04 02:19:38 PM INFO:get_git_version executed successfully
2025/03/04 02:19:38 PM INFO:App Version: v20.164
2025/03/04 02:19:38 PM INFO:Switched to page: Introduction
2025/03/04 02:19:38 PM INFO:pagesetup executed successfully
2025/03/04 02:19:38 PM INFO:No data found in session state, running firstload()
2025/03/04 02:19:39 PM DEBUG:Calling initialise_data with args=(), kwargs={}
2025/03/04 02:19:39 PM INFO:Running first load function.
2025/03/04 02:19:39 PM DEBUG:Calling firstload with args=(), kwargs={}
2025/03/04 02:19:39 PM DEBUG:Calling load_data_to_session with args=('raw_data', <function get_raw_data at 0x0000017F790611B0>), kwargs={}
2025/03/04 02:19:39 PM DEBUG:Calling get_raw_data with args=(), kwargs={}
2025/03/04 02:19:39 PM DEBUG:Calling load_raw_data with args=(), kwargs={'main_file': 'raw_data', 'cleaned_file': 'raw_data_clean', 'output_csv': True, 'dedupe_donors': True, 'dedupe_regentity': True, 'originaldatafilepath': 'source_data_fname', 'processeddatafilepath': 'imported_raw_fname'}
2025/03/04 02:19:39 PM DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 02:19:39 PM DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 02:19:39 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'output\\imported_raw.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:19:39 PM INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:19:39 PM INFO:Saved file path: output\imported_raw.csv
2025/03/04 02:19:39 PM DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:19:39 PM INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:19:39 PM DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:19:39 PM INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:19:39 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:19:39 PM INFO:Current modification time: 1740757862.6744745
2025/03/04 02:19:39 PM INFO:Last modification time: None
2025/03/04 02:19:39 PM INFO:is_file_updated executed successfully
2025/03/04 02:19:39 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:19:39 PM INFO:Loading raw data...
2025/03/04 02:19:39 PM DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 02:19:39 PM DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 02:19:39 PM INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 02:19:40 PM INFO:Data saved to output\imported_raw.csv
2025/03/04 02:19:40 PM DEBUG:Calling raw_data_cleanup with args=(), kwargs={'loaddata_df':            ECRef              RegulatedEntityName    RegulatedEntityType        Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                  ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    £1,876.56   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    £2,700.00   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    £4,852.58   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    £2,500.00   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    £4,524.05   29/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
...          ...                              ...                    ...          ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   £10,000.00          NaN                NaN  ...              3945              NaN  74198.0             NaN            NaN         False
65274   C0242461               Vote Leave Limited  Permitted Participant  £100,000.00          NaN                NaN  ...              3945              NaN  74184.0             NaN            NaN         False
65275   C0243560               Vote Leave Limited  Permitted Participant   £40,000.00          NaN                NaN  ...              3945              NaN  74576.0             NaN            NaN         False
65276   C0319710  Conservative and Unionist Party        Political Party   £50,000.00          NaN      Central Party  ...                52              NaN  34241.0             NaN  Great Britain         False
65277   C0319727  Conservative and Unionist Party        Political Party   £15,000.00          NaN      Central Party  ...                52              NaN  74743.0             NaN  Great Britain         False

[65278 rows x 29 columns], 'dedupe_donors': True, 'dedupe_regentity': True, 'output_csv': True, 'originaldatafilepath': 'output\\imported_raw.csv', 'processeddatafilepath': 'cleaned_donations_fname'}
2025/03/04 02:19:40 PM INFO:Cleaning up raw data
2025/03/04 02:19:40 PM ERROR:Session state variables not initialized!
2025/03/04 02:19:40 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': None, 'savedfilepath': 'output\\cleaned_donations.csv', 'timestamp_key': 'cleaned_raw_data_last_modified'}
2025/03/04 02:19:40 PM INFO:Original file path: None
2025/03/04 02:19:40 PM INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 02:19:40 PM ERROR:Error: originalfilepath is None!
2025/03/04 02:19:40 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:19:40 PM INFO:Data loaded, shape: (65278, 29)
2025/03/04 02:19:41 PM DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns], 'entity': 'RegulatedEntity', 'map_filename': 'regentity_map_fname', 'output_csv': True}
2025/03/04 02:19:41 PM INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 02:19:41 PM INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:19:41 PM DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:19:41 PM INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 02:19:41 PM INFO:dedupe_entity_file executed successfully
2025/03/04 02:19:41 PM DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...       CleanedRegulatedEntityName CleanedRegulatedEntityId RegulatedEntityId              RegulatedEntityName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                      Andy Street                   8015.0            8015.0                      Andy Street
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                      Andy Street                   8015.0            8015.0                      Andy Street
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                      Andy Street                   8015.0            8015.0                      Andy Street
...          ...                              ...                    ...        ...  ...                              ...                      ...               ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party

[65278 rows x 33 columns], 'entity': 'Donor', 'map_filename': 'donor_map_fname', 'output_csv': True}
2025/03/04 02:19:41 PM INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 02:19:41 PM INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 02:19:41 PM DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 02:19:41 PM INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 02:19:41 PM INFO:dedupe_entity_file executed successfully
2025/03/04 02:19:41 PM INFO:Raw Data cleanup completed
2025/03/04 02:19:41 PM INFO:Data shape: (65278, 37)
2025/03/04 02:19:43 PM INFO:Data saved to output\cleaned_donations.csv
2025/03/04 02:19:43 PM INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 02:19:43 PM INFO:raw_data_cleanup executed successfully
2025/03/04 02:19:43 PM INFO:load_raw_data executed successfully
2025/03/04 02:19:43 PM INFO:get_raw_data executed successfully
2025/03/04 02:19:43 PM INFO:load_data_to_session executed successfully
2025/03/04 02:19:43 PM DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:19:43 PM DEBUG:Calling load_data_to_session with args=('data_clean', <function get_cleaned_data at 0x0000017F79061630>), kwargs={}
2025/03/04 02:19:43 PM DEBUG:Calling get_cleaned_data with args=(), kwargs={}
2025/03/04 02:19:43 PM DEBUG:Calling load_cleaned_data with args=(), kwargs={'originaldatafilepath': 'cleaned_donations_fname', 'processeddatafilepath': 'cleaned_data_fname', 'datafile': 'raw_data', 'streamlitrun': True, 'output_csv': True, 'main_file': 'raw_data', 'cleaned_file': 'data_clean'}
2025/03/04 02:19:43 PM DEBUG:Rows in Raw Data: 65278
2025/03/04 02:19:43 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_donations.csv', 'savedfilepath': 'output\\cleaned_data.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:19:43 PM INFO:Original file path: output\cleaned_donations.csv
2025/03/04 02:19:43 PM INFO:Saved file path: output\cleaned_data.csv
2025/03/04 02:19:43 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_donations.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:19:43 PM INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 02:19:43 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_donations.csv',), kwargs={}
2025/03/04 02:19:43 PM INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 02:19:43 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:19:43 PM INFO:Current modification time: 1741097983.147648
2025/03/04 02:19:43 PM INFO:Last modification time: 1740757862.6744745
2025/03/04 02:19:43 PM INFO:is_file_updated executed successfully
2025/03/04 02:19:43 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:19:43 PM ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 02:19:43 PM INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 02:19:43 PM DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 02:19:43 PM DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 02:19:44 PM DEBUG:Calling map_mp_to_party with args=(           ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ...  DonorId                        DonorName EventCount YearReceived MonthReceived YearMonthReceived
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
...          ...                              ...                    ...        ...          ...                ...  ...      ...                              ...        ...          ...           ...               ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...  74198.0      Shaftesbury Investments Ltd          1         2016             4            201604
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...  74184.0                Mr Jeremy Hosking          1         2016             2            201602
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...  23556.0                    Anthony Clake          1         2016             6            201606
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...   2146.0                Mr Peter A Dubens          1         2017             5            201705
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...  74743.0                 Mr Ravi S Kailas          1         2017             5            201705

[65278 rows x 41 columns],), kwargs={}
2025/03/04 02:19:44 PM DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 02:19:44 PM DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 02:19:44 PM DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:19:44 PM DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 02:19:45 PM DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:19:45 PM ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 02:19:45 PM ERROR:Attempting to remove duplicates
2025/03/04 02:19:45 PM DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 02:19:45 PM DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 02:19:45 PM INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 02:19:45 PM INFO:map_mp_to_party executed successfully
2025/03/04 02:19:45 PM DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 02:19:45 PM DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 02:19:45 PM DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 02:19:45 PM DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 02:19:45 PM DEBUG:Calling load_election_dates with args=(), kwargs={}
2025/03/04 02:19:45 PM DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:19:45 PM DEBUG:try to load previous election dates from file.
2025/03/04 02:19:45 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'reference_files\\elections.csv', 'timestamp_key': 'election_dates_last_modified'}
2025/03/04 02:19:45 PM INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:19:45 PM INFO:Saved file path: reference_files\elections.csv
2025/03/04 02:19:45 PM DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'election_dates_last_modified'), kwargs={}
2025/03/04 02:19:45 PM INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:19:45 PM DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:19:45 PM INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:19:45 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:19:45 PM INFO:Current modification time: 1740757862.6744745
2025/03/04 02:19:45 PM INFO:Last modification time: None
2025/03/04 02:19:45 PM INFO:is_file_updated executed successfully
2025/03/04 02:19:45 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:19:45 PM ERROR:Failed to load election dates from file.
2025/03/04 02:19:45 PM INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 02:19:45 PM INFO:Election Dates loaded vis pdpy.
2025/03/04 02:19:45 PM DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 02:19:45 PM INFO:Election Dates Loaded Successfully.
2025/03/04 02:19:45 PM DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 02:19:45 PM DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 02:19:45 PM INFO:load_election_dates executed successfully
2025/03/04 02:20:04 PM DEBUG:Clean Data Prep 353: Election dates: 65278
2025/03/04 02:20:04 PM DEBUG:Clean Data Prep 386: End of clean: 65278
2025/03/04 02:20:06 PM INFO:Cleaned Data completed, shape: (65278, 55)
2025/03/04 02:20:06 PM INFO:load_cleaned_data executed successfully
2025/03/04 02:20:06 PM INFO:get_cleaned_data executed successfully
2025/03/04 02:20:06 PM INFO:load_data_to_session executed successfully
2025/03/04 02:20:06 PM DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:20:06 PM DEBUG:Calling load_data_to_session with args=('data_donor', <function get_donor_data at 0x0000017F79061750>), kwargs={}
2025/03/04 02:20:06 PM DEBUG:Calling get_donor_data with args=(), kwargs={}
2025/03/04 02:20:06 PM DEBUG:Calling load_donorList_data with args=(), kwargs={'main_file': 'data_clean', 'cleaned_file': 'data_donor', 'streamlitrun': True, 'output_csv': True, 'originaldatafilepath': 'cleaned_data_fname', 'cleaneddatafilepath': 'cleaned_donorlist_fname'}
2025/03/04 02:20:06 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_data.csv', 'savedfilepath': 'output\\cleaned_donorlist.csv', 'timestamp_key': 'load_donorlist_data_last_modified'}
2025/03/04 02:20:06 PM INFO:Original file path: output\cleaned_data.csv
2025/03/04 02:20:06 PM INFO:Saved file path: output\cleaned_donorlist.csv
2025/03/04 02:20:06 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_data.csv', 'load_donorlist_data_last_modified'), kwargs={}
2025/03/04 02:20:06 PM INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 02:20:06 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_data.csv',), kwargs={}
2025/03/04 02:20:06 PM INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 02:20:06 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:20:06 PM INFO:Current modification time: 1741098006.2916343
2025/03/04 02:20:06 PM INFO:Last modification time: None
2025/03/04 02:20:06 PM INFO:is_file_updated executed successfully
2025/03/04 02:20:06 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:20:06 PM INFO:Donor data saved to output\cleaned_donorlist.csv
2025/03/04 02:20:06 PM INFO:Donor Data summary completed
2025/03/04 02:20:06 PM INFO:Data shape: (25576, 5)
2025/03/04 02:20:06 PM INFO:load_donorList_data executed successfully
2025/03/04 02:20:06 PM INFO:get_donor_data executed successfully
2025/03/04 02:20:06 PM INFO:load_data_to_session executed successfully
2025/03/04 02:20:06 PM DEBUG:st.session_state.data_donor: 25576
2025/03/04 02:20:06 PM DEBUG:st.session_state.data_clean: 65278
2025/03/04 02:20:06 PM DEBUG:Calling load_data_to_session with args=('data_regentity', <function get_regentity_data at 0x0000017F79061870>), kwargs={}
2025/03/04 02:20:06 PM DEBUG:Calling get_regentity_data with args=(), kwargs={}
2025/03/04 02:20:06 PM DEBUG:Calling load_regulated_entity_data with args=(), kwargs={'main_file': 'data_clean', 'cleaned_file': 'data_regentity', 'streamlitrun': True, 'output_csv': True, 'originaldatafilepath': 'cleaned_data_fname', 'cleaneddatafilepath': 'cleaned_regentity_fname'}
2025/03/04 02:20:06 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_data.csv', 'savedfilepath': 'output\\cleaned_regentity.csv', 'timestamp_key': 'load_donorlist_data_last_modified'}
2025/03/04 02:20:06 PM INFO:Original file path: output\cleaned_data.csv
2025/03/04 02:20:06 PM INFO:Saved file path: output\cleaned_regentity.csv
2025/03/04 02:20:06 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_data.csv', 'load_donorlist_data_last_modified'), kwargs={}
2025/03/04 02:20:06 PM INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 02:20:06 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_data.csv',), kwargs={}
2025/03/04 02:20:06 PM INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 02:20:06 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:20:06 PM INFO:Current modification time: 1741098006.2916343
2025/03/04 02:20:06 PM INFO:Last modification time: 1741098006.2916343
2025/03/04 02:20:06 PM INFO:is_file_updated executed successfully
2025/03/04 02:20:06 PM INFO:Loading preprocessed data. Using output\cleaned_regentity.csv dated load_donorlist_data_last_modified instead of output\cleaned_data.csv
2025/03/04 02:20:06 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:20:06 PM INFO:load_regulated_entity_data executed successfully
2025/03/04 02:20:06 PM INFO:get_regentity_data executed successfully
2025/03/04 02:20:06 PM INFO:load_data_to_session executed successfully
2025/03/04 02:20:06 PM DEBUG:st.session_state.data_regentity: 1364
2025/03/04 02:20:06 PM DEBUG:st.session_state.data_donor: 25576
2025/03/04 02:20:06 PM DEBUG:st.session_state.data_clean: 65278
2025/03/04 02:20:06 PM INFO:firstload executed successfully
2025/03/04 02:20:06 PM INFO:initialise_data executed successfully
2025/03/04 02:25:19 PM INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 02:25:19 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\utils',), kwargs={}
2025/03/04 02:25:19 PM INFO:get_git_version executed successfully
2025/03/04 02:25:20 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\data',), kwargs={}
2025/03/04 02:25:20 PM INFO:get_git_version executed successfully
2025/03/04 02:25:20 PM INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 02:25:20 PM INFO:Running App setup...
2025/03/04 02:25:20 PM DEBUG:Calling setup_package with args=(), kwargs={}
2025/03/04 02:25:20 PM INFO:Setting up the package
2025/03/04 02:25:20 PM INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 02:25:20 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1',), kwargs={}
2025/03/04 02:25:20 PM INFO:get_git_version executed successfully
2025/03/04 02:25:20 PM INFO:Version: v20.143
2025/03/04 02:25:20 PM DEBUG:Calling initialize_session_state with args=(), kwargs={}
2025/03/04 02:25:20 PM INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:25:20 PM DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 02:25:20 PM DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 02:25:20 PM DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:25:20 PM DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 02:25:20 PM DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 02:25:20 PM DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:25:20 PM DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:25:20 PM DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:25:20 PM DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:25:20 PM DEBUG:Initialised perc_target with value: 0.5
2025/03/04 02:25:20 PM DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 02:25:20 PM DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:25:20 PM DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 02:25:20 PM DEBUG:Initialised data_dir with value: data
2025/03/04 02:25:20 PM DEBUG:Initialised output_dir with value: output
2025/03/04 02:25:20 PM DEBUG:Initialised logs_dir with value: logs
2025/03/04 02:25:20 PM DEBUG:Initialised components_dir with value: components
2025/03/04 02:25:20 PM DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 02:25:20 PM DEBUG:Initialised utils_dir with value: utils
2025/03/04 02:25:20 PM DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:25:20 PM DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:25:20 PM DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 02:25:20 PM DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:25:20 PM DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:25:20 PM DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:25:20 PM DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 02:25:20 PM DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 02:25:20 PM DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 02:25:20 PM DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 02:25:20 PM DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 02:25:20 PM DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 02:25:20 PM DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 02:25:20 PM DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 02:25:20 PM DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 02:25:20 PM DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 02:25:20 PM DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:25:20 PM DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 02:25:20 PM INFO:Session_state variables initialized
2025/03/04 02:25:20 PM DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 02:25:20 PM DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 02:25:20 PM DEBUG:data_dir: data
2025/03/04 02:25:20 PM DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:25:20 PM DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 02:25:20 PM DEBUG:reference_dir: reference_files
2025/03/04 02:25:20 PM DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:25:20 PM DEBUG:output_dir: output
2025/03/04 02:25:20 PM DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:25:20 PM DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 02:25:20 PM DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:25:20 PM DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 02:25:20 PM DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:25:20 PM DEBUG:LOG_LEVEL: ERROR
2025/03/04 02:25:20 PM DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 02:25:20 PM DEBUG:utils_dir: utils
2025/03/04 02:25:20 PM DEBUG:perc_target: 0.5
2025/03/04 02:25:20 PM DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 02:25:20 PM DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 02:25:20 PM DEBUG:components_dir: components
2025/03/04 02:25:20 PM DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:25:20 PM DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 02:25:20 PM DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:25:20 PM DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 02:25:20 PM DEBUG:logs_dir: logs
2025/03/04 02:25:20 PM DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:25:20 PM DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:25:20 PM DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 02:25:20 PM DEBUG:app_pages_dir: app_pages
2025/03/04 02:25:20 PM DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 02:25:20 PM DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:25:20 PM DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 02:25:20 PM DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:25:20 PM DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 02:25:20 PM DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:25:20 PM DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:25:20 PM DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:25:20 PM INFO:Session state Setup complete
2025/03/04 02:25:20 PM INFO:initialize_session_state executed successfully
2025/03/04 02:25:20 PM INFO:Package setup complete
2025/03/04 02:25:20 PM INFO:setup_package executed successfully
2025/03/04 02:25:20 PM INFO:Running Menu setup...
2025/03/04 02:25:20 PM DEBUG:Calling pagesetup with args=(), kwargs={}
2025/03/04 02:25:20 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\app_pages',), kwargs={}
2025/03/04 02:25:20 PM INFO:get_git_version executed successfully
2025/03/04 02:25:20 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\components',), kwargs={}
2025/03/04 02:25:20 PM INFO:get_git_version executed successfully
2025/03/04 02:25:21 PM DEBUG:Calling get_git_version with args=(), kwargs={}
2025/03/04 02:25:21 PM INFO:get_git_version executed successfully
2025/03/04 02:25:21 PM INFO:App Version: v20.164
2025/03/04 02:25:21 PM INFO:Switched to page: Introduction
2025/03/04 02:25:21 PM INFO:pagesetup executed successfully
2025/03/04 02:25:21 PM INFO:No data found in session state, running firstload()
2025/03/04 02:25:21 PM DEBUG:Calling initialise_data with args=(), kwargs={}
2025/03/04 02:25:21 PM INFO:Running first load function.
2025/03/04 02:25:21 PM DEBUG:Calling firstload with args=(), kwargs={}
2025/03/04 02:25:21 PM DEBUG:Calling load_data_to_session with args=('raw_data', <function get_raw_data at 0x000001C3E50B11B0>), kwargs={}
2025/03/04 02:25:21 PM DEBUG:Calling get_raw_data with args=(), kwargs={}
2025/03/04 02:25:21 PM DEBUG:Calling load_raw_data with args=(), kwargs={'main_file': 'raw_data', 'cleaned_file': 'raw_data_clean', 'output_csv': True, 'dedupe_donors': True, 'dedupe_regentity': True, 'originaldatafilepath': 'source_data_fname', 'processeddatafilepath': 'imported_raw_fname'}
2025/03/04 02:25:21 PM DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 02:25:21 PM DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 02:25:21 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'output\\imported_raw.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:25:21 PM INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:25:21 PM INFO:Saved file path: output\imported_raw.csv
2025/03/04 02:25:21 PM DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:25:21 PM INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:25:21 PM DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:25:21 PM INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:25:21 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:25:21 PM INFO:Current modification time: 1740757862.6744745
2025/03/04 02:25:21 PM INFO:Last modification time: None
2025/03/04 02:25:21 PM INFO:is_file_updated executed successfully
2025/03/04 02:25:21 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:25:21 PM INFO:Loading raw data...
2025/03/04 02:25:21 PM DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 02:25:21 PM DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 02:25:21 PM INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 02:25:22 PM INFO:Data saved to output\imported_raw.csv
2025/03/04 02:25:22 PM DEBUG:Calling raw_data_cleanup with args=(), kwargs={'loaddata_df':            ECRef              RegulatedEntityName    RegulatedEntityType        Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                  ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    £1,876.56   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    £2,700.00   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    £4,852.58   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    £2,500.00   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    £4,524.05   29/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
...          ...                              ...                    ...          ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   £10,000.00          NaN                NaN  ...              3945              NaN  74198.0             NaN            NaN         False
65274   C0242461               Vote Leave Limited  Permitted Participant  £100,000.00          NaN                NaN  ...              3945              NaN  74184.0             NaN            NaN         False
65275   C0243560               Vote Leave Limited  Permitted Participant   £40,000.00          NaN                NaN  ...              3945              NaN  74576.0             NaN            NaN         False
65276   C0319710  Conservative and Unionist Party        Political Party   £50,000.00          NaN      Central Party  ...                52              NaN  34241.0             NaN  Great Britain         False
65277   C0319727  Conservative and Unionist Party        Political Party   £15,000.00          NaN      Central Party  ...                52              NaN  74743.0             NaN  Great Britain         False

[65278 rows x 29 columns], 'dedupe_donors': True, 'dedupe_regentity': True, 'output_csv': True, 'originaldatafilepath': 'output\\imported_raw.csv', 'processeddatafilepath': 'cleaned_donations_fname'}
2025/03/04 02:25:22 PM INFO:Cleaning up raw data
2025/03/04 02:25:22 PM ERROR:Session state variables not initialized!
2025/03/04 02:25:22 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': None, 'savedfilepath': 'output\\cleaned_donations.csv', 'timestamp_key': 'cleaned_raw_data_last_modified'}
2025/03/04 02:25:22 PM INFO:Original file path: None
2025/03/04 02:25:22 PM INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 02:25:22 PM ERROR:Error: originalfilepath is None!
2025/03/04 02:25:22 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:25:22 PM INFO:Data loaded, shape: (65278, 29)
2025/03/04 02:25:23 PM DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns], 'entity': 'RegulatedEntity', 'map_filename': 'regentity_map_fname', 'output_csv': True}
2025/03/04 02:25:23 PM INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 02:25:23 PM INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:25:23 PM DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:25:23 PM INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 02:25:23 PM INFO:dedupe_entity_file executed successfully
2025/03/04 02:25:23 PM DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...       CleanedRegulatedEntityName CleanedRegulatedEntityId RegulatedEntityId              RegulatedEntityName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                      Andy Street                   8015.0            8015.0                      Andy Street
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                      Andy Street                   8015.0            8015.0                      Andy Street
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                      Andy Street                   8015.0            8015.0                      Andy Street
...          ...                              ...                    ...        ...  ...                              ...                      ...               ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party

[65278 rows x 33 columns], 'entity': 'Donor', 'map_filename': 'donor_map_fname', 'output_csv': True}
2025/03/04 02:25:23 PM INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 02:25:24 PM INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 02:25:24 PM DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 02:25:24 PM INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 02:25:24 PM INFO:dedupe_entity_file executed successfully
2025/03/04 02:25:24 PM INFO:Raw Data cleanup completed
2025/03/04 02:25:24 PM INFO:Data shape: (65278, 37)
2025/03/04 02:25:25 PM INFO:Data saved to output\cleaned_donations.csv
2025/03/04 02:25:25 PM INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 02:25:25 PM INFO:raw_data_cleanup executed successfully
2025/03/04 02:25:25 PM INFO:load_raw_data executed successfully
2025/03/04 02:25:25 PM INFO:get_raw_data executed successfully
2025/03/04 02:25:25 PM INFO:load_data_to_session executed successfully
2025/03/04 02:25:25 PM DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:25:25 PM DEBUG:Calling load_data_to_session with args=('data_clean', <function get_cleaned_data at 0x000001C3E50B1630>), kwargs={}
2025/03/04 02:25:25 PM DEBUG:Calling get_cleaned_data with args=(), kwargs={}
2025/03/04 02:25:25 PM DEBUG:Calling load_cleaned_data with args=(), kwargs={'originaldatafilepath': 'cleaned_donations_fname', 'processeddatafilepath': 'cleaned_data_fname', 'datafile': 'raw_data', 'streamlitrun': True, 'output_csv': True, 'main_file': 'raw_data', 'cleaned_file': 'data_clean'}
2025/03/04 02:25:25 PM DEBUG:Rows in Raw Data: 65278
2025/03/04 02:25:25 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_donations.csv', 'savedfilepath': 'output\\cleaned_data.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:25:25 PM INFO:Original file path: output\cleaned_donations.csv
2025/03/04 02:25:25 PM INFO:Saved file path: output\cleaned_data.csv
2025/03/04 02:25:25 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_donations.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:25:25 PM INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 02:25:25 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_donations.csv',), kwargs={}
2025/03/04 02:25:25 PM INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 02:25:25 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:25:25 PM INFO:Current modification time: 1741098325.5471387
2025/03/04 02:25:25 PM INFO:Last modification time: 1740757862.6744745
2025/03/04 02:25:25 PM INFO:is_file_updated executed successfully
2025/03/04 02:25:25 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:25:25 PM ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 02:25:25 PM INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 02:25:25 PM DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 02:25:25 PM DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 02:25:27 PM DEBUG:Calling map_mp_to_party with args=(           ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ...  DonorId                        DonorName EventCount YearReceived MonthReceived YearMonthReceived
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
...          ...                              ...                    ...        ...          ...                ...  ...      ...                              ...        ...          ...           ...               ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...  74198.0      Shaftesbury Investments Ltd          1         2016             4            201604
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...  74184.0                Mr Jeremy Hosking          1         2016             2            201602
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...  23556.0                    Anthony Clake          1         2016             6            201606
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...   2146.0                Mr Peter A Dubens          1         2017             5            201705
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...  74743.0                 Mr Ravi S Kailas          1         2017             5            201705

[65278 rows x 41 columns],), kwargs={}
2025/03/04 02:25:27 PM DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 02:25:27 PM DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 02:25:27 PM DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:25:27 PM DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 02:25:27 PM DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:25:27 PM ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 02:25:27 PM ERROR:Attempting to remove duplicates
2025/03/04 02:25:28 PM DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 02:25:28 PM DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 02:25:28 PM INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 02:25:28 PM INFO:map_mp_to_party executed successfully
2025/03/04 02:25:28 PM DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 02:25:28 PM DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 02:25:28 PM DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 02:25:28 PM DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 02:25:28 PM DEBUG:Calling load_election_dates with args=(), kwargs={}
2025/03/04 02:25:28 PM DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:25:28 PM DEBUG:try to load previous election dates from file.
2025/03/04 02:25:28 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'reference_files\\elections.csv', 'timestamp_key': 'election_dates_last_modified'}
2025/03/04 02:25:28 PM INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:25:28 PM INFO:Saved file path: reference_files\elections.csv
2025/03/04 02:25:28 PM DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'election_dates_last_modified'), kwargs={}
2025/03/04 02:25:28 PM INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:25:28 PM DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:25:28 PM INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:25:28 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:25:28 PM INFO:Current modification time: 1740757862.6744745
2025/03/04 02:25:28 PM INFO:Last modification time: None
2025/03/04 02:25:28 PM INFO:is_file_updated executed successfully
2025/03/04 02:25:28 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:25:28 PM ERROR:Failed to load election dates from file.
2025/03/04 02:25:28 PM INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 02:25:28 PM INFO:Election Dates loaded vis pdpy.
2025/03/04 02:25:28 PM DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 02:25:28 PM INFO:Election Dates Loaded Successfully.
2025/03/04 02:25:28 PM DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 02:25:28 PM DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 02:25:28 PM INFO:load_election_dates executed successfully
2025/03/04 02:25:47 PM DEBUG:Clean Data Prep 353: Election dates: 65278
2025/03/04 02:25:47 PM DEBUG:Clean Data Prep 386: End of clean: 65278
2025/03/04 02:25:48 PM INFO:Cleaned Data completed, shape: (65278, 55)
2025/03/04 02:25:48 PM INFO:load_cleaned_data executed successfully
2025/03/04 02:25:49 PM INFO:get_cleaned_data executed successfully
2025/03/04 02:25:49 PM INFO:load_data_to_session executed successfully
2025/03/04 02:25:49 PM DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:25:49 PM DEBUG:Calling load_data_to_session with args=('data_donor', <function get_donor_data at 0x000001C3E50B1750>), kwargs={}
2025/03/04 02:25:49 PM DEBUG:Calling get_donor_data with args=(), kwargs={}
2025/03/04 02:25:49 PM DEBUG:Calling load_donorList_data with args=(), kwargs={'main_file': 'data_clean', 'cleaned_file': 'data_donor', 'streamlitrun': True, 'output_csv': True, 'originaldatafilepath': 'cleaned_data_fname', 'cleaneddatafilepath': 'cleaned_donorlist_fname'}
2025/03/04 02:25:49 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_data.csv', 'savedfilepath': 'output\\cleaned_donorlist.csv', 'timestamp_key': 'load_donorlist_data_last_modified'}
2025/03/04 02:25:49 PM INFO:Original file path: output\cleaned_data.csv
2025/03/04 02:25:49 PM INFO:Saved file path: output\cleaned_donorlist.csv
2025/03/04 02:25:49 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_data.csv', 'load_donorlist_data_last_modified'), kwargs={}
2025/03/04 02:25:49 PM INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 02:25:49 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_data.csv',), kwargs={}
2025/03/04 02:25:49 PM INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 02:25:49 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:25:49 PM INFO:Current modification time: 1741098348.7929413
2025/03/04 02:25:49 PM INFO:Last modification time: None
2025/03/04 02:25:49 PM INFO:is_file_updated executed successfully
2025/03/04 02:25:49 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:25:49 PM INFO:Donor data saved to output\cleaned_donorlist.csv
2025/03/04 02:25:49 PM INFO:Donor Data summary completed
2025/03/04 02:25:49 PM INFO:Data shape: (25576, 5)
2025/03/04 02:25:49 PM INFO:load_donorList_data executed successfully
2025/03/04 02:25:49 PM INFO:get_donor_data executed successfully
2025/03/04 02:25:49 PM INFO:load_data_to_session executed successfully
2025/03/04 02:25:49 PM DEBUG:st.session_state.data_donor: 25576
2025/03/04 02:25:49 PM DEBUG:st.session_state.data_clean: 65278
2025/03/04 02:25:49 PM DEBUG:Calling load_data_to_session with args=('data_regentity', <function get_regentity_data at 0x000001C3E50B1870>), kwargs={}
2025/03/04 02:25:49 PM DEBUG:Calling get_regentity_data with args=(), kwargs={}
2025/03/04 02:25:49 PM DEBUG:Calling load_regulated_entity_data with args=(), kwargs={'main_file': 'data_clean', 'cleaned_file': 'data_regentity', 'streamlitrun': True, 'output_csv': True, 'originaldatafilepath': 'cleaned_data_fname', 'cleaneddatafilepath': 'cleaned_regentity_fname'}
2025/03/04 02:25:49 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_data.csv', 'savedfilepath': 'output\\cleaned_regentity.csv', 'timestamp_key': 'load_donorlist_data_last_modified'}
2025/03/04 02:25:49 PM INFO:Original file path: output\cleaned_data.csv
2025/03/04 02:25:49 PM INFO:Saved file path: output\cleaned_regentity.csv
2025/03/04 02:25:49 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_data.csv', 'load_donorlist_data_last_modified'), kwargs={}
2025/03/04 02:25:49 PM INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 02:25:49 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_data.csv',), kwargs={}
2025/03/04 02:25:49 PM INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 02:25:49 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:25:49 PM INFO:Current modification time: 1741098348.7929413
2025/03/04 02:25:49 PM INFO:Last modification time: 1741098348.7929413
2025/03/04 02:25:49 PM INFO:is_file_updated executed successfully
2025/03/04 02:25:49 PM INFO:Loading preprocessed data. Using output\cleaned_regentity.csv dated load_donorlist_data_last_modified instead of output\cleaned_data.csv
2025/03/04 02:25:49 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:25:49 PM INFO:load_regulated_entity_data executed successfully
2025/03/04 02:25:49 PM INFO:get_regentity_data executed successfully
2025/03/04 02:25:49 PM INFO:load_data_to_session executed successfully
2025/03/04 02:25:49 PM DEBUG:st.session_state.data_regentity: 1364
2025/03/04 02:25:49 PM DEBUG:st.session_state.data_donor: 25576
2025/03/04 02:25:49 PM DEBUG:st.session_state.data_clean: 65278
2025/03/04 02:25:49 PM INFO:firstload executed successfully
2025/03/04 02:25:49 PM INFO:initialise_data executed successfully
2025/03/04 02:29:32 PM INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 02:29:32 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\utils',), kwargs={}
2025/03/04 02:29:32 PM INFO:get_git_version executed successfully
2025/03/04 02:29:33 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\data',), kwargs={}
2025/03/04 02:29:33 PM INFO:get_git_version executed successfully
2025/03/04 02:29:33 PM INFO:Streamlit App Starting...
2025/03/04 02:29:33 PM INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 02:29:33 PM INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 02:29:33 PM INFO:Running App setup...
2025/03/04 02:29:33 PM DEBUG:Calling setup_package with args=(), kwargs={}
2025/03/04 02:29:33 PM INFO:Setting up the package
2025/03/04 02:29:33 PM INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 02:29:33 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1',), kwargs={}
2025/03/04 02:29:33 PM INFO:get_git_version executed successfully
2025/03/04 02:29:33 PM INFO:Version: v20.143
2025/03/04 02:29:33 PM DEBUG:Calling initialize_session_state with args=(), kwargs={}
2025/03/04 02:29:33 PM INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:29:33 PM DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 02:29:33 PM DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 02:29:33 PM DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:29:33 PM DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 02:29:33 PM DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 02:29:33 PM DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:29:33 PM DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:29:33 PM DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:29:33 PM DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:29:33 PM DEBUG:Initialised perc_target with value: 0.5
2025/03/04 02:29:33 PM DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 02:29:33 PM DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:29:33 PM DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 02:29:33 PM DEBUG:Initialised data_dir with value: data
2025/03/04 02:29:33 PM DEBUG:Initialised output_dir with value: output
2025/03/04 02:29:33 PM DEBUG:Initialised logs_dir with value: logs
2025/03/04 02:29:33 PM DEBUG:Initialised components_dir with value: components
2025/03/04 02:29:33 PM DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 02:29:33 PM DEBUG:Initialised utils_dir with value: utils
2025/03/04 02:29:33 PM DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:29:33 PM DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:29:33 PM DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 02:29:33 PM DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:29:33 PM DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:29:33 PM DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:29:33 PM DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 02:29:33 PM DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 02:29:33 PM DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 02:29:33 PM DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 02:29:33 PM DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 02:29:33 PM DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 02:29:33 PM DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 02:29:33 PM DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 02:29:33 PM DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 02:29:33 PM DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 02:29:33 PM DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:29:33 PM DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 02:29:33 PM INFO:Session_state variables initialized
2025/03/04 02:29:33 PM DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:29:33 PM DEBUG:perc_target: 0.5
2025/03/04 02:29:33 PM DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:29:33 PM DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:29:33 PM DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:29:33 PM DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:29:33 PM DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 02:29:33 PM DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:29:33 PM DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:29:33 PM DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 02:29:33 PM DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 02:29:33 PM DEBUG:utils_dir: utils
2025/03/04 02:29:33 PM DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 02:29:33 PM DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 02:29:33 PM DEBUG:output_dir: output
2025/03/04 02:29:33 PM DEBUG:components_dir: components
2025/03/04 02:29:33 PM DEBUG:data_dir: data
2025/03/04 02:29:33 PM DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:29:33 PM DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 02:29:33 PM DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:29:33 PM DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:29:33 PM DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 02:29:33 PM DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:29:33 PM DEBUG:LOG_LEVEL: ERROR
2025/03/04 02:29:33 PM DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:29:33 PM DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:29:33 PM DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 02:29:33 PM DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 02:29:33 PM DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 02:29:33 PM DEBUG:reference_dir: reference_files
2025/03/04 02:29:33 PM DEBUG:logs_dir: logs
2025/03/04 02:29:33 PM DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 02:29:33 PM DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:29:33 PM DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 02:29:33 PM DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 02:29:33 PM DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 02:29:33 PM DEBUG:app_pages_dir: app_pages
2025/03/04 02:29:33 PM INFO:Session state Setup complete
2025/03/04 02:29:33 PM INFO:initialize_session_state executed successfully
2025/03/04 02:29:33 PM INFO:Package setup complete
2025/03/04 02:29:33 PM INFO:setup_package executed successfully
2025/03/04 02:29:33 PM INFO:Setup completed successfully.
2025/03/04 02:29:33 PM INFO:Running Menu setup...
2025/03/04 02:29:33 PM DEBUG:Calling pagesetup with args=(), kwargs={}
2025/03/04 02:29:33 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\app_pages',), kwargs={}
2025/03/04 02:29:33 PM INFO:get_git_version executed successfully
2025/03/04 02:29:33 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\components',), kwargs={}
2025/03/04 02:29:33 PM INFO:get_git_version executed successfully
2025/03/04 02:29:33 PM DEBUG:Calling get_git_version with args=(), kwargs={}
2025/03/04 02:29:33 PM INFO:get_git_version executed successfully
2025/03/04 02:29:33 PM INFO:App Version: v20.164
2025/03/04 02:29:33 PM INFO:Switched to page: Introduction
2025/03/04 02:29:34 PM INFO:pagesetup executed successfully
2025/03/04 02:29:34 PM INFO:Menu setup completed successfully.
2025/03/04 02:29:34 PM INFO:No data found in session state, running firstload()
2025/03/04 02:29:34 PM DEBUG:Calling initialise_data with args=(), kwargs={}
2025/03/04 02:29:34 PM INFO:Running first load function.
2025/03/04 02:29:34 PM DEBUG:Calling firstload with args=(), kwargs={}
2025/03/04 02:29:34 PM DEBUG:Calling load_data_to_session with args=('raw_data', <function get_raw_data at 0x000001FD87173A30>), kwargs={}
2025/03/04 02:29:34 PM DEBUG:Calling get_raw_data with args=(), kwargs={}
2025/03/04 02:29:34 PM DEBUG:Calling load_raw_data with args=(), kwargs={'main_file': 'raw_data', 'cleaned_file': 'raw_data_clean', 'output_csv': True, 'dedupe_donors': True, 'dedupe_regentity': True, 'originaldatafilepath': 'source_data_fname', 'processeddatafilepath': 'imported_raw_fname'}
2025/03/04 02:29:34 PM DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 02:29:34 PM DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 02:29:34 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'output\\imported_raw.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:29:34 PM INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:29:34 PM INFO:Saved file path: output\imported_raw.csv
2025/03/04 02:29:34 PM DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:29:34 PM INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:29:34 PM DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:29:34 PM INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:29:34 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:29:34 PM INFO:Current modification time: 1740757862.6744745
2025/03/04 02:29:34 PM INFO:Last modification time: None
2025/03/04 02:29:34 PM INFO:is_file_updated executed successfully
2025/03/04 02:29:34 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:29:34 PM INFO:Loading raw data...
2025/03/04 02:29:34 PM DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 02:29:34 PM DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 02:29:34 PM INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 02:29:35 PM INFO:Data saved to output\imported_raw.csv
2025/03/04 02:29:35 PM DEBUG:Calling raw_data_cleanup with args=(), kwargs={'loaddata_df':            ECRef              RegulatedEntityName    RegulatedEntityType        Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                  ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    £1,876.56   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    £2,700.00   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    £4,852.58   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    £2,500.00   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    £4,524.05   29/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
...          ...                              ...                    ...          ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   £10,000.00          NaN                NaN  ...              3945              NaN  74198.0             NaN            NaN         False
65274   C0242461               Vote Leave Limited  Permitted Participant  £100,000.00          NaN                NaN  ...              3945              NaN  74184.0             NaN            NaN         False
65275   C0243560               Vote Leave Limited  Permitted Participant   £40,000.00          NaN                NaN  ...              3945              NaN  74576.0             NaN            NaN         False
65276   C0319710  Conservative and Unionist Party        Political Party   £50,000.00          NaN      Central Party  ...                52              NaN  34241.0             NaN  Great Britain         False
65277   C0319727  Conservative and Unionist Party        Political Party   £15,000.00          NaN      Central Party  ...                52              NaN  74743.0             NaN  Great Britain         False

[65278 rows x 29 columns], 'dedupe_donors': True, 'dedupe_regentity': True, 'output_csv': True, 'originaldatafilepath': 'output\\imported_raw.csv', 'processeddatafilepath': 'cleaned_donations_fname'}
2025/03/04 02:29:35 PM INFO:Cleaning up raw data
2025/03/04 02:29:35 PM ERROR:Session state variables not initialized!
2025/03/04 02:29:35 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': None, 'savedfilepath': 'output\\cleaned_donations.csv', 'timestamp_key': 'cleaned_raw_data_last_modified'}
2025/03/04 02:29:35 PM INFO:Original file path: None
2025/03/04 02:29:35 PM INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 02:29:35 PM ERROR:Error: originalfilepath is None!
2025/03/04 02:29:35 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:29:35 PM INFO:Data loaded, shape: (65278, 29)
2025/03/04 02:29:37 PM DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns], 'entity': 'RegulatedEntity', 'map_filename': 'regentity_map_fname', 'output_csv': True}
2025/03/04 02:29:37 PM INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 02:29:37 PM INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:29:37 PM DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:29:37 PM INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 02:29:37 PM INFO:dedupe_entity_file executed successfully
2025/03/04 02:29:37 PM DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...       CleanedRegulatedEntityName CleanedRegulatedEntityId RegulatedEntityId              RegulatedEntityName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                      Andy Street                   8015.0            8015.0                      Andy Street
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                      Andy Street                   8015.0            8015.0                      Andy Street
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                      Andy Street                   8015.0            8015.0                      Andy Street
...          ...                              ...                    ...        ...  ...                              ...                      ...               ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party

[65278 rows x 33 columns], 'entity': 'Donor', 'map_filename': 'donor_map_fname', 'output_csv': True}
2025/03/04 02:29:37 PM INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 02:29:37 PM INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 02:29:37 PM DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 02:29:37 PM INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 02:29:37 PM INFO:dedupe_entity_file executed successfully
2025/03/04 02:29:37 PM INFO:Raw Data cleanup completed
2025/03/04 02:29:37 PM INFO:Data shape: (65278, 37)
2025/03/04 02:29:38 PM INFO:Data saved to output\cleaned_donations.csv
2025/03/04 02:29:38 PM INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 02:29:38 PM INFO:raw_data_cleanup executed successfully
2025/03/04 02:29:39 PM INFO:load_raw_data executed successfully
2025/03/04 02:29:39 PM INFO:get_raw_data executed successfully
2025/03/04 02:29:39 PM INFO:load_data_to_session executed successfully
2025/03/04 02:29:39 PM DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:29:39 PM DEBUG:Calling load_data_to_session with args=('data_clean', <function get_cleaned_data at 0x000001FD87173EB0>), kwargs={}
2025/03/04 02:29:39 PM DEBUG:Calling get_cleaned_data with args=(), kwargs={}
2025/03/04 02:29:39 PM DEBUG:Calling load_cleaned_data with args=(), kwargs={'originaldatafilepath': 'cleaned_donations_fname', 'processeddatafilepath': 'cleaned_data_fname', 'datafile': 'raw_data', 'streamlitrun': True, 'output_csv': True, 'main_file': 'raw_data', 'cleaned_file': 'data_clean'}
2025/03/04 02:29:39 PM DEBUG:Rows in Raw Data: 65278
2025/03/04 02:29:39 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_donations.csv', 'savedfilepath': 'output\\cleaned_data.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:29:39 PM INFO:Original file path: output\cleaned_donations.csv
2025/03/04 02:29:39 PM INFO:Saved file path: output\cleaned_data.csv
2025/03/04 02:29:39 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_donations.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:29:39 PM INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 02:29:39 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_donations.csv',), kwargs={}
2025/03/04 02:29:39 PM INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 02:29:39 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:29:39 PM INFO:Current modification time: 1741098578.9435186
2025/03/04 02:29:39 PM INFO:Last modification time: 1740757862.6744745
2025/03/04 02:29:39 PM INFO:is_file_updated executed successfully
2025/03/04 02:29:39 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:29:39 PM ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 02:29:39 PM INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 02:29:39 PM DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 02:29:39 PM DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 02:29:40 PM DEBUG:Calling map_mp_to_party with args=(           ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ...  DonorId                        DonorName EventCount YearReceived MonthReceived YearMonthReceived
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
...          ...                              ...                    ...        ...          ...                ...  ...      ...                              ...        ...          ...           ...               ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...  74198.0      Shaftesbury Investments Ltd          1         2016             4            201604
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...  74184.0                Mr Jeremy Hosking          1         2016             2            201602
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...  23556.0                    Anthony Clake          1         2016             6            201606
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...   2146.0                Mr Peter A Dubens          1         2017             5            201705
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...  74743.0                 Mr Ravi S Kailas          1         2017             5            201705

[65278 rows x 41 columns],), kwargs={}
2025/03/04 02:29:40 PM DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 02:29:40 PM DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 02:29:40 PM DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:29:41 PM DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 02:29:41 PM DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:29:41 PM ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 02:29:41 PM ERROR:Attempting to remove duplicates
2025/03/04 02:29:41 PM DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 02:29:41 PM DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 02:29:41 PM INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 02:29:41 PM INFO:map_mp_to_party executed successfully
2025/03/04 02:29:41 PM DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 02:29:41 PM DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 02:29:41 PM DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 02:29:41 PM DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 02:29:41 PM DEBUG:Calling load_election_dates with args=(), kwargs={}
2025/03/04 02:29:41 PM DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:29:41 PM DEBUG:try to load previous election dates from file.
2025/03/04 02:29:41 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'reference_files\\elections.csv', 'timestamp_key': 'election_dates_last_modified'}
2025/03/04 02:29:41 PM INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:29:41 PM INFO:Saved file path: reference_files\elections.csv
2025/03/04 02:29:41 PM DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'election_dates_last_modified'), kwargs={}
2025/03/04 02:29:41 PM INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:29:41 PM DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:29:41 PM INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:29:41 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:29:41 PM INFO:Current modification time: 1740757862.6744745
2025/03/04 02:29:41 PM INFO:Last modification time: None
2025/03/04 02:29:41 PM INFO:is_file_updated executed successfully
2025/03/04 02:29:41 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:29:41 PM ERROR:Failed to load election dates from file.
2025/03/04 02:29:41 PM INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 02:29:41 PM INFO:Election Dates loaded vis pdpy.
2025/03/04 02:29:41 PM DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 02:29:41 PM INFO:Election Dates Loaded Successfully.
2025/03/04 02:29:41 PM DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 02:29:41 PM DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 02:29:41 PM INFO:load_election_dates executed successfully
2025/03/04 02:30:00 PM DEBUG:Clean Data Prep 353: Election dates: 65278
2025/03/04 02:30:00 PM DEBUG:Clean Data Prep 386: End of clean: 65278
2025/03/04 02:30:02 PM INFO:Cleaned Data completed, shape: (65278, 55)
2025/03/04 02:30:02 PM INFO:load_cleaned_data executed successfully
2025/03/04 02:30:02 PM INFO:get_cleaned_data executed successfully
2025/03/04 02:30:02 PM INFO:load_data_to_session executed successfully
2025/03/04 02:30:02 PM DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:30:02 PM DEBUG:Calling load_data_to_session with args=('data_donor', <function get_donor_data at 0x000001FD8719C040>), kwargs={}
2025/03/04 02:30:02 PM DEBUG:Calling get_donor_data with args=(), kwargs={}
2025/03/04 02:30:02 PM DEBUG:Calling load_donorList_data with args=(), kwargs={'main_file': 'data_clean', 'cleaned_file': 'data_donor', 'streamlitrun': True, 'output_csv': True, 'originaldatafilepath': 'cleaned_data_fname', 'cleaneddatafilepath': 'cleaned_donorlist_fname'}
2025/03/04 02:30:02 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_data.csv', 'savedfilepath': 'output\\cleaned_donorlist.csv', 'timestamp_key': 'load_donorlist_data_last_modified'}
2025/03/04 02:30:02 PM INFO:Original file path: output\cleaned_data.csv
2025/03/04 02:30:02 PM INFO:Saved file path: output\cleaned_donorlist.csv
2025/03/04 02:30:02 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_data.csv', 'load_donorlist_data_last_modified'), kwargs={}
2025/03/04 02:30:02 PM INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 02:30:02 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_data.csv',), kwargs={}
2025/03/04 02:30:02 PM INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 02:30:02 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:30:02 PM INFO:Current modification time: 1741098602.4656281
2025/03/04 02:30:02 PM INFO:Last modification time: None
2025/03/04 02:30:02 PM INFO:is_file_updated executed successfully
2025/03/04 02:30:02 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:30:02 PM INFO:Donor data saved to output\cleaned_donorlist.csv
2025/03/04 02:30:02 PM INFO:Donor Data summary completed
2025/03/04 02:30:02 PM INFO:Data shape: (25576, 5)
2025/03/04 02:30:02 PM INFO:load_donorList_data executed successfully
2025/03/04 02:30:02 PM INFO:get_donor_data executed successfully
2025/03/04 02:30:02 PM INFO:load_data_to_session executed successfully
2025/03/04 02:30:02 PM DEBUG:st.session_state.data_donor: 25576
2025/03/04 02:30:02 PM DEBUG:st.session_state.data_clean: 65278
2025/03/04 02:30:02 PM DEBUG:Calling load_data_to_session with args=('data_regentity', <function get_regentity_data at 0x000001FD8719C160>), kwargs={}
2025/03/04 02:30:02 PM DEBUG:Calling get_regentity_data with args=(), kwargs={}
2025/03/04 02:30:02 PM DEBUG:Calling load_regulated_entity_data with args=(), kwargs={'main_file': 'data_clean', 'cleaned_file': 'data_regentity', 'streamlitrun': True, 'output_csv': True, 'originaldatafilepath': 'cleaned_data_fname', 'cleaneddatafilepath': 'cleaned_regentity_fname'}
2025/03/04 02:30:02 PM DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_data.csv', 'savedfilepath': 'output\\cleaned_regentity.csv', 'timestamp_key': 'load_donorlist_data_last_modified'}
2025/03/04 02:30:02 PM INFO:Original file path: output\cleaned_data.csv
2025/03/04 02:30:02 PM INFO:Saved file path: output\cleaned_regentity.csv
2025/03/04 02:30:02 PM DEBUG:Calling is_file_updated with args=('output\\cleaned_data.csv', 'load_donorlist_data_last_modified'), kwargs={}
2025/03/04 02:30:02 PM INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 02:30:02 PM DEBUG:Calling get_file_modification_time with args=('output\\cleaned_data.csv',), kwargs={}
2025/03/04 02:30:02 PM INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 02:30:02 PM INFO:get_file_modification_time executed successfully
2025/03/04 02:30:02 PM INFO:Current modification time: 1741098602.4656281
2025/03/04 02:30:02 PM INFO:Last modification time: 1741098602.4656281
2025/03/04 02:30:02 PM INFO:is_file_updated executed successfully
2025/03/04 02:30:02 PM INFO:Loading preprocessed data. Using output\cleaned_regentity.csv dated load_donorlist_data_last_modified instead of output\cleaned_data.csv
2025/03/04 02:30:02 PM INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:30:02 PM INFO:load_regulated_entity_data executed successfully
2025/03/04 02:30:02 PM INFO:get_regentity_data executed successfully
2025/03/04 02:30:02 PM INFO:load_data_to_session executed successfully
2025/03/04 02:30:02 PM DEBUG:st.session_state.data_regentity: 1364
2025/03/04 02:30:02 PM DEBUG:st.session_state.data_donor: 25576
2025/03/04 02:30:02 PM DEBUG:st.session_state.data_clean: 65278
2025/03/04 02:30:02 PM INFO:firstload executed successfully
2025/03/04 02:30:02 PM INFO:Data first load completed successfully.
2025/03/04 02:30:02 PM INFO:initialise_data executed successfully
2025/03/04 02:30:02 PM INFO:App is fully loaded and ready!
2025/03/04 02:35:51 PM INFO:Logging is set up correctly! Current log level: ERROR
2025/03/04 02:35:51 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\utils',), kwargs={}
2025/03/04 02:35:51 PM INFO:get_git_version executed successfully
2025/03/04 02:35:51 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\data',), kwargs={}
2025/03/04 02:35:51 PM INFO:get_git_version executed successfully
2025/03/04 02:35:51 PM INFO:Streamlit App Starting...
2025/03/04 02:35:51 PM INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 02:35:51 PM INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 02:35:51 PM INFO:Running App setup...
2025/03/04 02:35:51 PM DEBUG:Calling setup_package with args=(), kwargs={}
2025/03/04 02:35:51 PM INFO:Setting up the package
2025/03/04 02:35:51 PM INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 02:35:51 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1',), kwargs={}
2025/03/04 02:35:51 PM INFO:get_git_version executed successfully
2025/03/04 02:35:51 PM INFO:Version: v20.143
2025/03/04 02:35:51 PM DEBUG:Calling initialize_session_state with args=(), kwargs={}
2025/03/04 02:35:51 PM INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:35:51 PM DEBUG:LOG_LEVEL already exists in session state
2025/03/04 02:35:51 PM DEBUG:BASE_DIR already exists in session state
2025/03/04 02:35:51 PM DEBUG:filenames already exists in session state
2025/03/04 02:35:51 PM DEBUG:PLACEHOLDER_DATE already exists in session state
2025/03/04 02:35:51 PM DEBUG:PLACEHOLDER_ID already exists in session state
2025/03/04 02:35:51 PM DEBUG:thresholds already exists in session state
2025/03/04 02:35:51 PM DEBUG:data_remappings already exists in session state
2025/03/04 02:35:51 PM DEBUG:filter_def already exists in session state
2025/03/04 02:35:51 PM DEBUG:security already exists in session state
2025/03/04 02:35:51 PM DEBUG:perc_target already exists in session state
2025/03/04 02:35:51 PM DEBUG:RERUN_MP_PARTY_MEMBERSHIP already exists in session state
2025/03/04 02:35:51 PM DEBUG:directories already exists in session state
2025/03/04 02:35:51 PM DEBUG:reference_dir already exists in session state
2025/03/04 02:35:51 PM DEBUG:data_dir already exists in session state
2025/03/04 02:35:51 PM DEBUG:output_dir already exists in session state
2025/03/04 02:35:51 PM DEBUG:logs_dir already exists in session state
2025/03/04 02:35:51 PM DEBUG:components_dir already exists in session state
2025/03/04 02:35:51 PM DEBUG:app_pages_dir already exists in session state
2025/03/04 02:35:51 PM DEBUG:utils_dir already exists in session state
2025/03/04 02:35:51 PM DEBUG:Donor_dedupe_cleaned_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:ListofPoliticalPeople_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:mppartymemb_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:donor_map_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:politician_party_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:regentity_map_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:original_data_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:CREDENTIALS_FILE already exists in session state
2025/03/04 02:35:51 PM DEBUG:TEXT_FILE already exists in session state
2025/03/04 02:35:51 PM DEBUG:ELECTION_DATES already exists in session state
2025/03/04 02:35:51 PM DEBUG:cleaned_data_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:cleaned_donations_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:cleaned_donorlist_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:cleaned_regentity_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:party_summary_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:imported_raw_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:source_data_fname already exists in session state
2025/03/04 02:35:51 PM DEBUG:Cash_ftr already exists in session state
2025/03/04 02:35:51 PM INFO:Session_state variables initialized
2025/03/04 02:35:51 PM DEBUG:menu_selection: {'title': 'Head Line Figures', 'function': <function hlf_body at 0x000001FD86EEAD40>}
2025/03/04 02:35:51 PM DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:35:51 PM DEBUG:perc_target: 0.5
2025/03/04 02:35:51 PM DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:35:51 PM DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:35:51 PM DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:35:51 PM DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:35:51 PM DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 02:35:51 PM DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:35:51 PM DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:35:51 PM DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 02:35:51 PM DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 02:35:51 PM DEBUG:election_dates_last_modified: 1740757862.6744745
2025/03/04 02:35:51 PM DEBUG:data_clean:            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                    15                   4710                        2                       363
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                    15                   4710                        2                       363
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                    15                   4710                        2                       363
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                    15                   4710                        2                       363
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                    15                   4709                        2                       363
...          ...                              ...                    ...        ...  ...                   ...                    ...                      ...                       ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                    62                   4532                        5                       349
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                    70                   4524                        6                       348
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    51                   4543                        4                       350
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                     2                   4591                        1                       354
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                     2                   4592                        1                       354

[65278 rows x 55 columns]
2025/03/04 02:35:51 PM DEBUG:utils_dir: utils
2025/03/04 02:35:51 PM DEBUG:raw_data_clean:            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns]
2025/03/04 02:35:51 PM DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 02:35:51 PM DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 02:35:51 PM DEBUG:output_dir: output
2025/03/04 02:35:51 PM DEBUG:components_dir: components
2025/03/04 02:35:51 PM DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 02:35:51 PM DEBUG:load_donorlist_data_last_modified: 1741098602.4656281
2025/03/04 02:35:51 PM DEBUG:data_dir: data
2025/03/04 02:35:51 PM DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:35:51 PM DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 02:35:51 PM DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:35:51 PM DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:35:51 PM DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 02:35:51 PM DEBUG:load_raw_data_last_modified: 1741098578.9435186
2025/03/04 02:35:51 PM DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:35:51 PM DEBUG:LOG_LEVEL: ERROR
2025/03/04 02:35:51 PM DEBUG:raw_data:            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...                 CleanedDonorName CleanedDonorId  DonorId                        DonorName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
...          ...                              ...                    ...        ...  ...                              ...            ...      ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...      Shaftesbury Investments Ltd        74198.0  74198.0      Shaftesbury Investments Ltd
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                Mr Jeremy Hosking        74184.0  74184.0                Mr Jeremy Hosking
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    Anthony Clake        23556.0  23556.0                    Anthony Clake
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                Mr Peter A Dubens         2146.0   2146.0                Mr Peter A Dubens
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                 Mr Ravi S Kailas        74743.0  74743.0                 Mr Ravi S Kailas

[65278 rows x 37 columns]
2025/03/04 02:35:51 PM DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:35:51 PM DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:35:51 PM DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 02:35:51 PM DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 02:35:51 PM DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 02:35:51 PM DEBUG:reference_dir: reference_files
2025/03/04 02:35:51 PM DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 02:35:51 PM DEBUG:data_regentity:       RegulatedEntityId                              Regulated Entity Name  Regulated Entity Group  Donations Value  Donation Events  Donation Mean
0                  17.0                                  English Democrats            Small Entity         99000.00               11    9000.000000
1                  19.0                         Legalise Cannabis Alliance            Small Entity         35500.00               13    2730.769231
2                  30.0        Upminster And Cranham Residents Association  Single Donation Entity         10000.00                1   10000.000000
3                  39.0                                          Sinn Féin     Medium Large Entity       2506699.11              359    6982.448774
4                  44.0  Independent Kidderminster Hospital And Health ...            Small Entity         31949.00                8    3993.625000
...                 ...                                                ...                     ...              ...              ...            ...
1359            10263.0                                    Jonathan Gullis  Single Donation Entity          2500.00                1    2500.000000
1360            10264.0                                      Robert Largan  Single Donation Entity          2000.00                1    2000.000000
1361            10265.0                                         Jane Dodds       Very Small Entity          3529.41                2    1764.705000
1362            10266.0                                        Phil Wilson  Single Donation Entity          2000.00                1    2000.000000
1363            10267.0                Scottish Unionist Association Trust       Very Small Entity        218870.07                3   72956.690000

[1364 rows x 6 columns]
2025/03/04 02:35:51 PM DEBUG:logs_dir: logs
2025/03/04 02:35:51 PM DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 02:35:51 PM DEBUG:data_donor:          DonorId                          Donor Name  Donations Value  Donation Events  Donation Mean
0            1.0    Joseph Rowntree Refrom Trust Ltd         53000.00                2   26500.000000
1            2.0    Birkenhead North End Labour Club        118680.84                2   59340.420000
2            3.0                Bord Institute Trust         26625.00                3    8875.000000
3            4.0        Branksome Liberal Club Trust         74495.89               14    5321.135000
4            5.0                    Bridgwater Trust          7700.00                3    2566.666667
...          ...                                 ...              ...              ...            ...
25571    87478.0                       Martin Thomas          3529.41                2    1764.705000
25572    87479.0                    Ishbel A Mcneill         11520.00                1   11520.000000
25573    87480.0                           Ann C Hay        157350.07                1  157350.070000
25574    87482.0  Glasgow Unionist Association Trust         50000.00                1   50000.000000
25575  1000001.0                  Unidentified Donor        697021.67               84    8297.877024

[25576 rows x 5 columns]
2025/03/04 02:35:51 PM DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:35:51 PM DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 02:35:51 PM DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 02:35:51 PM DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 02:35:51 PM DEBUG:app_pages_dir: app_pages
2025/03/04 02:35:51 PM INFO:Session state Setup complete
2025/03/04 02:35:51 PM INFO:initialize_session_state executed successfully
2025/03/04 02:35:51 PM INFO:Package setup complete
2025/03/04 02:35:51 PM INFO:setup_package executed successfully
2025/03/04 02:35:51 PM INFO:Setup completed successfully.
2025/03/04 02:35:51 PM INFO:Running Menu setup...
2025/03/04 02:35:51 PM DEBUG:Calling pagesetup with args=(), kwargs={}
2025/03/04 02:35:51 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\app_pages',), kwargs={}
2025/03/04 02:35:51 PM INFO:get_git_version executed successfully
2025/03/04 02:35:51 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\components',), kwargs={}
2025/03/04 02:35:51 PM INFO:get_git_version executed successfully
2025/03/04 02:35:51 PM DEBUG:Calling get_git_version with args=(), kwargs={}
2025/03/04 02:35:51 PM INFO:get_git_version executed successfully
2025/03/04 02:35:51 PM INFO:App Version: v20.164
2025/03/04 02:35:51 PM INFO:Switched to page: Head Line Figures
2025/03/04 02:35:51 PM DEBUG:Calling hlf_body with args=(), kwargs={}
2025/03/04 02:35:51 PM DEBUG:Calling load_and_filter_data with args=(), kwargs={'filter_key': None, 'pagereflabel': 'headlinefigures'}
2025/03/04 02:35:51 PM INFO:load_and_filter_data executed successfully
2025/03/04 02:35:51 PM DEBUG:Calling display_summary_statistics with args=(           ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                    15                   4710                        2                       363
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                    15                   4710                        2                       363
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                    15                   4710                        2                       363
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                    15                   4710                        2                       363
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                    15                   4709                        2                       363
...          ...                              ...                    ...        ...  ...                   ...                    ...                      ...                       ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                    62                   4532                        5                       349
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                    70                   4524                        6                       348
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    51                   4543                        4                       350
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                     2                   4591                        1                       354
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                     2                   4592                        1                       354

[65278 rows x 55 columns],            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                    15                   4710                        2                       363
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                    15                   4710                        2                       363
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                    15                   4710                        2                       363
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                    15                   4710                        2                       363
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                    15                   4709                        2                       363
...          ...                              ...                    ...        ...  ...                   ...                    ...                      ...                       ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                    62                   4532                        5                       349
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                    70                   4524                        6                       348
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    51                   4543                        4                       350
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                     2                   4591                        1                       354
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                     2                   4592                        1                       354

[65278 rows x 55 columns], 'Political Donations', 'headlinefigures'), kwargs={}
2025/03/04 02:35:51 PM INFO:display_summary_statistics executed successfully
2025/03/04 02:35:51 PM DEBUG:Calling plot_bar_line_by_year with args=(           ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                    15                   4710                        2                       363
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                    15                   4710                        2                       363
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                    15                   4710                        2                       363
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                    15                   4710                        2                       363
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                    15                   4709                        2                       363
...          ...                              ...                    ...        ...  ...                   ...                    ...                      ...                       ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                    62                   4532                        5                       349
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                    70                   4524                        6                       348
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    51                   4543                        4                       350
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                     2                   4591                        1                       354
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                     2                   4592                        1                       354

[65278 rows x 55 columns],), kwargs={'XValues': 'YearReceived', 'YValues': 'EventCount', 'GroupData': 'RegulatedEntityType', 'XLabel': 'Year', 'YLabel': 'Donations', 'Title': 'Donations per Year & Entity Type', 'CalcType': 'sum', 'LegendTitle': 'Regulated Entity Type', 'widget_key': 'dons_by_year_n_entity'}
2025/03/04 02:35:52 PM INFO:plot_bar_line_by_year executed successfully
2025/03/04 02:35:52 PM DEBUG:Calling plot_bar_line_by_year with args=(           ECRef                OriginalRegulatedEntityName RegulatedEntityType    Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
77980   U0034053                               Labour Party     Political Party   400.00  ...                    11                   3748                        1                       289
77965  TV0036256                           Yes Campaign Ltd         Third Party   668.00  ...                   192                   3771                       15                       291
78094  TV0036257  British Declaration Of Independence [The]         Third Party  1500.00  ...                   192                   3771                       15                       291
78329  TV0036260        Campaign For An Independent Britain         Third Party  1450.00  ...                   180                   3783                       14                       291
78638  TV0036259                                 Charter 88         Third Party  1500.00  ...                   191                   3772                       15                       291
...          ...                                        ...                 ...      ...  ...                   ...                    ...                      ...                       ...
4350    V0405916                           Elisha Mccallion     Regulated Donee  1809.74  ...                    31                   4693                        3                       361
4598    V0405912                               Mickey Brady     Regulated Donee  1922.10  ...                    31                   4693                        3                       361
6096    V0405918                           Mr Chris Hazzard     Regulated Donee  3030.00  ...                    31                   4693                        3                       361
7073    V0403834                              Mr Afzal Khan     Regulated Donee  1800.00  ...                    44                   4681                        4                       361
7075    V0403400                       Ms Yasmin Qureshi Mp     Regulated Donee  1800.00  ...                    47                   4678                        4                       360

[65278 rows x 55 columns],), kwargs={'XValues': 'YearReceived', 'YValues': 'Value', 'GroupData': 'Data Safety Score', 'XLabel': 'Year', 'YLabel': 'Donations', 'Title': 'Donations Risk Score by Year', 'CalcType': 'sum', 'LegendTitle': 'Data Safety Score', 'ChartType': 'line', 'y_scale': 'linear', 'widget_key': 'dons_by_year_n_type'}
2025/03/04 02:35:52 PM INFO:plot_bar_line_by_year executed successfully
2025/03/04 02:35:52 PM DEBUG:Calling plot_bar_line_by_year with args=(           ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                    15                   4710                        2                       363
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                    15                   4710                        2                       363
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                    15                   4710                        2                       363
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                    15                   4710                        2                       363
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                    15                   4709                        2                       363
...          ...                              ...                    ...        ...  ...                   ...                    ...                      ...                       ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                    62                   4532                        5                       349
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                    70                   4524                        6                       348
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    51                   4543                        4                       350
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                     2                   4591                        1                       354
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                     2                   4592                        1                       354

[65278 rows x 55 columns],), kwargs={'XValues': 'YearReceived', 'YValues': 'Value', 'GroupData': 'RegEntity_Group', 'XLabel': 'Year', 'YLabel': "Value of Donations £ 000's", 'Title': 'Donations GBP by Year & Entity', 'use_custom_colors': False, 'LegendTitle': 'Regulated Entity', 'widget_key': 'value_by_year_n_entity', 'CalcType': 'sum'}
2025/03/04 02:35:52 PM INFO:plot_bar_line_by_year executed successfully
2025/03/04 02:35:52 PM DEBUG:Calling plot_bar_line_by_year with args=(           ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                    15                   4710                        2                       363
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                    15                   4710                        2                       363
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                    15                   4710                        2                       363
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                    15                   4710                        2                       363
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                    15                   4709                        2                       363
...          ...                              ...                    ...        ...  ...                   ...                    ...                      ...                       ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                    62                   4532                        5                       349
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                    70                   4524                        6                       348
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    51                   4543                        4                       350
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                     2                   4591                        1                       354
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                     2                   4592                        1                       354

[65278 rows x 55 columns],), kwargs={'XValues': 'YearReceived', 'YValues': 'Value', 'GroupData': 'DonationType', 'XLabel': 'Year', 'YLabel': 'Total Value (£)', 'y_scale': 'log', 'ChartType': 'Line', 'LegendTitle': 'Donation Type', 'Title': 'Donations GBP Types by Year', 'widget_key': 'value_by_year_n_type', 'CalcType': 'sum'}
2025/03/04 02:35:52 PM INFO:plot_bar_line_by_year executed successfully
2025/03/04 02:35:52 PM INFO:hlf_body executed successfully
2025/03/04 02:35:52 PM INFO:pagesetup executed successfully
2025/03/04 02:35:52 PM INFO:Menu setup completed successfully.
2025/03/04 02:35:52 PM INFO:Data already loaded in session state.
2025/03/04 02:35:52 PM INFO:App is fully loaded and ready!
2025/03/04 02:35:55 PM INFO:Streamlit App Starting...
2025/03/04 02:35:55 PM INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 02:35:55 PM INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 02:35:55 PM INFO:Running App setup...
2025/03/04 02:35:55 PM DEBUG:Calling setup_package with args=(), kwargs={}
2025/03/04 02:35:55 PM INFO:Setting up the package
2025/03/04 02:35:55 PM INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 02:35:55 PM DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1',), kwargs={}
2025/03/04 02:35:55 PM INFO:get_git_version executed successfully
2025/03/04 02:35:55 PM INFO:Version: v20.143
2025/03/04 02:35:55 PM DEBUG:Calling initialize_session_state with args=(), kwargs={}
2025/03/04 02:35:55 PM INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:35:55 PM DEBUG:LOG_LEVEL already exists in session state
2025/03/04 02:35:55 PM DEBUG:BASE_DIR already exists in session state
2025/03/04 02:35:55 PM DEBUG:filenames already exists in session state
2025/03/04 02:35:55 PM DEBUG:PLACEHOLDER_DATE already exists in session state
2025/03/04 02:35:55 PM DEBUG:PLACEHOLDER_ID already exists in session state
2025/03/04 02:35:55 PM DEBUG:thresholds already exists in session state
2025/03/04 02:35:55 PM DEBUG:data_remappings already exists in session state
2025/03/04 02:35:55 PM DEBUG:filter_def already exists in session state
2025/03/04 02:35:55 PM DEBUG:security already exists in session state
2025/03/04 02:35:55 PM DEBUG:perc_target already exists in session state
2025/03/04 02:35:55 PM DEBUG:RERUN_MP_PARTY_MEMBERSHIP already exists in session state
2025/03/04 02:35:55 PM DEBUG:directories already exists in session state
2025/03/04 02:35:55 PM DEBUG:reference_dir already exists in session state
2025/03/04 02:35:55 PM DEBUG:data_dir already exists in session state
2025/03/04 02:35:55 PM DEBUG:output_dir already exists in session state
2025/03/04 02:35:55 PM DEBUG:logs_dir already exists in session state
2025/03/04 02:35:55 PM DEBUG:components_dir already exists in session state
2025/03/04 02:35:55 PM DEBUG:app_pages_dir already exists in session state
2025/03/04 02:35:55 PM DEBUG:utils_dir already exists in session state
2025/03/04 02:35:55 PM DEBUG:Donor_dedupe_cleaned_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:ListofPoliticalPeople_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:mppartymemb_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:donor_map_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:politician_party_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:regentity_map_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:original_data_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:CREDENTIALS_FILE already exists in session state
2025/03/04 02:35:55 PM DEBUG:TEXT_FILE already exists in session state
2025/03/04 02:35:55 PM DEBUG:ELECTION_DATES already exists in session state
2025/03/04 02:35:55 PM DEBUG:cleaned_data_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:cleaned_donations_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:cleaned_donorlist_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:cleaned_regentity_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:party_summary_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:imported_raw_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:source_data_fname already exists in session state
2025/03/04 02:35:55 PM DEBUG:Cash_ftr already exists in session state
2025/03/04 02:35:55 PM INFO:Session_state variables initialized
2025/03/04 02:35:55 PM DEBUG:menu_selection: {'title': 'Paid Visits', 'function': <function mod_visits_page at 0x000001FD8E2605E0>}
2025/03/04 02:35:55 PM DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:35:55 PM DEBUG:perc_target: 0.5
2025/03/04 02:35:55 PM DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:35:55 PM DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:35:55 PM DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:35:55 PM DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:35:55 PM DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 02:35:55 PM DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:35:55 PM DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:35:55 PM DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 02:35:55 PM DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 02:35:55 PM DEBUG:election_dates_last_modified: 1740757862.6744745
2025/03/04 02:35:55 PM DEBUG:data_clean:            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                    15                   4710                        2                       363
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                    15                   4710                        2                       363
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                    15                   4710                        2                       363
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                    15                   4710                        2                       363
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                    15                   4709                        2                       363
...          ...                              ...                    ...        ...  ...                   ...                    ...                      ...                       ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                    62                   4532                        5                       349
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                    70                   4524                        6                       348
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    51                   4543                        4                       350
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                     2                   4591                        1                       354
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                     2                   4592                        1                       354

[65278 rows x 55 columns]
2025/03/04 02:35:55 PM DEBUG:utils_dir: utils
2025/03/04 02:35:55 PM DEBUG:year_slider_dons_by_year_n_type: (2001, 2019)
2025/03/04 02:35:55 PM DEBUG:raw_data_clean:            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns]
2025/03/04 02:35:55 PM DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 02:35:55 PM DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 02:35:55 PM DEBUG:output_dir: output
2025/03/04 02:35:55 PM DEBUG:components_dir: components
2025/03/04 02:35:55 PM DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 02:35:55 PM DEBUG:load_donorlist_data_last_modified: 1741098602.4656281
2025/03/04 02:35:55 PM DEBUG:data_dir: data
2025/03/04 02:35:55 PM DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:35:55 PM DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 02:35:55 PM DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:35:55 PM DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:35:55 PM DEBUG:year_slider_dons_by_year_n_entity: (2001, 2019)
2025/03/04 02:35:55 PM DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 02:35:55 PM DEBUG:year_slider_value_by_year_n_entity: (2001, 2019)
2025/03/04 02:35:55 PM DEBUG:load_raw_data_last_modified: 1741098578.9435186
2025/03/04 02:35:55 PM DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:35:55 PM DEBUG:LOG_LEVEL: ERROR
2025/03/04 02:35:55 PM DEBUG:raw_data:            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...                 CleanedDonorName CleanedDonorId  DonorId                        DonorName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
...          ...                              ...                    ...        ...  ...                              ...            ...      ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...      Shaftesbury Investments Ltd        74198.0  74198.0      Shaftesbury Investments Ltd
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                Mr Jeremy Hosking        74184.0  74184.0                Mr Jeremy Hosking
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    Anthony Clake        23556.0  23556.0                    Anthony Clake
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                Mr Peter A Dubens         2146.0   2146.0                Mr Peter A Dubens
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                 Mr Ravi S Kailas        74743.0  74743.0                 Mr Ravi S Kailas

[65278 rows x 37 columns]
2025/03/04 02:35:55 PM DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:35:55 PM DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:35:55 PM DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 02:35:55 PM DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 02:35:55 PM DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 02:35:55 PM DEBUG:reference_dir: reference_files
2025/03/04 02:35:55 PM DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 02:35:55 PM DEBUG:data_regentity:       RegulatedEntityId                              Regulated Entity Name  Regulated Entity Group  Donations Value  Donation Events  Donation Mean
0                  17.0                                  English Democrats            Small Entity         99000.00               11    9000.000000
1                  19.0                         Legalise Cannabis Alliance            Small Entity         35500.00               13    2730.769231
2                  30.0        Upminster And Cranham Residents Association  Single Donation Entity         10000.00                1   10000.000000
3                  39.0                                          Sinn Féin     Medium Large Entity       2506699.11              359    6982.448774
4                  44.0  Independent Kidderminster Hospital And Health ...            Small Entity         31949.00                8    3993.625000
...                 ...                                                ...                     ...              ...              ...            ...
1359            10263.0                                    Jonathan Gullis  Single Donation Entity          2500.00                1    2500.000000
1360            10264.0                                      Robert Largan  Single Donation Entity          2000.00                1    2000.000000
1361            10265.0                                         Jane Dodds       Very Small Entity          3529.41                2    1764.705000
1362            10266.0                                        Phil Wilson  Single Donation Entity          2000.00                1    2000.000000
1363            10267.0                Scottish Unionist Association Trust       Very Small Entity        218870.07                3   72956.690000

[1364 rows x 6 columns]
2025/03/04 02:35:55 PM DEBUG:logs_dir: logs
2025/03/04 02:35:55 PM DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 02:35:55 PM DEBUG:data_donor:          DonorId                          Donor Name  Donations Value  Donation Events  Donation Mean
0            1.0    Joseph Rowntree Refrom Trust Ltd         53000.00                2   26500.000000
1            2.0    Birkenhead North End Labour Club        118680.84                2   59340.420000
2            3.0                Bord Institute Trust         26625.00                3    8875.000000
3            4.0        Branksome Liberal Club Trust         74495.89               14    5321.135000
4            5.0                    Bridgwater Trust          7700.00                3    2566.666667
...          ...                                 ...              ...              ...            ...
25571    87478.0                       Martin Thomas          3529.41                2    1764.705000
25572    87479.0                    Ishbel A Mcneill         11520.00                1   11520.000000
25573    87480.0                           Ann C Hay        157350.07                1  157350.070000
25574    87482.0  Glasgow Unionist Association Trust         50000.00                1   50000.000000
25575  1000001.0                  Unidentified Donor        697021.67               84    8297.877024

[25576 rows x 5 columns]
2025/03/04 02:35:55 PM DEBUG:year_slider_value_by_year_n_type: (2001, 2019)
2025/03/04 02:35:55 PM DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:35:55 PM DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 02:35:55 PM DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 02:35:55 PM DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 02:35:55 PM DEBUG:app_pages_dir: app_pages
2025/03/04 02:35:55 PM INFO:Session state Setup complete
2025/03/04 02:35:55 PM INFO:initialize_session_state executed successfully
2025/03/04 02:35:55 PM INFO:Package setup complete
2025/03/04 02:35:55 PM INFO:setup_package executed successfully
2025/03/04 02:35:55 PM INFO:Setup completed successfully.
2025/03/04 02:35:55 PM INFO:Running Menu setup...
2025/03/04 02:35:55 PM DEBUG:Calling pagesetup with args=(), kwargs={}
2025/03/04 02:35:55 PM DEBUG:Calling get_git_version with args=(), kwargs={}
2025/03/04 02:35:55 PM INFO:get_git_version executed successfully
2025/03/04 02:35:55 PM INFO:App Version: v20.164
2025/03/04 02:35:55 PM INFO:Switched to page: Paid Visits
2025/03/04 02:35:55 PM DEBUG:Calling display_data_page with args=(), kwargs={'filter_key': 'DonatedVisits_ftr', 'target_label': 'Donated Visit'}
2025/03/04 02:35:55 PM DEBUG:Calling load_and_filter_data with args=('DonatedVisits_ftr', 'filtered_keytarget_label'), kwargs={}
2025/03/04 02:35:55 PM INFO:load_and_filter_data executed successfully
2025/03/04 02:35:56 PM DEBUG:Calling display_summary_statistics with args=(          ECRef   OriginalRegulatedEntityName RegulatedEntityType    Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
10     V0408145             Mr John Howell Mp     Regulated Donee  7085.46  ...                    16                   4709                        2                       363
21     V0408129          Mr Andrew Bridgen Mp     Regulated Donee  3300.00  ...                    17                   4708                        2                       363
22     V0408190            Sir David Amess Mp     Regulated Donee  2553.00  ...                    16                   4709                        2                       363
23     V0408181           Mr Jonathan Buckley     Regulated Donee  8500.00  ...                    15                   4710                        2                       363
50     V0407538                  Scott Benton     Regulated Donee  2500.00  ...                    18                   4707                        2                       363
...         ...                           ...                 ...      ...  ...                   ...                    ...                      ...                       ...
75029  V0032900          Mr Parmjit Dhanda Mp     Regulated Donee  2000.00  ...                   179                   3784                       14                       292
75048  V0032318  The Rt Hon George Osborne Mp     Regulated Donee  1891.60  ...                   179                   3784                       14                       292
75486  V0032453           Ms Jean Lambert Mep     Regulated Donee   369.24  ...                   192                   3771                       15                       291
76549  V0032219        Lord Richard Inglewood     Regulated Donee  3500.00  ...                     1                   3758                        1                       290
76866  V0032217                  Mr Roy Perry     Regulated Donee  3000.00  ...                     6                   3753                        1                       289

[2634 rows x 55 columns],            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                    15                   4710                        2                       363
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                    15                   4710                        2                       363
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                    15                   4710                        2                       363
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                    15                   4710                        2                       363
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                    15                   4709                        2                       363
...          ...                              ...                    ...        ...  ...                   ...                    ...                      ...                       ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                    62                   4532                        5                       349
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                    70                   4524                        6                       348
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    51                   4543                        4                       350
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                     2                   4591                        1                       354
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                     2                   4592                        1                       354

[65278 rows x 55 columns], 'Donated Visit', 'filtered_keytarget_label'), kwargs={}
2025/03/04 02:35:56 PM INFO:display_summary_statistics executed successfully
2025/03/04 02:35:56 PM DEBUG:Calling display_textual_insights with args=('filtered_keytarget_label', 'Donated Visit', datetime.date(2001, 5, 1), datetime.date(2019, 9, 2), {'unique_reg_entities': 782, 'unique_donors': 1090, 'unique_donations': np.int64(2634), 'total_value': np.float64(9104411.74), 'mean_value': np.float64(3456.4964844343203), 'avg_donations_per_entity': np.float64(3.368286445012788), 'avg_value_per_entity': np.float64(3317.508958584289), 'avg_donors_per_entity': np.float64(2.9859335038363173), 'donors_stdev': np.float64(4.111433342258073), 'value_stdev': np.float64(1819.604968674955), 'noofdonors_per_ent_stdev': np.float64(3.2925721060711166)}, {'unique_reg_entities': 1361, 'unique_donors': 24834, 'unique_donations': np.int64(65278), 'total_value': np.float64(1091979899.03), 'mean_value': np.float64(16728.14576166549), 'avg_donations_per_entity': np.float64(47.85777126099707), 'avg_value_per_entity': np.float64(9368.670870011012), 'avg_donors_per_entity': np.float64(20.80058651026393), 'donors_stdev': np.float64(809.8426322896477), 'value_stdev': np.float64(59822.87214600705), 'noofdonors_per_ent_stdev': np.float64(322.8954476447556)}, 0.5), kwargs={}
2025/03/04 02:35:56 PM INFO:display_textual_insights executed successfully
2025/03/04 02:35:56 PM DEBUG:Calling display_visualizations with args=(          ECRef   OriginalRegulatedEntityName RegulatedEntityType    Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
10     V0408145             Mr John Howell Mp     Regulated Donee  7085.46  ...                    16                   4709                        2                       363
21     V0408129          Mr Andrew Bridgen Mp     Regulated Donee  3300.00  ...                    17                   4708                        2                       363
22     V0408190            Sir David Amess Mp     Regulated Donee  2553.00  ...                    16                   4709                        2                       363
23     V0408181           Mr Jonathan Buckley     Regulated Donee  8500.00  ...                    15                   4710                        2                       363
50     V0407538                  Scott Benton     Regulated Donee  2500.00  ...                    18                   4707                        2                       363
...         ...                           ...                 ...      ...  ...                   ...                    ...                      ...                       ...
75029  V0032900          Mr Parmjit Dhanda Mp     Regulated Donee  2000.00  ...                   179                   3784                       14                       292
75048  V0032318  The Rt Hon George Osborne Mp     Regulated Donee  1891.60  ...                   179                   3784                       14                       292
75486  V0032453           Ms Jean Lambert Mep     Regulated Donee   369.24  ...                   192                   3771                       15                       291
76549  V0032219        Lord Richard Inglewood     Regulated Donee  3500.00  ...                     1                   3758                        1                       290
76866  V0032217                  Mr Roy Perry     Regulated Donee  3000.00  ...                     6                   3753                        1                       289

[2634 rows x 55 columns], 'Donated Visit', 'filtered_keytarget_label'), kwargs={}
2025/03/04 02:35:56 PM DEBUG:Calling plot_bar_line_by_year with args=(          ECRef   OriginalRegulatedEntityName RegulatedEntityType    Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
10     V0408145             Mr John Howell Mp     Regulated Donee  7085.46  ...                    16                   4709                        2                       363
21     V0408129          Mr Andrew Bridgen Mp     Regulated Donee  3300.00  ...                    17                   4708                        2                       363
22     V0408190            Sir David Amess Mp     Regulated Donee  2553.00  ...                    16                   4709                        2                       363
23     V0408181           Mr Jonathan Buckley     Regulated Donee  8500.00  ...                    15                   4710                        2                       363
50     V0407538                  Scott Benton     Regulated Donee  2500.00  ...                    18                   4707                        2                       363
...         ...                           ...                 ...      ...  ...                   ...                    ...                      ...                       ...
75029  V0032900          Mr Parmjit Dhanda Mp     Regulated Donee  2000.00  ...                   179                   3784                       14                       292
75048  V0032318  The Rt Hon George Osborne Mp     Regulated Donee  1891.60  ...                   179                   3784                       14                       292
75486  V0032453           Ms Jean Lambert Mep     Regulated Donee   369.24  ...                   192                   3771                       15                       291
76549  V0032219        Lord Richard Inglewood     Regulated Donee  3500.00  ...                     1                   3758                        1                       290
76866  V0032217                  Mr Roy Perry     Regulated Donee  3000.00  ...                     6                   3753                        1                       289

[2634 rows x 55 columns],), kwargs={'XValues': 'YearReceived', 'YValues': 'Value', 'GroupData': 'RegEntity_Group', 'XLabel': 'Year', 'YLabel': 'Value of Donations £', 'Title': 'Value of Donated Visits by Year and Entity', 'CalcType': 'sum', 'use_custom_colors': False, 'widget_key': 'leftfiltered_keytarget_label_vis', 'ChartType': 'Bar', 'LegendTitle': 'Political Entity Type', 'percentbars': True, 'y_scale': 'linear'}
2025/03/04 02:35:56 PM INFO:plot_bar_line_by_year executed successfully
2025/03/04 02:35:56 PM DEBUG:Calling plot_bar_line_by_year with args=(          ECRef   OriginalRegulatedEntityName RegulatedEntityType    Value  ... WeeksTillNextElection WeeksSinceLastElection QuartersTillNextElection QuartersSinceLastElection
10     V0408145             Mr John Howell Mp     Regulated Donee  7085.46  ...                    16                   4709                        2                       363
21     V0408129          Mr Andrew Bridgen Mp     Regulated Donee  3300.00  ...                    17                   4708                        2                       363
22     V0408190            Sir David Amess Mp     Regulated Donee  2553.00  ...                    16                   4709                        2                       363
23     V0408181           Mr Jonathan Buckley     Regulated Donee  8500.00  ...                    15                   4710                        2                       363
50     V0407538                  Scott Benton     Regulated Donee  2500.00  ...                    18                   4707                        2                       363
...         ...                           ...                 ...      ...  ...                   ...                    ...                      ...                       ...
75029  V0032900          Mr Parmjit Dhanda Mp     Regulated Donee  2000.00  ...                   179                   3784                       14                       292
75048  V0032318  The Rt Hon George Osborne Mp     Regulated Donee  1891.60  ...                   179                   3784                       14                       292
75486  V0032453           Ms Jean Lambert Mep     Regulated Donee   369.24  ...                   192                   3771                       15                       291
76549  V0032219        Lord Richard Inglewood     Regulated Donee  3500.00  ...                     1                   3758                        1                       290
76866  V0032217                  Mr Roy Perry     Regulated Donee  3000.00  ...                     6                   3753                        1                       289

[2634 rows x 55 columns],), kwargs={'XValues': 'YearReceived', 'YValues': 'EventCount', 'GroupData': 'RegEntity_Group', 'XLabel': 'Year', 'YLabel': 'Donations', 'Title': 'Donations of Donated Visits by Year and Entity', 'CalcType': 'sum', 'use_custom_colors': True, 'percentbars': False, 'LegendTitle': 'Political Entity', 'ChartType': 'line', 'y_scale': 'linear', 'widget_key': 'rightfiltered_keytarget_label_vis'}
2025/03/04 02:35:56 PM INFO:plot_bar_line_by_year executed successfully
2025/03/04 02:35:56 PM INFO:display_visualizations executed successfully
2025/03/04 02:35:56 PM INFO:display_data_page executed successfully
2025/03/04 02:35:56 PM INFO:pagesetup executed successfully
2025/03/04 02:35:56 PM INFO:Menu setup completed successfully.
2025/03/04 02:35:56 PM INFO:Data already loaded in session state.
2025/03/04 02:35:56 PM INFO:App is fully loaded and ready!
2025/03/04 02:36 INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 02:36 DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\utils',), kwargs={}
2025/03/04 02:36 INFO:get_git_version executed successfully
2025/03/04 02:36 DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\data',), kwargs={}
2025/03/04 02:36 INFO:get_git_version executed successfully
2025/03/04 02:36 INFO:Streamlit App Starting...
2025/03/04 02:36 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 02:36 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 02:36 INFO:Running App setup...
2025/03/04 02:36 DEBUG:Calling setup_package with args=(), kwargs={}
2025/03/04 02:36 INFO:Setting up the package
2025/03/04 02:36 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 02:36 DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1',), kwargs={}
2025/03/04 02:36 INFO:get_git_version executed successfully
2025/03/04 02:36 INFO:Version: v20.143
2025/03/04 02:36 DEBUG:Calling initialize_session_state with args=(), kwargs={}
2025/03/04 02:36 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:36 DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 02:36 DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 02:36 DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:36 DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 02:36 DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 02:36 DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:36 DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:36 DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:36 DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:36 DEBUG:Initialised perc_target with value: 0.5
2025/03/04 02:36 DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 02:36 DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:36 DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 02:36 DEBUG:Initialised data_dir with value: data
2025/03/04 02:36 DEBUG:Initialised output_dir with value: output
2025/03/04 02:36 DEBUG:Initialised logs_dir with value: logs
2025/03/04 02:36 DEBUG:Initialised components_dir with value: components
2025/03/04 02:36 DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 02:36 DEBUG:Initialised utils_dir with value: utils
2025/03/04 02:36 DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:36 DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:36 DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 02:36 DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:36 DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:36 DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:36 DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 02:36 DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 02:36 DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 02:36 DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 02:36 DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 02:36 DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 02:36 DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 02:36 DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 02:36 DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 02:36 DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 02:36 DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:36 DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 02:36 INFO:Session_state variables initialized
2025/03/04 02:36 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 02:36 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 02:36 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:36 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 02:36 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:36 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 02:36 DEBUG:components_dir: components
2025/03/04 02:36 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:36 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:36 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 02:36 DEBUG:data_dir: data
2025/03/04 02:36 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 02:36 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 02:36 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:36 DEBUG:logs_dir: logs
2025/03/04 02:36 DEBUG:app_pages_dir: app_pages
2025/03/04 02:36 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 02:36 DEBUG:perc_target: 0.5
2025/03/04 02:36 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:36 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 02:36 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:36 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:36 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:36 DEBUG:LOG_LEVEL: ERROR
2025/03/04 02:36 DEBUG:reference_dir: reference_files
2025/03/04 02:36 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:36 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 02:36 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 02:36 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 02:36 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 02:36 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:36 DEBUG:utils_dir: utils
2025/03/04 02:36 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 02:36 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:36 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:36 DEBUG:output_dir: output
2025/03/04 02:36 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:36 INFO:Session state Setup complete
2025/03/04 02:36 INFO:initialize_session_state executed successfully
2025/03/04 02:36 INFO:Package setup complete
2025/03/04 02:36 INFO:setup_package executed successfully
2025/03/04 02:36 INFO:Setup completed successfully.
2025/03/04 02:36 INFO:Running Menu setup...
2025/03/04 02:36 DEBUG:Calling pagesetup with args=(), kwargs={}
2025/03/04 02:36 DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\app_pages',), kwargs={}
2025/03/04 02:36 INFO:get_git_version executed successfully
2025/03/04 02:36 DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\components',), kwargs={}
2025/03/04 02:36 INFO:get_git_version executed successfully
2025/03/04 02:36 DEBUG:Calling get_git_version with args=(), kwargs={}
2025/03/04 02:36 INFO:get_git_version executed successfully
2025/03/04 02:36 INFO:App Version: v20.164
2025/03/04 02:36 INFO:Switched to page: Introduction
2025/03/04 02:36 INFO:pagesetup executed successfully
2025/03/04 02:36 INFO:Menu setup completed successfully.
2025/03/04 02:36 INFO:No data found in session state, running firstload()
2025/03/04 02:36 DEBUG:Calling initialise_data with args=(), kwargs={}
2025/03/04 02:36 INFO:Running first load function.
2025/03/04 02:36 DEBUG:Calling firstload with args=(), kwargs={}
2025/03/04 02:36 DEBUG:Calling load_data_to_session with args=('raw_data', <function get_raw_data at 0x000001FBF2C0F880>), kwargs={}
2025/03/04 02:36 DEBUG:Calling get_raw_data with args=(), kwargs={}
2025/03/04 02:36 DEBUG:Calling load_raw_data with args=(), kwargs={'main_file': 'raw_data', 'cleaned_file': 'raw_data_clean', 'output_csv': True, 'dedupe_donors': True, 'dedupe_regentity': True, 'originaldatafilepath': 'source_data_fname', 'processeddatafilepath': 'imported_raw_fname'}
2025/03/04 02:36 DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 02:36 DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 02:36 DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'output\\imported_raw.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:36 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:36 INFO:Saved file path: output\imported_raw.csv
2025/03/04 02:36 DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:36 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:36 DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:36 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:36 INFO:get_file_modification_time executed successfully
2025/03/04 02:36 INFO:Current modification time: 1740757862.6744745
2025/03/04 02:36 INFO:Last modification time: None
2025/03/04 02:36 INFO:is_file_updated executed successfully
2025/03/04 02:36 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:36 INFO:Loading raw data...
2025/03/04 02:36 DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 02:36 DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 02:36 INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 02:36 INFO:Data saved to output\imported_raw.csv
2025/03/04 02:36 DEBUG:Calling raw_data_cleanup with args=(), kwargs={'loaddata_df':            ECRef              RegulatedEntityName    RegulatedEntityType        Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                  ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    Â£1,876.56   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    Â£2,700.00   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    Â£4,852.58   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    Â£2,500.00   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    Â£4,524.05   29/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
...          ...                              ...                    ...          ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   Â£10,000.00          NaN                NaN  ...              3945              NaN  74198.0             NaN            NaN         False
65274   C0242461               Vote Leave Limited  Permitted Participant  Â£100,000.00          NaN                NaN  ...              3945              NaN  74184.0             NaN            NaN         False
65275   C0243560               Vote Leave Limited  Permitted Participant   Â£40,000.00          NaN                NaN  ...              3945              NaN  74576.0             NaN            NaN         False
65276   C0319710  Conservative and Unionist Party        Political Party   Â£50,000.00          NaN      Central Party  ...                52              NaN  34241.0             NaN  Great Britain         False
65277   C0319727  Conservative and Unionist Party        Political Party   Â£15,000.00          NaN      Central Party  ...                52              NaN  74743.0             NaN  Great Britain         False

[65278 rows x 29 columns], 'dedupe_donors': True, 'dedupe_regentity': True, 'output_csv': True, 'originaldatafilepath': 'output\\imported_raw.csv', 'processeddatafilepath': 'cleaned_donations_fname'}
2025/03/04 02:36 INFO:Cleaning up raw data
2025/03/04 02:36 ERROR:Session state variables not initialized!
2025/03/04 02:36 DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': None, 'savedfilepath': 'output\\cleaned_donations.csv', 'timestamp_key': 'cleaned_raw_data_last_modified'}
2025/03/04 02:36 INFO:Original file path: None
2025/03/04 02:36 INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 02:36 ERROR:Error: originalfilepath is None!
2025/03/04 02:36 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:36 INFO:Data loaded, shape: (65278, 29)
2025/03/04 02:36 DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns], 'entity': 'RegulatedEntity', 'map_filename': 'regentity_map_fname', 'output_csv': True}
2025/03/04 02:36 INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 02:36 INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:36 DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:36 INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 02:36 INFO:dedupe_entity_file executed successfully
2025/03/04 02:36 DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...       CleanedRegulatedEntityName CleanedRegulatedEntityId RegulatedEntityId              RegulatedEntityName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                      Andy Street                   8015.0            8015.0                      Andy Street
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                      Andy Street                   8015.0            8015.0                      Andy Street
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                      Andy Street                   8015.0            8015.0                      Andy Street
...          ...                              ...                    ...        ...  ...                              ...                      ...               ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party

[65278 rows x 33 columns], 'entity': 'Donor', 'map_filename': 'donor_map_fname', 'output_csv': True}
2025/03/04 02:36 INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 02:36 INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 02:36 DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 02:36 INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 02:36 INFO:dedupe_entity_file executed successfully
2025/03/04 02:36 INFO:Raw Data cleanup completed
2025/03/04 02:36 INFO:Data shape: (65278, 37)
2025/03/04 02:36 INFO:Data saved to output\cleaned_donations.csv
2025/03/04 02:36 INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 02:36 INFO:raw_data_cleanup executed successfully
2025/03/04 02:36 INFO:load_raw_data executed successfully
2025/03/04 02:36 INFO:get_raw_data executed successfully
2025/03/04 02:36 INFO:load_data_to_session executed successfully
2025/03/04 02:36 DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:36 DEBUG:Calling load_data_to_session with args=('data_clean', <function get_cleaned_data at 0x000001FBF2C0FD00>), kwargs={}
2025/03/04 02:36 DEBUG:Calling get_cleaned_data with args=(), kwargs={}
2025/03/04 02:36 DEBUG:Calling load_cleaned_data with args=(), kwargs={'originaldatafilepath': 'cleaned_donations_fname', 'processeddatafilepath': 'cleaned_data_fname', 'datafile': 'raw_data', 'streamlitrun': True, 'output_csv': True, 'main_file': 'raw_data', 'cleaned_file': 'data_clean'}
2025/03/04 02:36 DEBUG:Rows in Raw Data: 65278
2025/03/04 02:36 DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_donations.csv', 'savedfilepath': 'output\\cleaned_data.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:36 INFO:Original file path: output\cleaned_donations.csv
2025/03/04 02:36 INFO:Saved file path: output\cleaned_data.csv
2025/03/04 02:36 DEBUG:Calling is_file_updated with args=('output\\cleaned_donations.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:36 INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 02:36 DEBUG:Calling get_file_modification_time with args=('output\\cleaned_donations.csv',), kwargs={}
2025/03/04 02:36 INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 02:36 INFO:get_file_modification_time executed successfully
2025/03/04 02:36 INFO:Current modification time: 1741098978.6388676
2025/03/04 02:36 INFO:Last modification time: 1740757862.6744745
2025/03/04 02:36 INFO:is_file_updated executed successfully
2025/03/04 02:36 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:36 ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 02:36 INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 02:36 DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 02:36 DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 02:36 DEBUG:Calling map_mp_to_party with args=(           ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ...  DonorId                        DonorName EventCount YearReceived MonthReceived YearMonthReceived
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
...          ...                              ...                    ...        ...          ...                ...  ...      ...                              ...        ...          ...           ...               ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...  74198.0      Shaftesbury Investments Ltd          1         2016             4            201604
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...  74184.0                Mr Jeremy Hosking          1         2016             2            201602
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...  23556.0                    Anthony Clake          1         2016             6            201606
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...   2146.0                Mr Peter A Dubens          1         2017             5            201705
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...  74743.0                 Mr Ravi S Kailas          1         2017             5            201705

[65278 rows x 41 columns],), kwargs={}
2025/03/04 02:36 DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 02:36 DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 02:36 DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:36 DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 02:36 DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:36 ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 02:36 ERROR:Attempting to remove duplicates
2025/03/04 02:36 DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 02:36 DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 02:36 INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 02:36 INFO:map_mp_to_party executed successfully
2025/03/04 02:36 DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 02:36 DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 02:36 DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 02:36 DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 02:36 DEBUG:Calling load_election_dates with args=(), kwargs={}
2025/03/04 02:36 DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:36 DEBUG:try to load previous election dates from file.
2025/03/04 02:36 DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'reference_files\\elections.csv', 'timestamp_key': 'election_dates_last_modified'}
2025/03/04 02:36 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:36 INFO:Saved file path: reference_files\elections.csv
2025/03/04 02:36 DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'election_dates_last_modified'), kwargs={}
2025/03/04 02:36 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:36 DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:36 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:36 INFO:get_file_modification_time executed successfully
2025/03/04 02:36 INFO:Current modification time: 1740757862.6744745
2025/03/04 02:36 INFO:Last modification time: None
2025/03/04 02:36 INFO:is_file_updated executed successfully
2025/03/04 02:36 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:36 ERROR:Failed to load election dates from file.
2025/03/04 02:36 INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 02:36 INFO:Election Dates loaded vis pdpy.
2025/03/04 02:36 DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 02:36 INFO:Election Dates Loaded Successfully.
2025/03/04 02:36 DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 02:36 DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 02:36 INFO:load_election_dates executed successfully
2025/03/04 02:36 DEBUG:Clean Data Prep 353: Election dates: 65278
2025/03/04 02:36 DEBUG:Clean Data Prep 386: End of clean: 65278
2025/03/04 02:36 INFO:Cleaned Data completed, shape: (65278, 55)
2025/03/04 02:36 INFO:load_cleaned_data executed successfully
2025/03/04 02:36 INFO:get_cleaned_data executed successfully
2025/03/04 02:36 INFO:load_data_to_session executed successfully
2025/03/04 02:36 DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:36 DEBUG:Calling load_data_to_session with args=('data_donor', <function get_donor_data at 0x000001FBF2C0FE20>), kwargs={}
2025/03/04 02:36 DEBUG:Calling get_donor_data with args=(), kwargs={}
2025/03/04 02:36 DEBUG:Calling load_donorList_data with args=(), kwargs={'main_file': 'data_clean', 'cleaned_file': 'data_donor', 'streamlitrun': True, 'output_csv': True, 'originaldatafilepath': 'cleaned_data_fname', 'cleaneddatafilepath': 'cleaned_donorlist_fname'}
2025/03/04 02:36 DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_data.csv', 'savedfilepath': 'output\\cleaned_donorlist.csv', 'timestamp_key': 'load_donorlist_data_last_modified'}
2025/03/04 02:36 INFO:Original file path: output\cleaned_data.csv
2025/03/04 02:36 INFO:Saved file path: output\cleaned_donorlist.csv
2025/03/04 02:36 DEBUG:Calling is_file_updated with args=('output\\cleaned_data.csv', 'load_donorlist_data_last_modified'), kwargs={}
2025/03/04 02:36 INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 02:36 DEBUG:Calling get_file_modification_time with args=('output\\cleaned_data.csv',), kwargs={}
2025/03/04 02:36 INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 02:36 INFO:get_file_modification_time executed successfully
2025/03/04 02:36 INFO:Current modification time: 1741099004.4142725
2025/03/04 02:36 INFO:Last modification time: None
2025/03/04 02:36 INFO:is_file_updated executed successfully
2025/03/04 02:36 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:36 INFO:Donor data saved to output\cleaned_donorlist.csv
2025/03/04 02:36 INFO:Donor Data summary completed
2025/03/04 02:36 INFO:Data shape: (25576, 5)
2025/03/04 02:36 INFO:load_donorList_data executed successfully
2025/03/04 02:36 INFO:get_donor_data executed successfully
2025/03/04 02:36 INFO:load_data_to_session executed successfully
2025/03/04 02:36 DEBUG:st.session_state.data_donor: 25576
2025/03/04 02:36 DEBUG:st.session_state.data_clean: 65278
2025/03/04 02:36 DEBUG:Calling load_data_to_session with args=('data_regentity', <function get_regentity_data at 0x000001FBF2C0FF40>), kwargs={}
2025/03/04 02:36 DEBUG:Calling get_regentity_data with args=(), kwargs={}
2025/03/04 02:36 DEBUG:Calling load_regulated_entity_data with args=(), kwargs={'main_file': 'data_clean', 'cleaned_file': 'data_regentity', 'streamlitrun': True, 'output_csv': True, 'originaldatafilepath': 'cleaned_data_fname', 'cleaneddatafilepath': 'cleaned_regentity_fname'}
2025/03/04 02:36 DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_data.csv', 'savedfilepath': 'output\\cleaned_regentity.csv', 'timestamp_key': 'load_donorlist_data_last_modified'}
2025/03/04 02:36 INFO:Original file path: output\cleaned_data.csv
2025/03/04 02:36 INFO:Saved file path: output\cleaned_regentity.csv
2025/03/04 02:36 DEBUG:Calling is_file_updated with args=('output\\cleaned_data.csv', 'load_donorlist_data_last_modified'), kwargs={}
2025/03/04 02:36 INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 02:36 DEBUG:Calling get_file_modification_time with args=('output\\cleaned_data.csv',), kwargs={}
2025/03/04 02:36 INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 02:36 INFO:get_file_modification_time executed successfully
2025/03/04 02:36 INFO:Current modification time: 1741099004.4142725
2025/03/04 02:36 INFO:Last modification time: 1741099004.4142725
2025/03/04 02:36 INFO:is_file_updated executed successfully
2025/03/04 02:36 INFO:Loading preprocessed data. Using output\cleaned_regentity.csv dated load_donorlist_data_last_modified instead of output\cleaned_data.csv
2025/03/04 02:36 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:36 INFO:load_regulated_entity_data executed successfully
2025/03/04 02:36 INFO:get_regentity_data executed successfully
2025/03/04 02:36 INFO:load_data_to_session executed successfully
2025/03/04 02:36 DEBUG:st.session_state.data_regentity: 1364
2025/03/04 02:36 DEBUG:st.session_state.data_donor: 25576
2025/03/04 02:36 DEBUG:st.session_state.data_clean: 65278
2025/03/04 02:36 INFO:firstload executed successfully
2025/03/04 02:36 INFO:Data first load completed successfully.
2025/03/04 02:36 INFO:initialise_data executed successfully
2025/03/04 02:36 INFO:App is fully loaded and ready!
2025/03/04 02:45 INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 02:45 DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\utils',), kwargs={}
2025/03/04 02:45 INFO:get_git_version executed successfully
2025/03/04 02:45 DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\data',), kwargs={}
2025/03/04 02:45 INFO:get_git_version executed successfully
2025/03/04 02:45 INFO:Streamlit App Starting...
2025/03/04 02:45 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 02:45 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 02:45 INFO:Running App setup...
2025/03/04 02:45 DEBUG:Calling setup_package with args=(), kwargs={}
2025/03/04 02:45 INFO:Setting up the package
2025/03/04 02:45 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 02:45 DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1',), kwargs={}
2025/03/04 02:45 INFO:get_git_version executed successfully
2025/03/04 02:45 INFO:Version: v20.143
2025/03/04 02:45 DEBUG:Calling initialize_session_state with args=(), kwargs={}
2025/03/04 02:45 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:45 DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 02:45 DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 02:45 DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:45 DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 02:45 DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 02:45 DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:45 DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:45 DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:45 DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:45 DEBUG:Initialised perc_target with value: 0.5
2025/03/04 02:45 DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 02:45 DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:45 DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 02:45 DEBUG:Initialised data_dir with value: data
2025/03/04 02:45 DEBUG:Initialised output_dir with value: output
2025/03/04 02:45 DEBUG:Initialised logs_dir with value: logs
2025/03/04 02:45 DEBUG:Initialised components_dir with value: components
2025/03/04 02:45 DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 02:45 DEBUG:Initialised utils_dir with value: utils
2025/03/04 02:45 DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:45 DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:45 DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 02:45 DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:45 DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:45 DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:45 DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 02:45 DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 02:45 DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 02:45 DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 02:45 DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 02:45 DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 02:45 DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 02:45 DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 02:45 DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 02:45 DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 02:45 DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:45 DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 02:45 INFO:Session_state variables initialized
2025/03/04 02:45 DEBUG:reference_dir: reference_files
2025/03/04 02:45 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 02:45 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:45 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:45 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:45 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:45 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 02:45 DEBUG:perc_target: 0.5
2025/03/04 02:45 DEBUG:components_dir: components
2025/03/04 02:45 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 02:45 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 02:45 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:45 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 02:45 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:45 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 02:45 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 02:45 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 02:45 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 02:45 DEBUG:logs_dir: logs
2025/03/04 02:45 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 02:45 DEBUG:output_dir: output
2025/03/04 02:45 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 02:45 DEBUG:data_dir: data
2025/03/04 02:45 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 02:45 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:45 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 02:45 DEBUG:utils_dir: utils
2025/03/04 02:45 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:45 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:45 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:45 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:45 DEBUG:LOG_LEVEL: ERROR
2025/03/04 02:45 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 02:45 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:45 DEBUG:app_pages_dir: app_pages
2025/03/04 02:45 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:45 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:45 INFO:Session state Setup complete
2025/03/04 02:45 INFO:initialize_session_state executed successfully
2025/03/04 02:45 INFO:Package setup complete
2025/03/04 02:45 INFO:setup_package executed successfully
2025/03/04 02:45 INFO:Setup completed successfully.
2025/03/04 02:45 INFO:Running Menu setup...
2025/03/04 02:45 DEBUG:Calling pagesetup with args=(), kwargs={}
2025/03/04 02:45 DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\app_pages',), kwargs={}
2025/03/04 02:45 INFO:get_git_version executed successfully
2025/03/04 02:45 DEBUG:Calling get_git_version with args=('H:\\VScode\\dashboard_demo-1\\components',), kwargs={}
2025/03/04 02:45 INFO:get_git_version executed successfully
2025/03/04 02:45 DEBUG:Calling get_git_version with args=(), kwargs={}
2025/03/04 02:45 INFO:get_git_version executed successfully
2025/03/04 02:45 INFO:App Version: v20.164
2025/03/04 02:45 INFO:Switched to page: Introduction
2025/03/04 02:45 INFO:pagesetup executed successfully
2025/03/04 02:45 INFO:Menu setup completed successfully.
2025/03/04 02:45 INFO:No data found in session state, running firstload()
2025/03/04 02:45 DEBUG:Calling initialise_data with args=(), kwargs={}
2025/03/04 02:45 INFO:Running first load function.
2025/03/04 02:45 DEBUG:Calling firstload with args=(), kwargs={}
2025/03/04 02:45 DEBUG:Calling load_data_to_session with args=('raw_data', <function get_raw_data at 0x00000200B2674820>), kwargs={}
2025/03/04 02:45 DEBUG:Calling get_raw_data with args=(), kwargs={}
2025/03/04 02:45 DEBUG:Calling load_raw_data with args=(), kwargs={'main_file': 'raw_data', 'cleaned_file': 'raw_data_clean', 'output_csv': True, 'dedupe_donors': True, 'dedupe_regentity': True, 'originaldatafilepath': 'source_data_fname', 'processeddatafilepath': 'imported_raw_fname'}
2025/03/04 02:45 DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 02:45 DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 02:45 DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'output\\imported_raw.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:45 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:45 INFO:Saved file path: output\imported_raw.csv
2025/03/04 02:45 DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:45 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:45 DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:45 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:45 INFO:get_file_modification_time executed successfully
2025/03/04 02:45 INFO:Current modification time: 1740757862.6744745
2025/03/04 02:45 INFO:Last modification time: None
2025/03/04 02:45 INFO:is_file_updated executed successfully
2025/03/04 02:45 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:45 INFO:Loading raw data...
2025/03/04 02:45 DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 02:45 DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 02:45 INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 02:45 INFO:Data saved to output\imported_raw.csv
2025/03/04 02:45 DEBUG:Calling raw_data_cleanup with args=(), kwargs={'loaddata_df':            ECRef              RegulatedEntityName    RegulatedEntityType        Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                  ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    Â£1,876.56   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    Â£2,700.00   02/09/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    Â£4,852.58   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    Â£2,500.00   30/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    Â£4,524.05   29/08/2019                NaN  ...              8015              NaN  86310.0             NaN  Great Britain         False
...          ...                              ...                    ...          ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   Â£10,000.00          NaN                NaN  ...              3945              NaN  74198.0             NaN            NaN         False
65274   C0242461               Vote Leave Limited  Permitted Participant  Â£100,000.00          NaN                NaN  ...              3945              NaN  74184.0             NaN            NaN         False
65275   C0243560               Vote Leave Limited  Permitted Participant   Â£40,000.00          NaN                NaN  ...              3945              NaN  74576.0             NaN            NaN         False
65276   C0319710  Conservative and Unionist Party        Political Party   Â£50,000.00          NaN      Central Party  ...                52              NaN  34241.0             NaN  Great Britain         False
65277   C0319727  Conservative and Unionist Party        Political Party   Â£15,000.00          NaN      Central Party  ...                52              NaN  74743.0             NaN  Great Britain         False

[65278 rows x 29 columns], 'dedupe_donors': True, 'dedupe_regentity': True, 'output_csv': True, 'originaldatafilepath': 'output\\imported_raw.csv', 'processeddatafilepath': 'cleaned_donations_fname'}
2025/03/04 02:45 INFO:Cleaning up raw data
2025/03/04 02:45 ERROR:Session state variables not initialized!
2025/03/04 02:45 DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': None, 'savedfilepath': 'output\\cleaned_donations.csv', 'timestamp_key': 'cleaned_raw_data_last_modified'}
2025/03/04 02:45 INFO:Original file path: None
2025/03/04 02:45 INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 02:45 ERROR:Error: originalfilepath is None!
2025/03/04 02:45 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:45 INFO:Data loaded, shape: (65278, 29)
2025/03/04 02:45 DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns], 'entity': 'RegulatedEntity', 'map_filename': 'regentity_map_fname', 'output_csv': True}
2025/03/04 02:45 INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 02:45 INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:45 DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:45 INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 02:45 INFO:dedupe_entity_file executed successfully
2025/03/04 02:45 DEBUG:Calling dedupe_entity_file with args=(), kwargs={'loaddata_dd_df':            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...       CleanedRegulatedEntityName CleanedRegulatedEntityId RegulatedEntityId              RegulatedEntityName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                      Andy Street                   8015.0            8015.0                      Andy Street
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                      Andy Street                   8015.0            8015.0                      Andy Street
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                      Andy Street                   8015.0            8015.0                      Andy Street
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                      Andy Street                   8015.0            8015.0                      Andy Street
...          ...                              ...                    ...        ...  ...                              ...                      ...               ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...               Vote Leave Limited                   3945.0            3945.0               Vote Leave Limited
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...  Conservative And Unionist Party                     52.0              52.0  Conservative And Unionist Party

[65278 rows x 33 columns], 'entity': 'Donor', 'map_filename': 'donor_map_fname', 'output_csv': True}
2025/03/04 02:45 INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 02:45 INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 02:45 DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 02:45 INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 02:45 INFO:dedupe_entity_file executed successfully
2025/03/04 02:45 INFO:Raw Data cleanup completed
2025/03/04 02:45 INFO:Data shape: (65278, 37)
2025/03/04 02:45 INFO:Data saved to output\cleaned_donations.csv
2025/03/04 02:45 INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 02:45 INFO:raw_data_cleanup executed successfully
2025/03/04 02:45 INFO:load_raw_data executed successfully
2025/03/04 02:45 INFO:get_raw_data executed successfully
2025/03/04 02:45 INFO:load_data_to_session executed successfully
2025/03/04 02:45 DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:45 DEBUG:Calling load_data_to_session with args=('data_clean', <function get_cleaned_data at 0x00000200B2674CA0>), kwargs={}
2025/03/04 02:45 DEBUG:Calling get_cleaned_data with args=(), kwargs={}
2025/03/04 02:45 DEBUG:Calling load_cleaned_data with args=(), kwargs={'originaldatafilepath': 'cleaned_donations_fname', 'processeddatafilepath': 'cleaned_data_fname', 'datafile': 'raw_data', 'streamlitrun': True, 'output_csv': True, 'main_file': 'raw_data', 'cleaned_file': 'data_clean'}
2025/03/04 02:45 DEBUG:Rows in Raw Data: 65278
2025/03/04 02:45 DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'output\\cleaned_donations.csv', 'savedfilepath': 'output\\cleaned_data.csv', 'timestamp_key': 'load_raw_data_last_modified'}
2025/03/04 02:45 INFO:Original file path: output\cleaned_donations.csv
2025/03/04 02:45 INFO:Saved file path: output\cleaned_data.csv
2025/03/04 02:45 DEBUG:Calling is_file_updated with args=('output\\cleaned_donations.csv', 'load_raw_data_last_modified'), kwargs={}
2025/03/04 02:45 INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 02:45 DEBUG:Calling get_file_modification_time with args=('output\\cleaned_donations.csv',), kwargs={}
2025/03/04 02:45 INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 02:45 INFO:get_file_modification_time executed successfully
2025/03/04 02:45 INFO:Current modification time: 1741099546.7669694
2025/03/04 02:45 INFO:Last modification time: 1740757862.6744745
2025/03/04 02:45 INFO:is_file_updated executed successfully
2025/03/04 02:45 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:45 ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 02:45 INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 02:45 DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 02:45 DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 02:45 DEBUG:Calling map_mp_to_party with args=(           ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ...  DonorId                        DonorName EventCount YearReceived MonthReceived YearMonthReceived
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             9            201909
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...  86310.0  Conservative And Unionist Party          1         2019             8            201908
...          ...                              ...                    ...        ...          ...                ...  ...      ...                              ...        ...          ...           ...               ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...  74198.0      Shaftesbury Investments Ltd          1         2016             4            201604
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...  74184.0                Mr Jeremy Hosking          1         2016             2            201602
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...  23556.0                    Anthony Clake          1         2016             6            201606
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...   2146.0                Mr Peter A Dubens          1         2017             5            201705
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...  74743.0                 Mr Ravi S Kailas          1         2017             5            201705

[65278 rows x 41 columns],), kwargs={}
2025/03/04 02:45 DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 02:45 DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 02:45 DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:45 DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 02:45 DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:45 ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 02:45 ERROR:Attempting to remove duplicates
2025/03/04 02:45 DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 02:45 DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 02:45 INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 02:45 INFO:map_mp_to_party executed successfully
2025/03/04 02:45 DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 02:45 DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 02:45 DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 02:45 DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 02:45 DEBUG:Calling load_election_dates with args=(), kwargs={}
2025/03/04 02:45 DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:45 DEBUG:try to load previous election dates from file.
2025/03/04 02:45 DEBUG:Calling try_to_use_preprocessed_data with args=(), kwargs={'originalfilepath': 'source\\Donations_accepted_by_political_parties.csv', 'savedfilepath': 'reference_files\\elections.csv', 'timestamp_key': 'election_dates_last_modified'}
2025/03/04 02:45 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:45 INFO:Saved file path: reference_files\elections.csv
2025/03/04 02:45 DEBUG:Calling is_file_updated with args=('source\\Donations_accepted_by_political_parties.csv', 'election_dates_last_modified'), kwargs={}
2025/03/04 02:45 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:45 DEBUG:Calling get_file_modification_time with args=('source\\Donations_accepted_by_political_parties.csv',), kwargs={}
2025/03/04 02:45 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:45 INFO:get_file_modification_time executed successfully
2025/03/04 02:45 INFO:Current modification time: 1740757862.6744745
2025/03/04 02:45 INFO:Last modification time: None
2025/03/04 02:45 INFO:is_file_updated executed successfully
2025/03/04 02:45 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:45 ERROR:Failed to load election dates from file.
2025/03/04 02:45 INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 02:45 INFO:Election Dates loaded vis pdpy.
2025/03/04 02:45 DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 02:45 INFO:Election Dates Loaded Successfully.
2025/03/04 02:45 DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 02:45 DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 02:45 INFO:load_election_dates executed successfully
2025/03/04 02:45 ERROR:Error in load_cleaned_data: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 57, in _wrapfunc
    return bound(*args, **kwds)
  File "H:\python310\lib\site-packages\pandas\core\series.py", line 3268, in searchsorted
    return base.IndexOpsMixin.searchsorted(self, value, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\pandas\core\base.py", line 1352, in searchsorted
    return algorithms.searchsorted(
  File "H:\python310\lib\site-packages\pandas\core\algorithms.py", line 1329, in searchsorted
    return arr.searchsorted(value, side=side, sorter=sorter)  # type: ignore[arg-type]
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 344, in load_cleaned_data
    loadclean_df["DaysTillNextElection"] = get_days_till_next_election(loadclean_df["ReceivedDate"])
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 332, in get_days_till_next_election
    idx = np.searchsorted(election_dates_asc, date_series, side="left")
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 1527, in searchsorted
    return _wrapfunc(a, 'searchsorted', v, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 66, in _wrapfunc
    return _wrapit(obj, method, *args, **kwds)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 46, in _wrapit
    result = getattr(arr, method)(*args, **kwds)
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
2025/03/04 02:45 ERROR:Error in get_cleaned_data: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 57, in _wrapfunc
    return bound(*args, **kwds)
  File "H:\python310\lib\site-packages\pandas\core\series.py", line 3268, in searchsorted
    return base.IndexOpsMixin.searchsorted(self, value, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\pandas\core\base.py", line 1352, in searchsorted
    return algorithms.searchsorted(
  File "H:\python310\lib\site-packages\pandas\core\algorithms.py", line 1329, in searchsorted
    return arr.searchsorted(value, side=side, sorter=sorter)  # type: ignore[arg-type]
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 39, in get_cleaned_data
    return load_cleaned_data(
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 344, in load_cleaned_data
    loadclean_df["DaysTillNextElection"] = get_days_till_next_election(loadclean_df["ReceivedDate"])
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 332, in get_days_till_next_election
    idx = np.searchsorted(election_dates_asc, date_series, side="left")
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 1527, in searchsorted
    return _wrapfunc(a, 'searchsorted', v, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 66, in _wrapfunc
    return _wrapit(obj, method, *args, **kwds)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 46, in _wrapit
    result = getattr(arr, method)(*args, **kwds)
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
2025/03/04 02:45 ERROR:Error in load_data_to_session: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 57, in _wrapfunc
    return bound(*args, **kwds)
  File "H:\python310\lib\site-packages\pandas\core\series.py", line 3268, in searchsorted
    return base.IndexOpsMixin.searchsorted(self, value, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\pandas\core\base.py", line 1352, in searchsorted
    return algorithms.searchsorted(
  File "H:\python310\lib\site-packages\pandas\core\algorithms.py", line 1329, in searchsorted
    return arr.searchsorted(value, side=side, sorter=sorter)  # type: ignore[arg-type]
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 97, in load_data_to_session
    st.session_state[key] = loader_function()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 39, in get_cleaned_data
    return load_cleaned_data(
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 344, in load_cleaned_data
    loadclean_df["DaysTillNextElection"] = get_days_till_next_election(loadclean_df["ReceivedDate"])
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 332, in get_days_till_next_election
    idx = np.searchsorted(election_dates_asc, date_series, side="left")
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 1527, in searchsorted
    return _wrapfunc(a, 'searchsorted', v, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 66, in _wrapfunc
    return _wrapit(obj, method, *args, **kwds)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 46, in _wrapit
    result = getattr(arr, method)(*args, **kwds)
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
2025/03/04 02:45 ERROR:Error in firstload: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 57, in _wrapfunc
    return bound(*args, **kwds)
  File "H:\python310\lib\site-packages\pandas\core\series.py", line 3268, in searchsorted
    return base.IndexOpsMixin.searchsorted(self, value, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\pandas\core\base.py", line 1352, in searchsorted
    return algorithms.searchsorted(
  File "H:\python310\lib\site-packages\pandas\core\algorithms.py", line 1329, in searchsorted
    return arr.searchsorted(value, side=side, sorter=sorter)  # type: ignore[arg-type]
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 83, in firstload
    load_data_to_session("data_clean", get_cleaned_data)
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 97, in load_data_to_session
    st.session_state[key] = loader_function()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 39, in get_cleaned_data
    return load_cleaned_data(
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 344, in load_cleaned_data
    loadclean_df["DaysTillNextElection"] = get_days_till_next_election(loadclean_df["ReceivedDate"])
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 332, in get_days_till_next_election
    idx = np.searchsorted(election_dates_asc, date_series, side="left")
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 1527, in searchsorted
    return _wrapfunc(a, 'searchsorted', v, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 66, in _wrapfunc
    return _wrapit(obj, method, *args, **kwds)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 46, in _wrapit
    result = getattr(arr, method)(*args, **kwds)
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
2025/03/04 02:45 ERROR:Error in initialise_data: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 57, in _wrapfunc
    return bound(*args, **kwds)
  File "H:\python310\lib\site-packages\pandas\core\series.py", line 3268, in searchsorted
    return base.IndexOpsMixin.searchsorted(self, value, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\pandas\core\base.py", line 1352, in searchsorted
    return algorithms.searchsorted(
  File "H:\python310\lib\site-packages\pandas\core\algorithms.py", line 1329, in searchsorted
    return arr.searchsorted(value, side=side, sorter=sorter)  # type: ignore[arg-type]
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_utils.py", line 42, in initialise_data
    firstload()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 83, in firstload
    load_data_to_session("data_clean", get_cleaned_data)
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 97, in load_data_to_session
    st.session_state[key] = loader_function()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 39, in get_cleaned_data
    return load_cleaned_data(
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 344, in load_cleaned_data
    loadclean_df["DaysTillNextElection"] = get_days_till_next_election(loadclean_df["ReceivedDate"])
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 332, in get_days_till_next_election
    idx = np.searchsorted(election_dates_asc, date_series, side="left")
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 1527, in searchsorted
    return _wrapfunc(a, 'searchsorted', v, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 66, in _wrapfunc
    return _wrapit(obj, method, *args, **kwds)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 46, in _wrapit
    result = getattr(arr, method)(*args, **kwds)
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
2025/03/04 02:45 CRITICAL:First load crashed: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 57, in _wrapfunc
    return bound(*args, **kwds)
  File "H:\python310\lib\site-packages\pandas\core\series.py", line 3268, in searchsorted
    return base.IndexOpsMixin.searchsorted(self, value, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\pandas\core\base.py", line 1352, in searchsorted
    return algorithms.searchsorted(
  File "H:\python310\lib\site-packages\pandas\core\algorithms.py", line 1329, in searchsorted
    return arr.searchsorted(value, side=side, sorter=sorter)  # type: ignore[arg-type]
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py", line 80, in <module>
    initialise_data()  # Load the data
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_utils.py", line 42, in initialise_data
    firstload()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 83, in firstload
    load_data_to_session("data_clean", get_cleaned_data)
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 97, in load_data_to_session
    st.session_state[key] = loader_function()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 39, in get_cleaned_data
    return load_cleaned_data(
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    raise e
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 35, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 344, in load_cleaned_data
    loadclean_df["DaysTillNextElection"] = get_days_till_next_election(loadclean_df["ReceivedDate"])
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 332, in get_days_till_next_election
    idx = np.searchsorted(election_dates_asc, date_series, side="left")
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 1527, in searchsorted
    return _wrapfunc(a, 'searchsorted', v, side=side, sorter=sorter)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 66, in _wrapfunc
    return _wrapit(obj, method, *args, **kwds)
  File "H:\python310\lib\site-packages\numpy\_core\fromnumeric.py", line 46, in _wrapit
    result = getattr(arr, method)(*args, **kwds)
  File "timestamps.pyx", line 377, in pandas._libs.tslibs.timestamps._Timestamp.__richcmp__
TypeError: Cannot compare Timestamp with datetime.date. Use ts == pd.Timestamp(date) or ts.date() == date instead.
2025/03/04 02:57 INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 02:57 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:get_git_version executed successfully
2025/03/04 02:57 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:get_git_version executed successfully
2025/03/04 02:57 INFO:Streamlit App Starting...
2025/03/04 02:57 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 02:57 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 02:57 INFO:Running App setup...
2025/03/04 02:57 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:Setting up the package
2025/03/04 02:57 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 02:57 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:get_git_version executed successfully
2025/03/04 02:57 INFO:Version: v20.143
2025/03/04 02:57 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:57 DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 02:57 DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 02:57 DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:57 DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 02:57 DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 02:57 DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:57 DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:57 DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:57 DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:57 DEBUG:Initialised perc_target with value: 0.5
2025/03/04 02:57 DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 02:57 DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:57 DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 02:57 DEBUG:Initialised data_dir with value: data
2025/03/04 02:57 DEBUG:Initialised output_dir with value: output
2025/03/04 02:57 DEBUG:Initialised logs_dir with value: logs
2025/03/04 02:57 DEBUG:Initialised components_dir with value: components
2025/03/04 02:57 DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 02:57 DEBUG:Initialised utils_dir with value: utils
2025/03/04 02:57 DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:57 DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:57 DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 02:57 DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:57 DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:57 DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:57 DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 02:57 DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 02:57 DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 02:57 DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 02:57 DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 02:57 DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 02:57 DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 02:57 DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 02:57 DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 02:57 DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 02:57 DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:57 DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 02:57 INFO:Session_state variables initialized
2025/03/04 02:57 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 02:57 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 02:57 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 02:57 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 02:57 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 02:57 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 02:57 DEBUG:perc_target: 0.5
2025/03/04 02:57 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 02:57 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 02:57 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 02:57 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 02:57 DEBUG:output_dir: output
2025/03/04 02:57 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 02:57 DEBUG:utils_dir: utils
2025/03/04 02:57 DEBUG:components_dir: components
2025/03/04 02:57 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:57 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 02:57 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 02:57 DEBUG:data_dir: data
2025/03/04 02:57 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 02:57 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 02:57 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 02:57 DEBUG:LOG_LEVEL: ERROR
2025/03/04 02:57 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 02:57 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 02:57 DEBUG:app_pages_dir: app_pages
2025/03/04 02:57 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 02:57 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 02:57 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 02:57 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 02:57 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 02:57 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 02:57 DEBUG:logs_dir: logs
2025/03/04 02:57 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 02:57 DEBUG:reference_dir: reference_files
2025/03/04 02:57 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:57 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 02:57 INFO:Session state Setup complete
2025/03/04 02:57 INFO:initialize_session_state executed successfully
2025/03/04 02:57 INFO:Package setup complete
2025/03/04 02:57 INFO:setup_package executed successfully
2025/03/04 02:57 INFO:Setup completed successfully.
2025/03/04 02:57 INFO:Running Menu setup...
2025/03/04 02:57 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 02:57 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:get_git_version executed successfully
2025/03/04 02:57 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:get_git_version executed successfully
2025/03/04 02:57 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:get_git_version executed successfully
2025/03/04 02:57 INFO:App Version: v20.164
2025/03/04 02:57 INFO:Switched to page: Introduction
2025/03/04 02:57 INFO:pagesetup executed successfully
2025/03/04 02:57 INFO:Menu setup completed successfully.
2025/03/04 02:57 INFO:No data found in session state, running firstload()
2025/03/04 02:57 DEBUG:Calling initialise_data with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:Running first load function.
2025/03/04 02:57 DEBUG:Calling firstload with args={args}, kwargs={kwargs}
2025/03/04 02:57 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 02:57 DEBUG:Calling get_raw_data with args={args}, kwargs={kwargs}
2025/03/04 02:57 DEBUG:Calling load_raw_data with args={args}, kwargs={kwargs}
2025/03/04 02:57 DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 02:57 DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 02:57 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:57 INFO:Saved file path: output\imported_raw.csv
2025/03/04 02:57 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:57 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:57 INFO:get_file_modification_time executed successfully
2025/03/04 02:57 INFO:Current modification time: 1740757862.6744745
2025/03/04 02:57 INFO:Last modification time: None
2025/03/04 02:57 INFO:is_file_updated executed successfully
2025/03/04 02:57 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:57 INFO:Loading raw data...
2025/03/04 02:57 DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 02:57 DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 02:57 INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 02:57 INFO:Data saved to output\imported_raw.csv
2025/03/04 02:57 DEBUG:Calling raw_data_cleanup with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:Cleaning up raw data
2025/03/04 02:57 ERROR:Session state variables not initialized!
2025/03/04 02:57 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:Original file path: None
2025/03/04 02:57 INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 02:57 ERROR:Error: originalfilepath is None!
2025/03/04 02:57 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:57 INFO:Data loaded, shape: (65278, 29)
2025/03/04 02:57 DEBUG:Calling dedupe_entity_file with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 02:57 INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:57 DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 02:57 INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 02:57 INFO:dedupe_entity_file executed successfully
2025/03/04 02:57 DEBUG:Calling dedupe_entity_file with args={args}, kwargs={kwargs}
2025/03/04 02:57 INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 02:57 INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 02:57 DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 02:57 INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 02:57 INFO:dedupe_entity_file executed successfully
2025/03/04 02:57 INFO:Raw Data cleanup completed
2025/03/04 02:57 INFO:Data shape: (65278, 37)
2025/03/04 02:58 INFO:Data saved to output\cleaned_donations.csv
2025/03/04 02:58 INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 02:58 INFO:raw_data_cleanup executed successfully
2025/03/04 02:58 INFO:load_raw_data executed successfully
2025/03/04 02:58 INFO:get_raw_data executed successfully
2025/03/04 02:58 INFO:load_data_to_session executed successfully
2025/03/04 02:58 DEBUG:st.session_state.raw_data: 65278
2025/03/04 02:58 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 02:58 DEBUG:Calling get_cleaned_data with args={args}, kwargs={kwargs}
2025/03/04 02:58 DEBUG:Calling load_cleaned_data with args={args}, kwargs={kwargs}
2025/03/04 02:58 DEBUG:Rows in Raw Data: 65278
2025/03/04 02:58 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 02:58 INFO:Original file path: output\cleaned_donations.csv
2025/03/04 02:58 INFO:Saved file path: output\cleaned_data.csv
2025/03/04 02:58 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 02:58 INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 02:58 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 02:58 INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 02:58 INFO:get_file_modification_time executed successfully
2025/03/04 02:58 INFO:Current modification time: 1741100280.466628
2025/03/04 02:58 INFO:Last modification time: 1740757862.6744745
2025/03/04 02:58 INFO:is_file_updated executed successfully
2025/03/04 02:58 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:58 ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 02:58 INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 02:58 DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 02:58 DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 02:58 DEBUG:Calling map_mp_to_party with args={args}, kwargs={kwargs}
2025/03/04 02:58 DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 02:58 DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 02:58 DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:58 DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 02:58 DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 02:58 ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 02:58 ERROR:Attempting to remove duplicates
2025/03/04 02:58 DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 02:58 DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 02:58 INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 02:58 INFO:map_mp_to_party executed successfully
2025/03/04 02:58 DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 02:58 DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 02:58 DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 02:58 DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 02:58 DEBUG:Calling load_election_dates with args={args}, kwargs={kwargs}
2025/03/04 02:58 DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 02:58 DEBUG:try to load previous election dates from file.
2025/03/04 02:58 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 02:58 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 02:58 INFO:Saved file path: reference_files\elections.csv
2025/03/04 02:58 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 02:58 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 02:58 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 02:58 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 02:58 INFO:get_file_modification_time executed successfully
2025/03/04 02:58 INFO:Current modification time: 1740757862.6744745
2025/03/04 02:58 INFO:Last modification time: None
2025/03/04 02:58 INFO:is_file_updated executed successfully
2025/03/04 02:58 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 02:58 ERROR:Failed to load election dates from file.
2025/03/04 02:58 INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 02:58 INFO:Election Dates loaded vis pdpy.
2025/03/04 02:58 DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 02:58 INFO:Election Dates Loaded Successfully.
2025/03/04 02:58 DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 02:58 DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 02:58 INFO:load_election_dates executed successfully
2025/03/04 02:58 ERROR:Error in load_cleaned_data: cannot subtract DatetimeArray from ndarray
Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 348, in load_cleaned_data
    loadclean_df["DaysTillNextElection"] = get_days_till_next_election(loadclean_df["ReceivedDate"])
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 339, in get_days_till_next_election
    return (next_election_dates - date_series).dt.days
  File "H:\python310\lib\site-packages\pandas\core\generic.py", line 2171, in __array_ufunc__
    return arraylike.array_ufunc(self, ufunc, method, *inputs, **kwargs)
  File "H:\python310\lib\site-packages\pandas\core\arraylike.py", line 276, in array_ufunc
    result = maybe_dispatch_ufunc_to_dunder_op(self, ufunc, method, *inputs, **kwargs)
  File "ops_dispatch.pyx", line 113, in pandas._libs.ops_dispatch.maybe_dispatch_ufunc_to_dunder_op
  File "H:\python310\lib\site-packages\pandas\core\ops\common.py", line 76, in new_method
    return method(self, other)
  File "H:\python310\lib\site-packages\pandas\core\arraylike.py", line 198, in __rsub__
    return self._arith_method(other, roperator.rsub)
  File "H:\python310\lib\site-packages\pandas\core\series.py", line 6135, in _arith_method
    return base.IndexOpsMixin._arith_method(self, other, op)
  File "H:\python310\lib\site-packages\pandas\core\base.py", line 1382, in _arith_method
    result = ops.arithmetic_op(lvalues, rvalues, op)
  File "H:\python310\lib\site-packages\pandas\core\ops\array_ops.py", line 273, in arithmetic_op
    res_values = op(left, right)
  File "H:\python310\lib\site-packages\pandas\core\roperator.py", line 15, in rsub
    return right - left
  File "H:\python310\lib\site-packages\pandas\core\arrays\datetimelike.py", line 2200, in __array_ufunc__
    return super().__array_ufunc__(ufunc, method, *inputs, **kwargs)
  File "H:\python310\lib\site-packages\pandas\core\arrays\base.py", line 2282, in __array_ufunc__
    result = arraylike.maybe_dispatch_ufunc_to_dunder_op(
  File "ops_dispatch.pyx", line 113, in pandas._libs.ops_dispatch.maybe_dispatch_ufunc_to_dunder_op
  File "H:\python310\lib\site-packages\pandas\core\arrays\datetimelike.py", line 1499, in __rsub__
    raise TypeError(
TypeError: cannot subtract DatetimeArray from ndarray
2025/03/04 02:58 CRITICAL:First load crashed: cannot subtract DatetimeArray from ndarray
Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py", line 80, in <module>
    initialise_data()  # Load the data
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_utils.py", line 42, in initialise_data
    firstload()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 83, in firstload
    load_data_to_session("data_clean", get_cleaned_data)
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 97, in load_data_to_session
    st.session_state[key] = loader_function()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 39, in get_cleaned_data
    return load_cleaned_data(
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 348, in load_cleaned_data
    loadclean_df["DaysTillNextElection"] = get_days_till_next_election(loadclean_df["ReceivedDate"])
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 339, in get_days_till_next_election
    return (next_election_dates - date_series).dt.days
  File "H:\python310\lib\site-packages\pandas\core\generic.py", line 2171, in __array_ufunc__
    return arraylike.array_ufunc(self, ufunc, method, *inputs, **kwargs)
  File "H:\python310\lib\site-packages\pandas\core\arraylike.py", line 276, in array_ufunc
    result = maybe_dispatch_ufunc_to_dunder_op(self, ufunc, method, *inputs, **kwargs)
  File "ops_dispatch.pyx", line 113, in pandas._libs.ops_dispatch.maybe_dispatch_ufunc_to_dunder_op
  File "H:\python310\lib\site-packages\pandas\core\ops\common.py", line 76, in new_method
    return method(self, other)
  File "H:\python310\lib\site-packages\pandas\core\arraylike.py", line 198, in __rsub__
    return self._arith_method(other, roperator.rsub)
  File "H:\python310\lib\site-packages\pandas\core\series.py", line 6135, in _arith_method
    return base.IndexOpsMixin._arith_method(self, other, op)
  File "H:\python310\lib\site-packages\pandas\core\base.py", line 1382, in _arith_method
    result = ops.arithmetic_op(lvalues, rvalues, op)
  File "H:\python310\lib\site-packages\pandas\core\ops\array_ops.py", line 273, in arithmetic_op
    res_values = op(left, right)
  File "H:\python310\lib\site-packages\pandas\core\roperator.py", line 15, in rsub
    return right - left
  File "H:\python310\lib\site-packages\pandas\core\arrays\datetimelike.py", line 2200, in __array_ufunc__
    return super().__array_ufunc__(ufunc, method, *inputs, **kwargs)
  File "H:\python310\lib\site-packages\pandas\core\arrays\base.py", line 2282, in __array_ufunc__
    result = arraylike.maybe_dispatch_ufunc_to_dunder_op(
  File "ops_dispatch.pyx", line 113, in pandas._libs.ops_dispatch.maybe_dispatch_ufunc_to_dunder_op
  File "H:\python310\lib\site-packages\pandas\core\arrays\datetimelike.py", line 1499, in __rsub__
    raise TypeError(
TypeError: cannot subtract DatetimeArray from ndarray
2025/03/04 03:03 INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 03:03 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:03 INFO:get_git_version executed successfully
2025/03/04 03:03 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:03 INFO:get_git_version executed successfully
2025/03/04 03:03 INFO:Streamlit App Starting...
2025/03/04 03:03 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 03:03 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 03:03 INFO:Running App setup...
2025/03/04 03:03 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 03:03 INFO:Setting up the package
2025/03/04 03:03 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 03:03 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:get_git_version executed successfully
2025/03/04 03:04 INFO:Version: v20.143
2025/03/04 03:04 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:04 DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 03:04 DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 03:04 DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:04 DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 03:04 DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 03:04 DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:04 DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:04 DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:04 DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:04 DEBUG:Initialised perc_target with value: 0.5
2025/03/04 03:04 DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 03:04 DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:04 DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 03:04 DEBUG:Initialised data_dir with value: data
2025/03/04 03:04 DEBUG:Initialised output_dir with value: output
2025/03/04 03:04 DEBUG:Initialised logs_dir with value: logs
2025/03/04 03:04 DEBUG:Initialised components_dir with value: components
2025/03/04 03:04 DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 03:04 DEBUG:Initialised utils_dir with value: utils
2025/03/04 03:04 DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:04 DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:04 DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 03:04 DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:04 DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:04 DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:04 DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 03:04 DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 03:04 DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 03:04 DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 03:04 DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 03:04 DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 03:04 DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 03:04 DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 03:04 DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 03:04 DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 03:04 DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:04 DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 03:04 INFO:Session_state variables initialized
2025/03/04 03:04 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:04 DEBUG:app_pages_dir: app_pages
2025/03/04 03:04 DEBUG:utils_dir: utils
2025/03/04 03:04 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:04 DEBUG:LOG_LEVEL: ERROR
2025/03/04 03:04 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:04 DEBUG:reference_dir: reference_files
2025/03/04 03:04 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 03:04 DEBUG:components_dir: components
2025/03/04 03:04 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:04 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 03:04 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:04 DEBUG:output_dir: output
2025/03/04 03:04 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 03:04 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 03:04 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 03:04 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 03:04 DEBUG:data_dir: data
2025/03/04 03:04 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 03:04 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 03:04 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:04 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 03:04 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 03:04 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:04 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:04 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:04 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 03:04 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 03:04 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:04 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:04 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 03:04 DEBUG:perc_target: 0.5
2025/03/04 03:04 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:04 DEBUG:logs_dir: logs
2025/03/04 03:04 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:04 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 03:04 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:04 INFO:Session state Setup complete
2025/03/04 03:04 INFO:initialize_session_state executed successfully
2025/03/04 03:04 INFO:Package setup complete
2025/03/04 03:04 INFO:setup_package executed successfully
2025/03/04 03:04 INFO:Setup completed successfully.
2025/03/04 03:04 INFO:Running Menu setup...
2025/03/04 03:04 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 03:04 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:get_git_version executed successfully
2025/03/04 03:04 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:get_git_version executed successfully
2025/03/04 03:04 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:get_git_version executed successfully
2025/03/04 03:04 INFO:App Version: v20.164
2025/03/04 03:04 INFO:Switched to page: Introduction
2025/03/04 03:04 INFO:pagesetup executed successfully
2025/03/04 03:04 INFO:Menu setup completed successfully.
2025/03/04 03:04 INFO:No data found in session state, running firstload()
2025/03/04 03:04 DEBUG:Calling initialise_data with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Running first load function.
2025/03/04 03:04 DEBUG:Calling firstload with args={args}, kwargs={kwargs}
2025/03/04 03:04 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:04 DEBUG:Calling get_raw_data with args={args}, kwargs={kwargs}
2025/03/04 03:04 DEBUG:Calling load_raw_data with args={args}, kwargs={kwargs}
2025/03/04 03:04 DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 03:04 DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 03:04 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:04 INFO:Saved file path: output\imported_raw.csv
2025/03/04 03:04 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 03:04 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 03:04 INFO:get_file_modification_time executed successfully
2025/03/04 03:04 INFO:Current modification time: 1740757862.6744745
2025/03/04 03:04 INFO:Last modification time: None
2025/03/04 03:04 INFO:is_file_updated executed successfully
2025/03/04 03:04 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:04 INFO:Loading raw data...
2025/03/04 03:04 DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 03:04 DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 03:04 INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 03:04 INFO:Data saved to output\imported_raw.csv
2025/03/04 03:04 DEBUG:Calling raw_data_cleanup with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Cleaning up raw data
2025/03/04 03:04 ERROR:Session state variables not initialized!
2025/03/04 03:04 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Original file path: None
2025/03/04 03:04 INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 03:04 ERROR:Error: originalfilepath is None!
2025/03/04 03:04 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:04 INFO:Data loaded, shape: (65278, 29)
2025/03/04 03:04 DEBUG:Calling dedupe_entity_file with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 03:04 INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 03:04 DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 03:04 INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 03:04 INFO:dedupe_entity_file executed successfully
2025/03/04 03:04 DEBUG:Calling dedupe_entity_file with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 03:04 INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 03:04 DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 03:04 INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 03:04 INFO:dedupe_entity_file executed successfully
2025/03/04 03:04 INFO:Raw Data cleanup completed
2025/03/04 03:04 INFO:Data shape: (65278, 37)
2025/03/04 03:04 INFO:Data saved to output\cleaned_donations.csv
2025/03/04 03:04 INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 03:04 INFO:raw_data_cleanup executed successfully
2025/03/04 03:04 INFO:load_raw_data executed successfully
2025/03/04 03:04 INFO:get_raw_data executed successfully
2025/03/04 03:04 INFO:load_data_to_session executed successfully
2025/03/04 03:04 DEBUG:st.session_state.raw_data: 65278
2025/03/04 03:04 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:04 DEBUG:Calling get_cleaned_data with args={args}, kwargs={kwargs}
2025/03/04 03:04 DEBUG:Calling load_cleaned_data with args={args}, kwargs={kwargs}
2025/03/04 03:04 DEBUG:Rows in Raw Data: 65278
2025/03/04 03:04 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Original file path: output\cleaned_donations.csv
2025/03/04 03:04 INFO:Saved file path: output\cleaned_data.csv
2025/03/04 03:04 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 03:04 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 03:04 INFO:get_file_modification_time executed successfully
2025/03/04 03:04 INFO:Current modification time: 1741100644.6835606
2025/03/04 03:04 INFO:Last modification time: 1740757862.6744745
2025/03/04 03:04 INFO:is_file_updated executed successfully
2025/03/04 03:04 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:04 ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 03:04 INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 03:04 DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 03:04 DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 03:04 DEBUG:Calling map_mp_to_party with args={args}, kwargs={kwargs}
2025/03/04 03:04 DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 03:04 DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 03:04 DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 03:04 DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 03:04 DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 03:04 ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 03:04 ERROR:Attempting to remove duplicates
2025/03/04 03:04 DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 03:04 DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 03:04 INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 03:04 INFO:map_mp_to_party executed successfully
2025/03/04 03:04 DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 03:04 DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 03:04 DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 03:04 DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 03:04 DEBUG:Calling load_election_dates with args={args}, kwargs={kwargs}
2025/03/04 03:04 DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:04 DEBUG:try to load previous election dates from file.
2025/03/04 03:04 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:04 INFO:Saved file path: reference_files\elections.csv
2025/03/04 03:04 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 03:04 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:04 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 03:04 INFO:get_file_modification_time executed successfully
2025/03/04 03:04 INFO:Current modification time: 1740757862.6744745
2025/03/04 03:04 INFO:Last modification time: None
2025/03/04 03:04 INFO:is_file_updated executed successfully
2025/03/04 03:04 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:04 ERROR:Failed to load election dates from file.
2025/03/04 03:04 INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 03:04 INFO:Election Dates loaded vis pdpy.
2025/03/04 03:04 DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 03:04 INFO:Election Dates Loaded Successfully.
2025/03/04 03:04 DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 03:04 DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 03:04 INFO:load_election_dates executed successfully
2025/03/04 03:04 ERROR:Error in load_cleaned_data: cannot subtract DatetimeArray from ndarray
Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 359, in load_cleaned_data
    get_days_till_next_election(loadclean_df["ReceivedDate"])
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 344, in get_days_till_next_election
    return (next_election_dates - date_series).dt.days
  File "H:\python310\lib\site-packages\pandas\core\generic.py", line 2171, in __array_ufunc__
    return arraylike.array_ufunc(self, ufunc, method, *inputs, **kwargs)
  File "H:\python310\lib\site-packages\pandas\core\arraylike.py", line 276, in array_ufunc
    result = maybe_dispatch_ufunc_to_dunder_op(self, ufunc, method, *inputs, **kwargs)
  File "ops_dispatch.pyx", line 113, in pandas._libs.ops_dispatch.maybe_dispatch_ufunc_to_dunder_op
  File "H:\python310\lib\site-packages\pandas\core\ops\common.py", line 76, in new_method
    return method(self, other)
  File "H:\python310\lib\site-packages\pandas\core\arraylike.py", line 198, in __rsub__
    return self._arith_method(other, roperator.rsub)
  File "H:\python310\lib\site-packages\pandas\core\series.py", line 6135, in _arith_method
    return base.IndexOpsMixin._arith_method(self, other, op)
  File "H:\python310\lib\site-packages\pandas\core\base.py", line 1382, in _arith_method
    result = ops.arithmetic_op(lvalues, rvalues, op)
  File "H:\python310\lib\site-packages\pandas\core\ops\array_ops.py", line 273, in arithmetic_op
    res_values = op(left, right)
  File "H:\python310\lib\site-packages\pandas\core\roperator.py", line 15, in rsub
    return right - left
  File "H:\python310\lib\site-packages\pandas\core\arrays\datetimelike.py", line 2200, in __array_ufunc__
    return super().__array_ufunc__(ufunc, method, *inputs, **kwargs)
  File "H:\python310\lib\site-packages\pandas\core\arrays\base.py", line 2282, in __array_ufunc__
    result = arraylike.maybe_dispatch_ufunc_to_dunder_op(
  File "ops_dispatch.pyx", line 113, in pandas._libs.ops_dispatch.maybe_dispatch_ufunc_to_dunder_op
  File "H:\python310\lib\site-packages\pandas\core\arrays\datetimelike.py", line 1499, in __rsub__
    raise TypeError(
TypeError: cannot subtract DatetimeArray from ndarray
2025/03/04 03:04 CRITICAL:First load crashed: cannot subtract DatetimeArray from ndarray
Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py", line 80, in <module>
    initialise_data()  # Load the data
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_utils.py", line 42, in initialise_data
    firstload()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 83, in firstload
    load_data_to_session("data_clean", get_cleaned_data)
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 97, in load_data_to_session
    st.session_state[key] = loader_function()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\data_loader.py", line 39, in get_cleaned_data
    return load_cleaned_data(
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 217, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 259, in _get_or_create_cached_value
    return self._handle_cache_miss(cache, value_key, func_args, func_kwargs)
  File "H:\python310\lib\site-packages\streamlit\runtime\caching\cache_utils.py", line 317, in _handle_cache_miss
    computed_value = self._info.func(*func_args, **func_kwargs)
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 359, in load_cleaned_data
    get_days_till_next_election(loadclean_df["ReceivedDate"])
  File "H:\VScode\dashboard_demo-1\data\clean_and_enhance.py", line 344, in get_days_till_next_election
    return (next_election_dates - date_series).dt.days
  File "H:\python310\lib\site-packages\pandas\core\generic.py", line 2171, in __array_ufunc__
    return arraylike.array_ufunc(self, ufunc, method, *inputs, **kwargs)
  File "H:\python310\lib\site-packages\pandas\core\arraylike.py", line 276, in array_ufunc
    result = maybe_dispatch_ufunc_to_dunder_op(self, ufunc, method, *inputs, **kwargs)
  File "ops_dispatch.pyx", line 113, in pandas._libs.ops_dispatch.maybe_dispatch_ufunc_to_dunder_op
  File "H:\python310\lib\site-packages\pandas\core\ops\common.py", line 76, in new_method
    return method(self, other)
  File "H:\python310\lib\site-packages\pandas\core\arraylike.py", line 198, in __rsub__
    return self._arith_method(other, roperator.rsub)
  File "H:\python310\lib\site-packages\pandas\core\series.py", line 6135, in _arith_method
    return base.IndexOpsMixin._arith_method(self, other, op)
  File "H:\python310\lib\site-packages\pandas\core\base.py", line 1382, in _arith_method
    result = ops.arithmetic_op(lvalues, rvalues, op)
  File "H:\python310\lib\site-packages\pandas\core\ops\array_ops.py", line 273, in arithmetic_op
    res_values = op(left, right)
  File "H:\python310\lib\site-packages\pandas\core\roperator.py", line 15, in rsub
    return right - left
  File "H:\python310\lib\site-packages\pandas\core\arrays\datetimelike.py", line 2200, in __array_ufunc__
    return super().__array_ufunc__(ufunc, method, *inputs, **kwargs)
  File "H:\python310\lib\site-packages\pandas\core\arrays\base.py", line 2282, in __array_ufunc__
    result = arraylike.maybe_dispatch_ufunc_to_dunder_op(
  File "ops_dispatch.pyx", line 113, in pandas._libs.ops_dispatch.maybe_dispatch_ufunc_to_dunder_op
  File "H:\python310\lib\site-packages\pandas\core\arrays\datetimelike.py", line 1499, in __rsub__
    raise TypeError(
TypeError: cannot subtract DatetimeArray from ndarray
2025/03/04 03:06 INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 03:06 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:get_git_version executed successfully
2025/03/04 03:06 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:get_git_version executed successfully
2025/03/04 03:06 INFO:Streamlit App Starting...
2025/03/04 03:06 INFO:Streamlit App Starting...
2025/03/04 03:06 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 03:06 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 03:06 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 03:06 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 03:06 INFO:Running App setup...
2025/03/04 03:06 INFO:Running App setup...
2025/03/04 03:06 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Setting up the package
2025/03/04 03:06 INFO:Setting up the package
2025/03/04 03:06 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 03:06 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 03:06 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:get_git_version executed successfully
2025/03/04 03:06 INFO:get_git_version executed successfully
2025/03/04 03:06 INFO:Version: v20.143
2025/03/04 03:06 INFO:Version: v20.143
2025/03/04 03:06 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:06 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:06 DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 03:06 DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 03:06 DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 03:06 DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 03:06 DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:06 DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:06 DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 03:06 DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 03:06 DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 03:06 DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 03:06 DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:06 DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:06 DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:06 DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:06 DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:06 DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:06 DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:06 DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:06 DEBUG:Initialised perc_target with value: 0.5
2025/03/04 03:06 DEBUG:Initialised perc_target with value: 0.5
2025/03/04 03:06 DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 03:06 DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 03:06 DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:06 DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:06 DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 03:06 DEBUG:Initialised data_dir with value: data
2025/03/04 03:06 DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 03:06 DEBUG:Initialised output_dir with value: output
2025/03/04 03:06 DEBUG:Initialised data_dir with value: data
2025/03/04 03:06 DEBUG:Initialised logs_dir with value: logs
2025/03/04 03:06 DEBUG:Initialised output_dir with value: output
2025/03/04 03:06 DEBUG:Initialised components_dir with value: components
2025/03/04 03:06 DEBUG:Initialised logs_dir with value: logs
2025/03/04 03:06 DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 03:06 DEBUG:Initialised components_dir with value: components
2025/03/04 03:06 DEBUG:Initialised utils_dir with value: utils
2025/03/04 03:06 DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 03:06 DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:06 DEBUG:Initialised utils_dir with value: utils
2025/03/04 03:06 DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:06 DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:06 DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 03:06 DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:06 DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:06 DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 03:06 DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:06 DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:06 DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:06 DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:06 DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 03:06 DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:06 DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 03:06 DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 03:06 DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 03:06 DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 03:06 DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 03:06 DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 03:06 DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 03:06 DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 03:06 DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 03:06 DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 03:06 DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 03:06 DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 03:06 DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 03:06 DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 03:06 DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 03:06 DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 03:06 DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 03:06 DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 03:06 DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:06 DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 03:06 DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 03:06 DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:06 INFO:Session_state variables initialized
2025/03/04 03:06 DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 03:06 DEBUG:perc_target: 0.5
2025/03/04 03:06 INFO:Session_state variables initialized
2025/03/04 03:06 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:06 DEBUG:perc_target: 0.5
2025/03/04 03:06 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:06 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:06 DEBUG:components_dir: components
2025/03/04 03:06 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:06 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 03:06 DEBUG:components_dir: components
2025/03/04 03:06 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:06 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 03:06 DEBUG:output_dir: output
2025/03/04 03:06 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:06 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:06 DEBUG:output_dir: output
2025/03/04 03:06 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:06 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:06 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:06 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:06 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 03:06 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:06 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 03:06 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 03:06 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 03:06 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 03:06 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:06 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 03:06 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 03:06 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 03:06 DEBUG:utils_dir: utils
2025/03/04 03:06 DEBUG:utils_dir: utils
2025/03/04 03:06 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 03:06 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 03:06 DEBUG:logs_dir: logs
2025/03/04 03:06 DEBUG:logs_dir: logs
2025/03/04 03:06 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:06 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:06 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:06 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:06 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:06 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:06 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 03:06 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 03:06 DEBUG:app_pages_dir: app_pages
2025/03/04 03:06 DEBUG:app_pages_dir: app_pages
2025/03/04 03:06 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 03:06 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 03:06 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:06 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:06 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 03:06 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 03:06 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 03:06 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 03:06 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:06 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:06 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 03:06 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 03:06 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 03:06 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 03:06 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 03:06 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 03:06 DEBUG:data_dir: data
2025/03/04 03:06 DEBUG:data_dir: data
2025/03/04 03:06 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:06 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:06 DEBUG:reference_dir: reference_files
2025/03/04 03:06 DEBUG:reference_dir: reference_files
2025/03/04 03:06 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 03:06 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 03:06 DEBUG:LOG_LEVEL: ERROR
2025/03/04 03:06 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:06 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:06 DEBUG:LOG_LEVEL: ERROR
2025/03/04 03:06 INFO:Session state Setup complete
2025/03/04 03:06 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:06 INFO:initialize_session_state executed successfully
2025/03/04 03:06 INFO:Session state Setup complete
2025/03/04 03:06 INFO:Package setup complete
2025/03/04 03:06 INFO:initialize_session_state executed successfully
2025/03/04 03:06 INFO:setup_package executed successfully
2025/03/04 03:06 INFO:Package setup complete
2025/03/04 03:06 INFO:Setup completed successfully.
2025/03/04 03:06 INFO:setup_package executed successfully
2025/03/04 03:06 INFO:Running Menu setup...
2025/03/04 03:06 INFO:Setup completed successfully.
2025/03/04 03:06 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Running Menu setup...
2025/03/04 03:06 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:get_git_version executed successfully
2025/03/04 03:06 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:get_git_version executed successfully
2025/03/04 03:06 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:get_git_version executed successfully
2025/03/04 03:06 INFO:get_git_version executed successfully
2025/03/04 03:06 INFO:App Version: v20.164
2025/03/04 03:06 INFO:App Version: v20.164
2025/03/04 03:06 INFO:Switched to page: Introduction
2025/03/04 03:06 INFO:Switched to page: Introduction
2025/03/04 03:06 INFO:pagesetup executed successfully
2025/03/04 03:06 INFO:pagesetup executed successfully
2025/03/04 03:06 INFO:Menu setup completed successfully.
2025/03/04 03:06 INFO:Menu setup completed successfully.
2025/03/04 03:06 INFO:No data found in session state, running firstload()
2025/03/04 03:06 INFO:No data found in session state, running firstload()
2025/03/04 03:06 DEBUG:Calling initialise_data with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Running first load function.
2025/03/04 03:06 DEBUG:Calling firstload with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Calling get_raw_data with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Calling load_raw_data with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 03:06 DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 03:06 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:06 INFO:Saved file path: output\imported_raw.csv
2025/03/04 03:06 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 03:06 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 03:06 INFO:get_file_modification_time executed successfully
2025/03/04 03:06 INFO:Current modification time: 1740757862.6744745
2025/03/04 03:06 INFO:Last modification time: None
2025/03/04 03:06 INFO:is_file_updated executed successfully
2025/03/04 03:06 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:06 INFO:Loading raw data...
2025/03/04 03:06 DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 03:06 DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 03:06 INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 03:06 INFO:Data saved to output\imported_raw.csv
2025/03/04 03:06 DEBUG:Calling raw_data_cleanup with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Cleaning up raw data
2025/03/04 03:06 ERROR:Session state variables not initialized!
2025/03/04 03:06 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Original file path: None
2025/03/04 03:06 INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 03:06 ERROR:Error: originalfilepath is None!
2025/03/04 03:06 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:06 INFO:Data loaded, shape: (65278, 29)
2025/03/04 03:06 DEBUG:Calling dedupe_entity_file with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 03:06 INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 03:06 DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 03:06 INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 03:06 INFO:dedupe_entity_file executed successfully
2025/03/04 03:06 DEBUG:Calling dedupe_entity_file with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 03:06 INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 03:06 DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 03:06 INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 03:06 INFO:dedupe_entity_file executed successfully
2025/03/04 03:06 INFO:Raw Data cleanup completed
2025/03/04 03:06 INFO:Data shape: (65278, 37)
2025/03/04 03:06 INFO:Data saved to output\cleaned_donations.csv
2025/03/04 03:06 INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 03:06 INFO:raw_data_cleanup executed successfully
2025/03/04 03:06 INFO:load_raw_data executed successfully
2025/03/04 03:06 INFO:get_raw_data executed successfully
2025/03/04 03:06 INFO:load_data_to_session executed successfully
2025/03/04 03:06 DEBUG:st.session_state.raw_data: 65278
2025/03/04 03:06 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Calling get_cleaned_data with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Calling load_cleaned_data with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Rows in Raw Data: 65278
2025/03/04 03:06 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Original file path: output\cleaned_donations.csv
2025/03/04 03:06 INFO:Saved file path: output\cleaned_data.csv
2025/03/04 03:06 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 03:06 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:06 INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 03:06 INFO:get_file_modification_time executed successfully
2025/03/04 03:06 INFO:Current modification time: 1741100818.0719411
2025/03/04 03:06 INFO:Last modification time: 1740757862.6744745
2025/03/04 03:06 INFO:is_file_updated executed successfully
2025/03/04 03:06 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:06 ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 03:06 INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 03:06 DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 03:06 DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 03:06 DEBUG:Calling map_mp_to_party with args={args}, kwargs={kwargs}
2025/03/04 03:06 DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 03:06 DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 03:06 DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 03:06 DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 03:07 DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 03:07 ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 03:07 ERROR:Attempting to remove duplicates
2025/03/04 03:07 DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 03:07 DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 03:07 INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 03:07 INFO:map_mp_to_party executed successfully
2025/03/04 03:07 DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 03:07 DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 03:07 DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 03:07 DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 03:07 DEBUG:Calling load_election_dates with args={args}, kwargs={kwargs}
2025/03/04 03:07 DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:07 DEBUG:try to load previous election dates from file.
2025/03/04 03:07 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:07 INFO:Saved file path: reference_files\elections.csv
2025/03/04 03:07 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 03:07 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 03:07 INFO:get_file_modification_time executed successfully
2025/03/04 03:07 INFO:Current modification time: 1740757862.6744745
2025/03/04 03:07 INFO:Last modification time: None
2025/03/04 03:07 INFO:is_file_updated executed successfully
2025/03/04 03:07 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:07 ERROR:Failed to load election dates from file.
2025/03/04 03:07 INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 03:07 INFO:Election Dates loaded vis pdpy.
2025/03/04 03:07 DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 03:07 INFO:Election Dates Loaded Successfully.
2025/03/04 03:07 DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 03:07 DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 03:07 INFO:load_election_dates executed successfully
2025/03/04 03:07 DEBUG:Clean Data Prep 353: Election dates: 65278
2025/03/04 03:07 DEBUG:Clean Data Prep 386: End of clean: 65278
2025/03/04 03:07 INFO:Cleaned Data completed, shape: (65278, 57)
2025/03/04 03:07 INFO:load_cleaned_data executed successfully
2025/03/04 03:07 INFO:get_cleaned_data executed successfully
2025/03/04 03:07 INFO:load_data_to_session executed successfully
2025/03/04 03:07 DEBUG:st.session_state.raw_data: 65278
2025/03/04 03:07 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:07 DEBUG:Calling get_donor_data with args={args}, kwargs={kwargs}
2025/03/04 03:07 DEBUG:Calling load_donorList_data with args={args}, kwargs={kwargs}
2025/03/04 03:07 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:Original file path: output\cleaned_data.csv
2025/03/04 03:07 INFO:Saved file path: output\cleaned_donorlist.csv
2025/03/04 03:07 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 03:07 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 03:07 INFO:get_file_modification_time executed successfully
2025/03/04 03:07 INFO:Current modification time: 1741100822.233424
2025/03/04 03:07 INFO:Last modification time: None
2025/03/04 03:07 INFO:is_file_updated executed successfully
2025/03/04 03:07 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:07 INFO:Donor data saved to output\cleaned_donorlist.csv
2025/03/04 03:07 INFO:Donor Data summary completed
2025/03/04 03:07 INFO:Data shape: (25576, 5)
2025/03/04 03:07 INFO:load_donorList_data executed successfully
2025/03/04 03:07 INFO:get_donor_data executed successfully
2025/03/04 03:07 INFO:load_data_to_session executed successfully
2025/03/04 03:07 DEBUG:st.session_state.data_donor: 25576
2025/03/04 03:07 DEBUG:st.session_state.data_clean: 65278
2025/03/04 03:07 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:07 DEBUG:Calling get_regentity_data with args={args}, kwargs={kwargs}
2025/03/04 03:07 DEBUG:Calling load_regulated_entity_data with args={args}, kwargs={kwargs}
2025/03/04 03:07 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:Original file path: output\cleaned_data.csv
2025/03/04 03:07 INFO:Saved file path: output\cleaned_regentity.csv
2025/03/04 03:07 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 03:07 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 03:07 INFO:get_file_modification_time executed successfully
2025/03/04 03:07 INFO:Current modification time: 1741100822.233424
2025/03/04 03:07 INFO:Last modification time: 1741100822.233424
2025/03/04 03:07 INFO:is_file_updated executed successfully
2025/03/04 03:07 INFO:Loading preprocessed data. Using output\cleaned_regentity.csv dated load_donorlist_data_last_modified instead of output\cleaned_data.csv
2025/03/04 03:07 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:07 INFO:load_regulated_entity_data executed successfully
2025/03/04 03:07 INFO:get_regentity_data executed successfully
2025/03/04 03:07 INFO:load_data_to_session executed successfully
2025/03/04 03:07 DEBUG:st.session_state.data_regentity: 1364
2025/03/04 03:07 DEBUG:st.session_state.data_donor: 25576
2025/03/04 03:07 DEBUG:st.session_state.data_clean: 65278
2025/03/04 03:07 INFO:firstload executed successfully
2025/03/04 03:07 INFO:Data first load completed successfully.
2025/03/04 03:07 INFO:initialise_data executed successfully
2025/03/04 03:07 INFO:App is fully loaded and ready!
2025/03/04 03:07 INFO:App is fully loaded and ready!
2025/03/04 03:07 INFO:Streamlit App Starting...
2025/03/04 03:07 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 03:07 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 03:07 INFO:Running App setup...
2025/03/04 03:07 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:Setting up the package
2025/03/04 03:07 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 03:07 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:get_git_version executed successfully
2025/03/04 03:07 INFO:Version: v20.143
2025/03/04 03:07 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:07 DEBUG:LOG_LEVEL already exists in session state
2025/03/04 03:07 DEBUG:BASE_DIR already exists in session state
2025/03/04 03:07 DEBUG:filenames already exists in session state
2025/03/04 03:07 DEBUG:PLACEHOLDER_DATE already exists in session state
2025/03/04 03:07 DEBUG:PLACEHOLDER_ID already exists in session state
2025/03/04 03:07 DEBUG:thresholds already exists in session state
2025/03/04 03:07 DEBUG:data_remappings already exists in session state
2025/03/04 03:07 DEBUG:filter_def already exists in session state
2025/03/04 03:07 DEBUG:security already exists in session state
2025/03/04 03:07 DEBUG:perc_target already exists in session state
2025/03/04 03:07 DEBUG:RERUN_MP_PARTY_MEMBERSHIP already exists in session state
2025/03/04 03:07 DEBUG:directories already exists in session state
2025/03/04 03:07 DEBUG:reference_dir already exists in session state
2025/03/04 03:07 DEBUG:data_dir already exists in session state
2025/03/04 03:07 DEBUG:output_dir already exists in session state
2025/03/04 03:07 DEBUG:logs_dir already exists in session state
2025/03/04 03:07 DEBUG:components_dir already exists in session state
2025/03/04 03:07 DEBUG:app_pages_dir already exists in session state
2025/03/04 03:07 DEBUG:utils_dir already exists in session state
2025/03/04 03:07 DEBUG:Donor_dedupe_cleaned_fname already exists in session state
2025/03/04 03:07 DEBUG:ListofPoliticalPeople_fname already exists in session state
2025/03/04 03:07 DEBUG:mppartymemb_fname already exists in session state
2025/03/04 03:07 DEBUG:donor_map_fname already exists in session state
2025/03/04 03:07 DEBUG:politician_party_fname already exists in session state
2025/03/04 03:07 DEBUG:regentity_map_fname already exists in session state
2025/03/04 03:07 DEBUG:original_data_fname already exists in session state
2025/03/04 03:07 DEBUG:CREDENTIALS_FILE already exists in session state
2025/03/04 03:07 DEBUG:TEXT_FILE already exists in session state
2025/03/04 03:07 DEBUG:ELECTION_DATES already exists in session state
2025/03/04 03:07 DEBUG:cleaned_data_fname already exists in session state
2025/03/04 03:07 DEBUG:cleaned_donations_fname already exists in session state
2025/03/04 03:07 DEBUG:cleaned_donorlist_fname already exists in session state
2025/03/04 03:07 DEBUG:cleaned_regentity_fname already exists in session state
2025/03/04 03:07 DEBUG:party_summary_fname already exists in session state
2025/03/04 03:07 DEBUG:imported_raw_fname already exists in session state
2025/03/04 03:07 DEBUG:source_data_fname already exists in session state
2025/03/04 03:07 DEBUG:Cash_ftr already exists in session state
2025/03/04 03:07 INFO:Session_state variables initialized
2025/03/04 03:07 DEBUG:perc_target: 0.5
2025/03/04 03:07 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:07 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:07 DEBUG:components_dir: components
2025/03/04 03:07 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 03:07 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:07 DEBUG:output_dir: output
2025/03/04 03:07 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:07 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:07 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:07 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 03:07 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 03:07 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 03:07 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 03:07 DEBUG:utils_dir: utils
2025/03/04 03:07 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 03:07 DEBUG:logs_dir: logs
2025/03/04 03:07 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:07 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:07 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:07 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 03:07 DEBUG:app_pages_dir: app_pages
2025/03/04 03:07 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 03:07 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:07 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 03:07 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 03:07 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:07 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 03:07 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 03:07 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 03:07 DEBUG:data_dir: data
2025/03/04 03:07 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:07 DEBUG:reference_dir: reference_files
2025/03/04 03:07 DEBUG:menu_selection: {'title': 'Head Line Figures', 'function': <function hlf_body at 0x000001A491552EF0>}
2025/03/04 03:07 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 03:07 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:07 DEBUG:LOG_LEVEL: ERROR
2025/03/04 03:07 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:07 INFO:Session state Setup complete
2025/03/04 03:07 INFO:initialize_session_state executed successfully
2025/03/04 03:07 INFO:Package setup complete
2025/03/04 03:07 INFO:setup_package executed successfully
2025/03/04 03:07 INFO:Setup completed successfully.
2025/03/04 03:07 INFO:Running Menu setup...
2025/03/04 03:07 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 03:07 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:07 INFO:get_git_version executed successfully
2025/03/04 03:07 INFO:App Version: v20.164
2025/03/04 03:07 INFO:Switched to page: Head Line Figures
2025/03/04 03:07 DEBUG:Calling hlf_body with args={args}, kwargs={kwargs}
2025/03/04 03:07 DEBUG:Calling load_and_filter_data with args={args}, kwargs={kwargs}
2025/03/04 03:07 ERROR:Error in load_and_filter_data: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 452, in __getitem__
    return self._getitem(widget_id, key)
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 497, in _getitem
    raise KeyError
KeyError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 130, in __getattr__
    return self[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 101, in __getitem__
    return get_session_state()[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\safe_session_state.py", line 96, in __getitem__
    return self._state[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 454, in __getitem__
    raise KeyError(_missing_key_error_message(key))
KeyError: 'st.session_state has no key "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\components\modular_page_blocks.py", line 23, in load_and_filter_data
    cleaned_df = st.session_state.data_clean
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 132, in __getattr__
    raise AttributeError(_missing_attr_error_message(key))
AttributeError: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
2025/03/04 03:07 CRITICAL:Menu setup crashed: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 452, in __getitem__
    return self._getitem(widget_id, key)
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 497, in _getitem
    raise KeyError
KeyError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 130, in __getattr__
    return self[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 101, in __getitem__
    return get_session_state()[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\safe_session_state.py", line 96, in __getitem__
    return self._state[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 454, in __getitem__
    raise KeyError(_missing_key_error_message(key))
KeyError: 'st.session_state has no key "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py", line 46, in <module>
    politicalpartyanalysis.pagesetup()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\politicalpartyanalysis.py", line 73, in pagesetup
    app.run()  # Run the  app
  File "H:\VScode\dashboard_demo-1\app_pages\multi_page.py", line 47, in run
    page["function"]()  # Run the selected page's function
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\app_pages\headlinefigures.py", line 27, in hlf_body
    load_and_filter_data(filter_key=filter_key,
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\components\modular_page_blocks.py", line 23, in load_and_filter_data
    cleaned_df = st.session_state.data_clean
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 132, in __getattr__
    raise AttributeError(_missing_attr_error_message(key))
AttributeError: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
2025/03/04 03:08 INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 03:08 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:get_git_version executed successfully
2025/03/04 03:08 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:get_git_version executed successfully
2025/03/04 03:08 INFO:Streamlit App Starting...
2025/03/04 03:08 INFO:Streamlit App Starting...
2025/03/04 03:08 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 03:08 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 03:08 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 03:08 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 03:08 INFO:Running App setup...
2025/03/04 03:08 INFO:Running App setup...
2025/03/04 03:08 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:Setting up the package
2025/03/04 03:08 INFO:Setting up the package
2025/03/04 03:08 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 03:08 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 03:08 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:get_git_version executed successfully
2025/03/04 03:08 INFO:get_git_version executed successfully
2025/03/04 03:08 INFO:Version: v20.143
2025/03/04 03:08 INFO:Version: v20.143
2025/03/04 03:08 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:08 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:08 DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 03:08 DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 03:08 DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 03:08 DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 03:08 DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:08 DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:08 DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 03:08 DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 03:08 DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 03:08 DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 03:08 DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:08 DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:08 DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:08 DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:08 DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:08 DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:08 DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:08 DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:08 DEBUG:Initialised perc_target with value: 0.5
2025/03/04 03:08 DEBUG:Initialised perc_target with value: 0.5
2025/03/04 03:08 DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 03:08 DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 03:08 DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:08 DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:08 DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 03:08 DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 03:08 DEBUG:Initialised data_dir with value: data
2025/03/04 03:08 DEBUG:Initialised data_dir with value: data
2025/03/04 03:08 DEBUG:Initialised output_dir with value: output
2025/03/04 03:08 DEBUG:Initialised output_dir with value: output
2025/03/04 03:08 DEBUG:Initialised logs_dir with value: logs
2025/03/04 03:08 DEBUG:Initialised logs_dir with value: logs
2025/03/04 03:08 DEBUG:Initialised components_dir with value: components
2025/03/04 03:08 DEBUG:Initialised components_dir with value: components
2025/03/04 03:08 DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 03:08 DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 03:08 DEBUG:Initialised utils_dir with value: utils
2025/03/04 03:08 DEBUG:Initialised utils_dir with value: utils
2025/03/04 03:08 DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:08 DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:08 DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:08 DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:08 DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 03:08 DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 03:08 DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:08 DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:08 DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:08 DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:08 DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:08 DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:08 DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 03:08 DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 03:08 DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 03:08 DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 03:08 DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 03:08 DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 03:08 DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 03:08 DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 03:08 DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 03:08 DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 03:08 DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 03:08 DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 03:08 DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 03:08 DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 03:08 DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 03:08 DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 03:08 DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 03:08 DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 03:08 DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 03:08 DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 03:08 DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:08 DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:08 DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 03:08 DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 03:08 INFO:Session_state variables initialized
2025/03/04 03:08 INFO:Session_state variables initialized
2025/03/04 03:08 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 03:08 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 03:08 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:08 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:08 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 03:08 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 03:08 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:08 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:08 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:08 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:08 DEBUG:utils_dir: utils
2025/03/04 03:08 DEBUG:utils_dir: utils
2025/03/04 03:08 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 03:08 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 03:08 DEBUG:reference_dir: reference_files
2025/03/04 03:08 DEBUG:reference_dir: reference_files
2025/03/04 03:08 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:08 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:08 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 03:08 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 03:08 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:08 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:08 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 03:08 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 03:08 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:08 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:08 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:08 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:08 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 03:08 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 03:08 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:08 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:08 DEBUG:LOG_LEVEL: ERROR
2025/03/04 03:08 DEBUG:LOG_LEVEL: ERROR
2025/03/04 03:08 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 03:08 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 03:08 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:08 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:08 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 03:08 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 03:08 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:08 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:08 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:08 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:08 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:08 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:08 DEBUG:data_dir: data
2025/03/04 03:08 DEBUG:data_dir: data
2025/03/04 03:08 DEBUG:logs_dir: logs
2025/03/04 03:08 DEBUG:logs_dir: logs
2025/03/04 03:08 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:08 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:08 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:08 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:08 DEBUG:perc_target: 0.5
2025/03/04 03:08 DEBUG:perc_target: 0.5
2025/03/04 03:08 DEBUG:output_dir: output
2025/03/04 03:08 DEBUG:output_dir: output
2025/03/04 03:08 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 03:08 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 03:08 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 03:08 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 03:08 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 03:08 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 03:08 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 03:08 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 03:08 DEBUG:app_pages_dir: app_pages
2025/03/04 03:08 DEBUG:app_pages_dir: app_pages
2025/03/04 03:08 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 03:08 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 03:08 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 03:08 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 03:08 DEBUG:components_dir: components
2025/03/04 03:08 DEBUG:components_dir: components
2025/03/04 03:08 INFO:Session state Setup complete
2025/03/04 03:08 INFO:Session state Setup complete
2025/03/04 03:08 INFO:initialize_session_state executed successfully
2025/03/04 03:08 INFO:initialize_session_state executed successfully
2025/03/04 03:08 INFO:Package setup complete
2025/03/04 03:08 INFO:Package setup complete
2025/03/04 03:08 INFO:setup_package executed successfully
2025/03/04 03:08 INFO:setup_package executed successfully
2025/03/04 03:08 INFO:Setup completed successfully.
2025/03/04 03:08 INFO:Setup completed successfully.
2025/03/04 03:08 INFO:Running Menu setup...
2025/03/04 03:08 INFO:Running Menu setup...
2025/03/04 03:08 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:get_git_version executed successfully
2025/03/04 03:08 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:get_git_version executed successfully
2025/03/04 03:08 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:get_git_version executed successfully
2025/03/04 03:08 INFO:get_git_version executed successfully
2025/03/04 03:08 INFO:App Version: v20.164
2025/03/04 03:08 INFO:App Version: v20.164
2025/03/04 03:08 INFO:Switched to page: Introduction
2025/03/04 03:08 INFO:Switched to page: Head Line Figures
2025/03/04 03:08 DEBUG:Calling hlf_body with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Calling load_and_filter_data with args={args}, kwargs={kwargs}
2025/03/04 03:08 ERROR:Error in load_and_filter_data: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 452, in __getitem__
    return self._getitem(widget_id, key)
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 497, in _getitem
    raise KeyError
KeyError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 130, in __getattr__
    return self[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 101, in __getitem__
    return get_session_state()[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\safe_session_state.py", line 96, in __getitem__
    return self._state[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 454, in __getitem__
    raise KeyError(_missing_key_error_message(key))
KeyError: 'st.session_state has no key "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\components\modular_page_blocks.py", line 23, in load_and_filter_data
    cleaned_df = st.session_state.data_clean
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 132, in __getattr__
    raise AttributeError(_missing_attr_error_message(key))
AttributeError: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
2025/03/04 03:08 INFO:pagesetup executed successfully
2025/03/04 03:08 CRITICAL:Menu setup crashed: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 452, in __getitem__
    return self._getitem(widget_id, key)
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 497, in _getitem
    raise KeyError
KeyError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 130, in __getattr__
    return self[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 101, in __getitem__
    return get_session_state()[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\safe_session_state.py", line 96, in __getitem__
    return self._state[key]
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state.py", line 454, in __getitem__
    raise KeyError(_missing_key_error_message(key))
KeyError: 'st.session_state has no key "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py", line 46, in <module>
    politicalpartyanalysis.pagesetup()
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\politicalpartyanalysis.py", line 73, in pagesetup
    app.run()  # Run the  app
  File "H:\VScode\dashboard_demo-1\app_pages\multi_page.py", line 47, in run
    page["function"]()  # Run the selected page's function
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\app_pages\headlinefigures.py", line 27, in hlf_body
    load_and_filter_data(filter_key=filter_key,
  File "H:\VScode\dashboard_demo-1\utils\logger.py", line 41, in wrapper
    result = func(*args, **kwargs)
  File "H:\VScode\dashboard_demo-1\components\modular_page_blocks.py", line 23, in load_and_filter_data
    cleaned_df = st.session_state.data_clean
  File "H:\python310\lib\site-packages\streamlit\runtime\state\session_state_proxy.py", line 132, in __getattr__
    raise AttributeError(_missing_attr_error_message(key))
AttributeError: st.session_state has no attribute "data_clean". Did you forget to initialize it? More info: https://docs.streamlit.io/develop/concepts/architecture/session-state#initialization
2025/03/04 03:08 INFO:Menu setup completed successfully.
2025/03/04 03:08 INFO:No data found in session state, running firstload()
2025/03/04 03:08 DEBUG:Calling initialise_data with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:Running first load function.
2025/03/04 03:08 DEBUG:Calling firstload with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Calling get_raw_data with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Calling load_raw_data with args={args}, kwargs={kwargs}
2025/03/04 03:08 DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 03:08 DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 03:08 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:08 INFO:Saved file path: output\imported_raw.csv
2025/03/04 03:08 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 03:08 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 03:08 INFO:get_file_modification_time executed successfully
2025/03/04 03:08 INFO:Current modification time: 1740757862.6744745
2025/03/04 03:08 INFO:Last modification time: None
2025/03/04 03:08 INFO:is_file_updated executed successfully
2025/03/04 03:08 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:08 INFO:Loading raw data...
2025/03/04 03:08 DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 03:08 DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 03:08 INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 03:08 INFO:Data saved to output\imported_raw.csv
2025/03/04 03:08 DEBUG:Calling raw_data_cleanup with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:Cleaning up raw data
2025/03/04 03:08 ERROR:Session state variables not initialized!
2025/03/04 03:08 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:Original file path: None
2025/03/04 03:08 INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 03:08 ERROR:Error: originalfilepath is None!
2025/03/04 03:08 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:08 INFO:Data loaded, shape: (65278, 29)
2025/03/04 03:08 DEBUG:Calling dedupe_entity_file with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 03:08 INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 03:08 DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 03:08 INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 03:08 INFO:dedupe_entity_file executed successfully
2025/03/04 03:08 DEBUG:Calling dedupe_entity_file with args={args}, kwargs={kwargs}
2025/03/04 03:08 INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 03:08 INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 03:08 DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 03:08 INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 03:08 INFO:dedupe_entity_file executed successfully
2025/03/04 03:08 INFO:Raw Data cleanup completed
2025/03/04 03:08 INFO:Data shape: (65278, 37)
2025/03/04 03:09 INFO:Data saved to output\cleaned_donations.csv
2025/03/04 03:09 INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 03:09 INFO:raw_data_cleanup executed successfully
2025/03/04 03:09 INFO:load_raw_data executed successfully
2025/03/04 03:09 INFO:get_raw_data executed successfully
2025/03/04 03:09 INFO:load_data_to_session executed successfully
2025/03/04 03:09 DEBUG:st.session_state.raw_data: 65278
2025/03/04 03:09 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:Calling get_cleaned_data with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:Calling load_cleaned_data with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:Rows in Raw Data: 65278
2025/03/04 03:09 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Original file path: output\cleaned_donations.csv
2025/03/04 03:09 INFO:Saved file path: output\cleaned_data.csv
2025/03/04 03:09 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 03:09 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 03:09 INFO:get_file_modification_time executed successfully
2025/03/04 03:09 INFO:Current modification time: 1741100940.5478525
2025/03/04 03:09 INFO:Last modification time: 1740757862.6744745
2025/03/04 03:09 INFO:is_file_updated executed successfully
2025/03/04 03:09 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:09 ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 03:09 INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 03:09 DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 03:09 DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 03:09 DEBUG:Calling map_mp_to_party with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 03:09 DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 03:09 DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 03:09 DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 03:09 DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 03:09 ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 03:09 ERROR:Attempting to remove duplicates
2025/03/04 03:09 DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 03:09 DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 03:09 INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 03:09 INFO:map_mp_to_party executed successfully
2025/03/04 03:09 DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 03:09 DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 03:09 DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 03:09 DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 03:09 DEBUG:Calling load_election_dates with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:09 DEBUG:try to load previous election dates from file.
2025/03/04 03:09 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:09 INFO:Saved file path: reference_files\elections.csv
2025/03/04 03:09 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 03:09 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 03:09 INFO:get_file_modification_time executed successfully
2025/03/04 03:09 INFO:Current modification time: 1740757862.6744745
2025/03/04 03:09 INFO:Last modification time: None
2025/03/04 03:09 INFO:is_file_updated executed successfully
2025/03/04 03:09 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:09 ERROR:Failed to load election dates from file.
2025/03/04 03:09 INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 03:09 INFO:Election Dates loaded vis pdpy.
2025/03/04 03:09 DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 03:09 INFO:Election Dates Loaded Successfully.
2025/03/04 03:09 DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 03:09 DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 03:09 INFO:load_election_dates executed successfully
2025/03/04 03:09 DEBUG:Clean Data Prep 353: Election dates: 65278
2025/03/04 03:09 DEBUG:Clean Data Prep 386: End of clean: 65278
2025/03/04 03:09 INFO:Cleaned Data completed, shape: (65278, 57)
2025/03/04 03:09 INFO:load_cleaned_data executed successfully
2025/03/04 03:09 INFO:get_cleaned_data executed successfully
2025/03/04 03:09 INFO:load_data_to_session executed successfully
2025/03/04 03:09 DEBUG:st.session_state.raw_data: 65278
2025/03/04 03:09 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:Calling get_donor_data with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:Calling load_donorList_data with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Original file path: output\cleaned_data.csv
2025/03/04 03:09 INFO:Saved file path: output\cleaned_donorlist.csv
2025/03/04 03:09 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 03:09 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 03:09 INFO:get_file_modification_time executed successfully
2025/03/04 03:09 INFO:Current modification time: 1741100945.1794162
2025/03/04 03:09 INFO:Last modification time: None
2025/03/04 03:09 INFO:is_file_updated executed successfully
2025/03/04 03:09 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:09 INFO:Donor data saved to output\cleaned_donorlist.csv
2025/03/04 03:09 INFO:Donor Data summary completed
2025/03/04 03:09 INFO:Data shape: (25576, 5)
2025/03/04 03:09 INFO:load_donorList_data executed successfully
2025/03/04 03:09 INFO:get_donor_data executed successfully
2025/03/04 03:09 INFO:load_data_to_session executed successfully
2025/03/04 03:09 DEBUG:st.session_state.data_donor: 25576
2025/03/04 03:09 DEBUG:st.session_state.data_clean: 65278
2025/03/04 03:09 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:Calling get_regentity_data with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:Calling load_regulated_entity_data with args={args}, kwargs={kwargs}
2025/03/04 03:09 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Original file path: output\cleaned_data.csv
2025/03/04 03:09 INFO:Saved file path: output\cleaned_regentity.csv
2025/03/04 03:09 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 03:09 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:09 INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 03:09 INFO:get_file_modification_time executed successfully
2025/03/04 03:09 INFO:Current modification time: 1741100945.1794162
2025/03/04 03:09 INFO:Last modification time: 1741100945.1794162
2025/03/04 03:09 INFO:is_file_updated executed successfully
2025/03/04 03:09 INFO:Loading preprocessed data. Using output\cleaned_regentity.csv dated load_donorlist_data_last_modified instead of output\cleaned_data.csv
2025/03/04 03:09 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:09 INFO:load_regulated_entity_data executed successfully
2025/03/04 03:09 INFO:get_regentity_data executed successfully
2025/03/04 03:09 INFO:load_data_to_session executed successfully
2025/03/04 03:09 DEBUG:st.session_state.data_regentity: 1364
2025/03/04 03:09 DEBUG:st.session_state.data_donor: 25576
2025/03/04 03:09 DEBUG:st.session_state.data_clean: 65278
2025/03/04 03:09 INFO:firstload executed successfully
2025/03/04 03:09 INFO:Data first load completed successfully.
2025/03/04 03:09 INFO:initialise_data executed successfully
2025/03/04 03:09 INFO:App is fully loaded and ready!
2025/03/04 03:12 INFO:Streamlit App Starting...
2025/03/04 03:12 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 03:12 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 03:12 INFO:Running App setup...
2025/03/04 03:12 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 03:12 INFO:Setting up the package
2025/03/04 03:12 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 03:12 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:12 INFO:get_git_version executed successfully
2025/03/04 03:12 INFO:Version: v20.143
2025/03/04 03:12 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 03:12 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:12 DEBUG:LOG_LEVEL already exists in session state
2025/03/04 03:12 DEBUG:BASE_DIR already exists in session state
2025/03/04 03:12 DEBUG:filenames already exists in session state
2025/03/04 03:12 DEBUG:PLACEHOLDER_DATE already exists in session state
2025/03/04 03:12 DEBUG:PLACEHOLDER_ID already exists in session state
2025/03/04 03:12 DEBUG:thresholds already exists in session state
2025/03/04 03:12 DEBUG:data_remappings already exists in session state
2025/03/04 03:12 DEBUG:filter_def already exists in session state
2025/03/04 03:12 DEBUG:security already exists in session state
2025/03/04 03:12 DEBUG:perc_target already exists in session state
2025/03/04 03:12 DEBUG:RERUN_MP_PARTY_MEMBERSHIP already exists in session state
2025/03/04 03:12 DEBUG:directories already exists in session state
2025/03/04 03:12 DEBUG:reference_dir already exists in session state
2025/03/04 03:12 DEBUG:data_dir already exists in session state
2025/03/04 03:12 DEBUG:output_dir already exists in session state
2025/03/04 03:12 DEBUG:logs_dir already exists in session state
2025/03/04 03:12 DEBUG:components_dir already exists in session state
2025/03/04 03:12 DEBUG:app_pages_dir already exists in session state
2025/03/04 03:12 DEBUG:utils_dir already exists in session state
2025/03/04 03:12 DEBUG:Donor_dedupe_cleaned_fname already exists in session state
2025/03/04 03:12 DEBUG:ListofPoliticalPeople_fname already exists in session state
2025/03/04 03:12 DEBUG:mppartymemb_fname already exists in session state
2025/03/04 03:12 DEBUG:donor_map_fname already exists in session state
2025/03/04 03:12 DEBUG:politician_party_fname already exists in session state
2025/03/04 03:12 DEBUG:regentity_map_fname already exists in session state
2025/03/04 03:12 DEBUG:original_data_fname already exists in session state
2025/03/04 03:12 DEBUG:CREDENTIALS_FILE already exists in session state
2025/03/04 03:12 DEBUG:TEXT_FILE already exists in session state
2025/03/04 03:12 DEBUG:ELECTION_DATES already exists in session state
2025/03/04 03:12 DEBUG:cleaned_data_fname already exists in session state
2025/03/04 03:12 DEBUG:cleaned_donations_fname already exists in session state
2025/03/04 03:12 DEBUG:cleaned_donorlist_fname already exists in session state
2025/03/04 03:12 DEBUG:cleaned_regentity_fname already exists in session state
2025/03/04 03:12 DEBUG:party_summary_fname already exists in session state
2025/03/04 03:12 DEBUG:imported_raw_fname already exists in session state
2025/03/04 03:12 DEBUG:source_data_fname already exists in session state
2025/03/04 03:12 DEBUG:Cash_ftr already exists in session state
2025/03/04 03:12 INFO:Session_state variables initialized
2025/03/04 03:12 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 03:12 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:12 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 03:12 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:12 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:12 DEBUG:election_dates_last_modified: 1740757862.6744745
2025/03/04 03:12 DEBUG:utils_dir: utils
2025/03/04 03:12 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 03:12 DEBUG:reference_dir: reference_files
2025/03/04 03:12 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:12 DEBUG:data_clean:            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... QtrsTillNextElection QtrsSinceLastElection YrsTillNextElection YrsSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                  2.0                 363.0                 1.0                 91.0
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                  2.0                 363.0                 1.0                 91.0
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                  2.0                 363.0                 1.0                 91.0
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                  2.0                 363.0                 1.0                 91.0
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                  2.0                 363.0                 1.0                 91.0
...          ...                              ...                    ...        ...  ...                  ...                   ...                 ...                  ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                  5.0                 349.0                 2.0                 87.0
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                  6.0                 348.0                 2.0                 87.0
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                  4.0                 350.0                 1.0                 88.0
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                  1.0                 354.0                 1.0                 89.0
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                  1.0                 354.0                 1.0                 89.0

[65278 rows x 57 columns]
2025/03/04 03:12 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 03:12 DEBUG:raw_data_clean:            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns]
2025/03/04 03:12 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:12 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 03:12 DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 03:12 DEBUG:menu_selection: {'title': 'Head Line Figures', 'function': <function hlf_body at 0x00000148F1B53400>}
2025/03/04 03:12 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:12 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:12 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 03:12 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:12 DEBUG:LOG_LEVEL: ERROR
2025/03/04 03:12 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 03:12 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:12 DEBUG:load_raw_data_last_modified: 1741100940.5478525
2025/03/04 03:12 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 03:12 DEBUG:load_donorlist_data_last_modified: 1741100945.1794162
2025/03/04 03:12 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:12 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:12 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:12 DEBUG:data_dir: data
2025/03/04 03:12 DEBUG:logs_dir: logs
2025/03/04 03:12 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:12 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:12 DEBUG:perc_target: 0.5
2025/03/04 03:12 DEBUG:output_dir: output
2025/03/04 03:12 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 03:12 DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 03:12 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 03:12 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 03:12 DEBUG:raw_data:            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...                 CleanedDonorName CleanedDonorId  DonorId                        DonorName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
...          ...                              ...                    ...        ...  ...                              ...            ...      ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...      Shaftesbury Investments Ltd        74198.0  74198.0      Shaftesbury Investments Ltd
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                Mr Jeremy Hosking        74184.0  74184.0                Mr Jeremy Hosking
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    Anthony Clake        23556.0  23556.0                    Anthony Clake
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                Mr Peter A Dubens         2146.0   2146.0                Mr Peter A Dubens
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                 Mr Ravi S Kailas        74743.0  74743.0                 Mr Ravi S Kailas

[65278 rows x 37 columns]
2025/03/04 03:12 DEBUG:data_regentity:       RegulatedEntityId                              Regulated Entity Name  Regulated Entity Group  Donations Value  Donation Events  Donation Mean
0                  17.0                                  English Democrats            Small Entity         99000.00               11    9000.000000
1                  19.0                         Legalise Cannabis Alliance            Small Entity         35500.00               13    2730.769231
2                  30.0        Upminster And Cranham Residents Association  Single Donation Entity         10000.00                1   10000.000000
3                  39.0                                          Sinn FÃ©in     Medium Large Entity       2506699.11              359    6982.448774
4                  44.0  Independent Kidderminster Hospital And Health ...            Small Entity         31949.00                8    3993.625000
...                 ...                                                ...                     ...              ...              ...            ...
1359            10263.0                                    Jonathan Gullis  Single Donation Entity          2500.00                1    2500.000000
1360            10264.0                                      Robert Largan  Single Donation Entity          2000.00                1    2000.000000
1361            10265.0                                         Jane Dodds       Very Small Entity          3529.41                2    1764.705000
1362            10266.0                                        Phil Wilson  Single Donation Entity          2000.00                1    2000.000000
1363            10267.0                Scottish Unionist Association Trust       Very Small Entity        218870.07                3   72956.690000

[1364 rows x 6 columns]
2025/03/04 03:12 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 03:12 DEBUG:app_pages_dir: app_pages
2025/03/04 03:12 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 03:12 DEBUG:data_donor:          DonorId                          Donor Name  Donations Value  Donation Events  Donation Mean
0            1.0    Joseph Rowntree Refrom Trust Ltd         53000.00                2   26500.000000
1            2.0    Birkenhead North End Labour Club        118680.84                2   59340.420000
2            3.0                Bord Institute Trust         26625.00                3    8875.000000
3            4.0        Branksome Liberal Club Trust         74495.89               14    5321.135000
4            5.0                    Bridgwater Trust          7700.00                3    2566.666667
...          ...                                 ...              ...              ...            ...
25571    87478.0                       Martin Thomas          3529.41                2    1764.705000
25572    87479.0                    Ishbel A Mcneill         11520.00                1   11520.000000
25573    87480.0                           Ann C Hay        157350.07                1  157350.070000
25574    87482.0  Glasgow Unionist Association Trust         50000.00                1   50000.000000
25575  1000001.0                  Unidentified Donor        697021.67               84    8297.877024

[25576 rows x 5 columns]
2025/03/04 03:12 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 03:12 DEBUG:components_dir: components
2025/03/04 03:12 INFO:Session state Setup complete
2025/03/04 03:12 INFO:initialize_session_state executed successfully
2025/03/04 03:12 INFO:Package setup complete
2025/03/04 03:12 INFO:setup_package executed successfully
2025/03/04 03:12 INFO:Setup completed successfully.
2025/03/04 03:12 INFO:Running Menu setup...
2025/03/04 03:12 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 03:12 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:12 INFO:get_git_version executed successfully
2025/03/04 03:12 INFO:App Version: v20.164
2025/03/04 03:12 INFO:Switched to page: Head Line Figures
2025/03/04 03:12 DEBUG:Calling hlf_body with args={args}, kwargs={kwargs}
2025/03/04 03:12 DEBUG:Calling load_and_filter_data with args={args}, kwargs={kwargs}
2025/03/04 03:12 INFO:load_and_filter_data executed successfully
2025/03/04 03:12 DEBUG:Calling display_summary_statistics with args={args}, kwargs={kwargs}
2025/03/04 03:12 INFO:display_summary_statistics executed successfully
2025/03/04 03:12 DEBUG:Calling plot_bar_line_by_year with args={args}, kwargs={kwargs}
2025/03/04 03:12 INFO:plot_bar_line_by_year executed successfully
2025/03/04 03:12 DEBUG:Calling plot_bar_line_by_year with args={args}, kwargs={kwargs}
2025/03/04 03:12 INFO:plot_bar_line_by_year executed successfully
2025/03/04 03:12 DEBUG:Calling plot_bar_line_by_year with args={args}, kwargs={kwargs}
2025/03/04 03:12 INFO:plot_bar_line_by_year executed successfully
2025/03/04 03:12 DEBUG:Calling plot_bar_line_by_year with args={args}, kwargs={kwargs}
2025/03/04 03:12 INFO:plot_bar_line_by_year executed successfully
2025/03/04 03:12 INFO:hlf_body executed successfully
2025/03/04 03:12 INFO:pagesetup executed successfully
2025/03/04 03:12 INFO:Menu setup completed successfully.
2025/03/04 03:12 INFO:Data already loaded in session state.
2025/03/04 03:12 INFO:App is fully loaded and ready!
2025/03/04 03:19 INFO:Logging is set up correctly! Current log level: DEBUG
2025/03/04 03:19 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:get_git_version executed successfully
2025/03/04 03:19 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:get_git_version executed successfully
2025/03/04 03:19 INFO:Streamlit App Starting...
2025/03/04 03:19 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 03:19 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 03:19 INFO:Running App setup...
2025/03/04 03:19 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Setting up the package
2025/03/04 03:19 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 03:19 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:get_git_version executed successfully
2025/03/04 03:19 INFO:Version: v20.143
2025/03/04 03:19 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:19 DEBUG:Initialised LOG_LEVEL with value: ERROR
2025/03/04 03:19 DEBUG:Initialised BASE_DIR with value: H:\VScode\dashboard_demo-1
2025/03/04 03:19 DEBUG:Initialised filenames with value: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:19 DEBUG:Initialised PLACEHOLDER_DATE with value: 1900-01-01 00:00:00
2025/03/04 03:19 DEBUG:Initialised PLACEHOLDER_ID with value: 1000001
2025/03/04 03:19 DEBUG:Initialised thresholds with value: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:19 DEBUG:Initialised data_remappings with value: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:19 DEBUG:Initialised filter_def with value: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:19 DEBUG:Initialised security with value: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:19 DEBUG:Initialised perc_target with value: 0.5
2025/03/04 03:19 DEBUG:Initialised RERUN_MP_PARTY_MEMBERSHIP with value: False
2025/03/04 03:19 DEBUG:Initialised directories with value: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:19 DEBUG:Initialised reference_dir with value: reference_files
2025/03/04 03:19 DEBUG:Initialised data_dir with value: data
2025/03/04 03:19 DEBUG:Initialised output_dir with value: output
2025/03/04 03:19 DEBUG:Initialised logs_dir with value: logs
2025/03/04 03:19 DEBUG:Initialised components_dir with value: components
2025/03/04 03:19 DEBUG:Initialised app_pages_dir with value: app_pages
2025/03/04 03:19 DEBUG:Initialised utils_dir with value: utils
2025/03/04 03:19 DEBUG:Initialised Donor_dedupe_cleaned_fname with value: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:19 DEBUG:Initialised ListofPoliticalPeople_fname with value: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:19 DEBUG:Initialised mppartymemb_fname with value: reference_files\mppartymemb_pypd.csv
2025/03/04 03:19 DEBUG:Initialised donor_map_fname with value: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:19 DEBUG:Initialised politician_party_fname with value: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:19 DEBUG:Initialised regentity_map_fname with value: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:19 DEBUG:Initialised original_data_fname with value: reference_files\original_data.csv
2025/03/04 03:19 DEBUG:Initialised CREDENTIALS_FILE with value: reference_files\admin_credentials.json
2025/03/04 03:19 DEBUG:Initialised TEXT_FILE with value: reference_files\admin_text.json
2025/03/04 03:19 DEBUG:Initialised ELECTION_DATES with value: reference_files\elections.csv
2025/03/04 03:19 DEBUG:Initialised cleaned_data_fname with value: output\cleaned_data.csv
2025/03/04 03:19 DEBUG:Initialised cleaned_donations_fname with value: output\cleaned_donations.csv
2025/03/04 03:19 DEBUG:Initialised cleaned_donorlist_fname with value: output\cleaned_donorlist.csv
2025/03/04 03:19 DEBUG:Initialised cleaned_regentity_fname with value: output\cleaned_regentity.csv
2025/03/04 03:19 DEBUG:Initialised party_summary_fname with value: output\party_summary.csv
2025/03/04 03:19 DEBUG:Initialised imported_raw_fname with value: output\imported_raw.csv
2025/03/04 03:19 DEBUG:Initialised source_data_fname with value: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:19 DEBUG:Initialised Cash_ftr with value: {'DonationType': 'Cash'}
2025/03/04 03:19 INFO:Session_state variables initialized
2025/03/04 03:19 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 03:19 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 03:19 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 03:19 DEBUG:perc_target: 0.5
2025/03/04 03:19 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:19 DEBUG:utils_dir: utils
2025/03/04 03:19 DEBUG:reference_dir: reference_files
2025/03/04 03:19 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:19 DEBUG:LOG_LEVEL: ERROR
2025/03/04 03:19 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 03:19 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 03:19 DEBUG:components_dir: components
2025/03/04 03:19 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 03:19 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 03:19 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 03:19 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:19 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:19 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:19 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:19 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 03:19 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 03:19 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 03:19 DEBUG:app_pages_dir: app_pages
2025/03/04 03:19 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:19 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 03:19 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:19 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:19 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 03:19 DEBUG:data_dir: data
2025/03/04 03:19 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 03:19 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:19 DEBUG:logs_dir: logs
2025/03/04 03:19 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:19 DEBUG:output_dir: output
2025/03/04 03:19 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:19 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:19 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:19 INFO:Session state Setup complete
2025/03/04 03:19 INFO:initialize_session_state executed successfully
2025/03/04 03:19 INFO:Package setup complete
2025/03/04 03:19 INFO:setup_package executed successfully
2025/03/04 03:19 INFO:Setup completed successfully.
2025/03/04 03:19 INFO:Running Menu setup...
2025/03/04 03:19 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:get_git_version executed successfully
2025/03/04 03:19 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:get_git_version executed successfully
2025/03/04 03:19 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:get_git_version executed successfully
2025/03/04 03:19 INFO:App Version: v20.164
2025/03/04 03:19 INFO:Switched to page: Introduction
2025/03/04 03:19 INFO:pagesetup executed successfully
2025/03/04 03:19 INFO:Menu setup completed successfully.
2025/03/04 03:19 INFO:No data found in session state, running firstload()
2025/03/04 03:19 DEBUG:Calling initialise_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Running first load function.
2025/03/04 03:19 DEBUG:Calling firstload with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling get_raw_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling load_raw_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Original data file path pre raw data load: {originaldatafilepath}
2025/03/04 03:19 DEBUG:Processed data file path pre raw data load: {processeddatafilepath}
2025/03/04 03:19 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:19 INFO:Saved file path: output\imported_raw.csv
2025/03/04 03:19 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 03:19 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 03:19 INFO:get_file_modification_time executed successfully
2025/03/04 03:19 INFO:Current modification time: 1740757862.6744745
2025/03/04 03:19 INFO:Last modification time: None
2025/03/04 03:19 INFO:is_file_updated executed successfully
2025/03/04 03:19 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:19 INFO:Loading raw data...
2025/03/04 03:19 DEBUG:Original data file path post raw data load: {originaldatafilepath}
2025/03/04 03:19 DEBUG:Processed data file path post raw data load: {processeddatafilepath}
2025/03/04 03:19 INFO:Data loaded successfully. Data has 65278 rows and 29 columns
2025/03/04 03:19 INFO:Data saved to output\imported_raw.csv
2025/03/04 03:19 DEBUG:Calling raw_data_cleanup with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Cleaning up raw data
2025/03/04 03:19 ERROR:Session state variables not initialized!
2025/03/04 03:19 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Original file path: None
2025/03/04 03:19 INFO:Saved file path: output\cleaned_donations.csv
2025/03/04 03:19 ERROR:Error: originalfilepath is None!
2025/03/04 03:19 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:19 INFO:Data loaded, shape: (65278, 29)
2025/03/04 03:19 DEBUG:Calling dedupe_entity_file with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Map file regentity_map_fname exists. Proceeding with deduplication.
2025/03/04 03:19 INFO:File deduplication complete, shape: ECRef                            547
OriginalRegulatedEntityName      547
RegulatedEntityType              547
Value                            547
AcceptedDate                     534
AccountingUnitName               547
DonorName                        547
AccountingUnitsAsCentralParty    547
IsSponsorship                    547
DonorStatus                      547
RegulatedDoneeType               547
CompanyRegistrationNumber        547
Postcode                         547
DonationType                     547
NatureOfDonation                 547
PurposeOfVisit                   547
DonationAction                   547
ReceivedDate                     449
ReportedDate                     547
IsReportedPrePoll                423
ReportingPeriodName              547
IsBequest                        547
IsAggregation                    547
OriginalRegulatedEntityId        547
AccountingUnitId                 547
DonorId                          547
CampaigningName                  547
RegisterName                     547
IsIrishSource                    547
CleanedRegulatedEntityName       547
CleanedRegulatedEntityId         547
RegulatedEntityId                547
RegulatedEntityName              547
dtype: int64 records updated with new RegulatedEntityId and ECRef                            7616
OriginalRegulatedEntityName      7616
RegulatedEntityType              7616
Value                            7616
AcceptedDate                     7406
AccountingUnitName               7616
DonorName                        7616
AccountingUnitsAsCentralParty    7616
IsSponsorship                    7616
DonorStatus                      7616
RegulatedDoneeType               7616
CompanyRegistrationNumber        7616
Postcode                         7616
DonationType                     7616
NatureOfDonation                 7616
PurposeOfVisit                   7616
DonationAction                   7616
ReceivedDate                     5073
ReportedDate                     7606
IsReportedPrePoll                4864
ReportingPeriodName              7616
IsBequest                        7616
IsAggregation                    7616
OriginalRegulatedEntityId        7616
AccountingUnitId                 7616
DonorId                          7616
CampaigningName                  7616
RegisterName                     7616
IsIrishSource                    7616
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                7616
RegulatedEntityName              7616
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 03:19 DEBUG:File deduplication cleaned complete, shape: ECRef                            1261
OriginalRegulatedEntityName      1261
RegulatedEntityType              1261
Value                            1261
AcceptedDate                     1247
AccountingUnitName               1261
DonorName                        1261
AccountingUnitsAsCentralParty    1261
IsSponsorship                    1261
DonorStatus                      1261
RegulatedDoneeType               1261
CompanyRegistrationNumber        1261
Postcode                         1261
DonationType                     1261
NatureOfDonation                 1261
PurposeOfVisit                   1261
DonationAction                   1261
ReceivedDate                     1133
ReportedDate                     1261
IsReportedPrePoll                 449
ReportingPeriodName              1261
IsBequest                        1261
IsAggregation                    1261
OriginalRegulatedEntityId        1261
AccountingUnitId                 1261
DonorId                          1261
CampaigningName                  1261
RegisterName                     1261
IsIrishSource                    1261
CleanedRegulatedEntityName        547
CleanedRegulatedEntityId          547
RegulatedEntityId                1261
RegulatedEntityName              1261
dtype: int64 records updated with new RegulatedEntityId and ECRef                            8330
OriginalRegulatedEntityName      8330
RegulatedEntityType              8330
Value                            8330
AcceptedDate                     8119
AccountingUnitName               8330
DonorName                        8330
AccountingUnitsAsCentralParty    8330
IsSponsorship                    8330
DonorStatus                      8330
RegulatedDoneeType               8330
CompanyRegistrationNumber        8330
Postcode                         8330
DonationType                     8330
NatureOfDonation                 8330
PurposeOfVisit                   8330
DonationAction                   8330
ReceivedDate                     5757
ReportedDate                     8320
IsReportedPrePoll                4890
ReportingPeriodName              8330
IsBequest                        8330
IsAggregation                    8330
OriginalRegulatedEntityId        8330
AccountingUnitId                 8330
DonorId                          8330
CampaigningName                  8330
RegisterName                     8330
IsIrishSource                    8330
CleanedRegulatedEntityName       7616
CleanedRegulatedEntityId         7616
RegulatedEntityId                8330
RegulatedEntityName              8330
dtype: int64 records updated with new RegulatedEntityName
2025/03/04 03:19 INFO:File deduplication complete, shape: (65278, 33)
2025/03/04 03:19 INFO:dedupe_entity_file executed successfully
2025/03/04 03:19 DEBUG:Calling dedupe_entity_file with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Map file donor_map_fname exists. Proceeding with deduplication.
2025/03/04 03:19 INFO:File deduplication complete, shape: ECRef                            29515
OriginalRegulatedEntityName      29515
RegulatedEntityType              29515
Value                            29515
AcceptedDate                     29204
AccountingUnitName               29515
OriginalDonorName                29515
AccountingUnitsAsCentralParty    29515
IsSponsorship                    29515
DonorStatus                      29515
RegulatedDoneeType               29515
CompanyRegistrationNumber        29515
Postcode                         29515
DonationType                     29515
NatureOfDonation                 29515
PurposeOfVisit                   29515
DonationAction                   29515
ReceivedDate                     27966
ReportedDate                     29504
IsReportedPrePoll                22707
ReportingPeriodName              29515
IsBequest                        29515
IsAggregation                    29515
OriginalRegulatedEntityId        29515
AccountingUnitId                 29515
OriginalDonorId                  29515
CampaigningName                  29515
RegisterName                     29515
IsIrishSource                    29515
CleanedRegulatedEntityName       29515
CleanedRegulatedEntityId         29515
RegulatedEntityId                29515
RegulatedEntityName              29515
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          29515
DonorName                        29515
dtype: int64 records updated with new DonorId and ECRef                            15656
OriginalRegulatedEntityName      15656
RegulatedEntityType              15656
Value                            15656
AcceptedDate                     15406
AccountingUnitName               15656
OriginalDonorName                15656
AccountingUnitsAsCentralParty    15656
IsSponsorship                    15656
DonorStatus                      15656
RegulatedDoneeType               15656
CompanyRegistrationNumber        15656
Postcode                         15656
DonationType                     15656
NatureOfDonation                 15656
PurposeOfVisit                   15656
DonationAction                   15656
ReceivedDate                     15143
ReportedDate                     15647
IsReportedPrePoll                13076
ReportingPeriodName              15656
IsBequest                        15656
IsAggregation                    15656
OriginalRegulatedEntityId        15656
AccountingUnitId                 15656
OriginalDonorId                  15656
CampaigningName                  15656
RegisterName                     15656
IsIrishSource                    15656
CleanedRegulatedEntityName       15656
CleanedRegulatedEntityId         15656
RegulatedEntityId                15656
RegulatedEntityName              15656
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          15656
DonorName                        15656
dtype: int64 records updated with new DonorName
2025/03/04 03:19 DEBUG:File deduplication cleaned complete, shape: ECRef                            31517
OriginalRegulatedEntityName      31517
RegulatedEntityType              31517
Value                            31517
AcceptedDate                     31206
AccountingUnitName               31517
OriginalDonorName                31517
AccountingUnitsAsCentralParty    31517
IsSponsorship                    31517
DonorStatus                      31517
RegulatedDoneeType               31517
CompanyRegistrationNumber        31517
Postcode                         31517
DonationType                     31517
NatureOfDonation                 31517
PurposeOfVisit                   31517
DonationAction                   31517
ReceivedDate                     29939
ReportedDate                     31506
IsReportedPrePoll                23658
ReportingPeriodName              31517
IsBequest                        31517
IsAggregation                    31517
OriginalRegulatedEntityId        31517
AccountingUnitId                 31517
OriginalDonorId                  31517
CampaigningName                  31517
RegisterName                     31517
IsIrishSource                    31517
CleanedRegulatedEntityName       30804
CleanedRegulatedEntityId         30804
RegulatedEntityId                31517
RegulatedEntityName              31517
CleanedDonorName                 29515
CleanedDonorId                   29515
DonorId                          31517
DonorName                        31517
dtype: int64 records updated with new DonorId and ECRef                            17658
OriginalRegulatedEntityName      17658
RegulatedEntityType              17658
Value                            17658
AcceptedDate                     17408
AccountingUnitName               17658
OriginalDonorName                17658
AccountingUnitsAsCentralParty    17658
IsSponsorship                    17658
DonorStatus                      17658
RegulatedDoneeType               17658
CompanyRegistrationNumber        17658
Postcode                         17658
DonationType                     17658
NatureOfDonation                 17658
PurposeOfVisit                   17658
DonationAction                   17658
ReceivedDate                     17116
ReportedDate                     17649
IsReportedPrePoll                14027
ReportingPeriodName              17658
IsBequest                        17658
IsAggregation                    17658
OriginalRegulatedEntityId        17658
AccountingUnitId                 17658
OriginalDonorId                  17658
CampaigningName                  17658
RegisterName                     17658
IsIrishSource                    17658
CleanedRegulatedEntityName       16945
CleanedRegulatedEntityId         16945
RegulatedEntityId                17658
RegulatedEntityName              17658
CleanedDonorName                 15656
CleanedDonorId                   15656
DonorId                          17658
DonorName                        17658
dtype: int64 records updated with new DonorName
2025/03/04 03:19 INFO:File deduplication complete, shape: (65278, 37)
2025/03/04 03:19 INFO:dedupe_entity_file executed successfully
2025/03/04 03:19 INFO:Raw Data cleanup completed
2025/03/04 03:19 INFO:Data shape: (65278, 37)
2025/03/04 03:19 INFO:Data saved to output\cleaned_donations.csv
2025/03/04 03:19 INFO:Data cleanup completed, shape: (65278, 37)
2025/03/04 03:19 INFO:raw_data_cleanup executed successfully
2025/03/04 03:19 INFO:load_raw_data executed successfully
2025/03/04 03:19 INFO:get_raw_data executed successfully
2025/03/04 03:19 INFO:load_data_to_session executed successfully
2025/03/04 03:19 DEBUG:st.session_state.raw_data: 65278
2025/03/04 03:19 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling get_cleaned_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling load_cleaned_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Rows in Raw Data: 65278
2025/03/04 03:19 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Original file path: output\cleaned_donations.csv
2025/03/04 03:19 INFO:Saved file path: output\cleaned_data.csv
2025/03/04 03:19 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Checking if output\cleaned_donations.csv has been updated.
2025/03/04 03:19 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Getting modification time for output\cleaned_donations.csv
2025/03/04 03:19 INFO:get_file_modification_time executed successfully
2025/03/04 03:19 INFO:Current modification time: 1741101571.8603563
2025/03/04 03:19 INFO:Last modification time: 1740757862.6744745
2025/03/04 03:19 INFO:is_file_updated executed successfully
2025/03/04 03:19 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:19 ERROR:Failed to load data from output\cleaned_donations.csv
2025/03/04 03:19 INFO:Loading and cleaning data... data.clean_and_enhance
2025/03/04 03:19 DEBUG:Clean Data Prep: streamlitdata load: 65278
2025/03/04 03:19 DEBUG:Clean Data Prep 123: streamlitdata load: 65278
2025/03/04 03:19 DEBUG:Calling map_mp_to_party with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Loaded politician_party_dict:    RegulatedEntityId  RegulatedEntityId     PartyName
0               6304               6304  Conservative
1               6423               6423  Conservative
2               1425               1425  Conservative
3               2061               2061  Conservative
4               6417               6417       Unknown
2025/03/04 03:19 DEBUG:PartyUpdate_dict keys: dict_keys(['Conservatives', 'Labour', 'Liberal Democrats', 'Scottish National Party', 'Green Party', 'Plaid Cymru', 'UKIP', 'Unknown'])
2025/03/04 03:19 DEBUG:Updated loaddata_df with PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 03:19 DEBUG:Loaded RegulatedEntityNameMatch:    PartyId                                          PartyName
0       17                                  English Democrats
1       19                         Legalise Cannabis Alliance
2       30        Upminster And Cranham Residents Association
3       44  Independent Kidderminster Hospital And Health ...
4       46                           Scottish Socialist Party
2025/03/04 03:19 DEBUG:loaddata_df after merging:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909      <NA>  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908      <NA>  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908      <NA>  8015.0

[5 rows x 43 columns]
2025/03/04 03:19 ERROR:Number of rows in loaddata_df and raw_data do not match 78745 != 65278
2025/03/04 03:19 ERROR:Attempting to remove duplicates
2025/03/04 03:19 DEBUG:loaddata_df after updating PartyName and PartyId:        ECRef OriginalRegulatedEntityName RegulatedEntityType    Value AcceptedDate AccountingUnitName  ... EventCount YearReceived MonthReceived YearMonthReceived    PartyName PartyId
0  NC0408174              Mr Andy Street     Regulated Donee  1876.56   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
1  NC0408173              Mr Andy Street     Regulated Donee  2700.00   02/09/2019                     ...          1         2019             9            201909  Andy Street  8015.0
2  NC0408177              Mr Andy Street     Regulated Donee  4852.58   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
3  NC0408176              Mr Andy Street     Regulated Donee  2500.00   30/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0
4  NC0408170              Mr Andy Street     Regulated Donee  4524.05   29/08/2019                     ...          1         2019             8            201908  Andy Street  8015.0

[5 rows x 43 columns]
2025/03/04 03:19 DEBUG:loaddata_df PartyName unique values: ['Andy Street' 'Conservative Group For Europe' 'Progress Ltd' ...
 'A Minority Pastime Limited' 'Cruelty Free International'
 'Society For The Protection Of Unborn Children']
2025/03/04 03:19 INFO:Data Updated with PartyName and PartyId successfully
2025/03/04 03:19 INFO:map_mp_to_party executed successfully
2025/03/04 03:19 DEBUG:Clean Data Prep 150: Map Mps: 65278
2025/03/04 03:19 DEBUG:Group assignment: group
RegulatedEntityName       53528
Small Medium Entity        4430
Small Entity               2251
Very Small Entity          1492
Medium Large Entity        1203
Large Entity               1194
Medium Entity               694
Single Donation Entity      486
Name: count, dtype: int64
2025/03/04 03:19 DEBUG:Group assignment: group
Very Small Entity         491
Single Donation Entity    486
Small Entity              241
Small Medium Entity       127
Medium Entity               5
RegulatedEntityName         5
Medium Large Entity         4
Large Entity                2
Name: count, dtype: int64
2025/03/04 03:19 DEBUG:Clean Data Prep 235: RegEntity_Map: 65278
2025/03/04 03:19 DEBUG:Calling load_election_dates with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:st.session_state.ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:19 DEBUG:try to load previous election dates from file.
2025/03/04 03:19 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Original file path: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:19 INFO:Saved file path: reference_files\elections.csv
2025/03/04 03:19 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Checking if source\Donations_accepted_by_political_parties.csv has been updated.
2025/03/04 03:19 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Getting modification time for source\Donations_accepted_by_political_parties.csv
2025/03/04 03:19 INFO:get_file_modification_time executed successfully
2025/03/04 03:19 INFO:Current modification time: 1740757862.6744745
2025/03/04 03:19 INFO:Last modification time: None
2025/03/04 03:19 INFO:is_file_updated executed successfully
2025/03/04 03:19 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:19 ERROR:Failed to load election dates from file.
2025/03/04 03:19 INFO:Election_dates_df empty - loading from pdpy.
2025/03/04 03:19 INFO:Election Dates loaded vis pdpy.
2025/03/04 03:19 DEBUG:ElectionDates_dict from pdpy: {'1929': {'dissolution': datetime.date(1929, 5, 10), 'election': datetime.date(1929, 5, 30), 'type': 'General Election'}, '1931': {'dissolution': datetime.date(1931, 10, 7), 'election': datetime.date(1931, 10, 27), 'type': 'General Election'}, '1935': {'dissolution': datetime.date(1935, 10, 25), 'election': datetime.date(1935, 11, 14), 'type': 'General Election'}, '1945': {'dissolution': datetime.date(1945, 6, 15), 'election': datetime.date(1945, 7, 5), 'type': 'General Election'}, '1950': {'dissolution': datetime.date(1950, 2, 3), 'election': datetime.date(1950, 2, 23), 'type': 'General Election'}, '1951': {'dissolution': datetime.date(1951, 10, 5), 'election': datetime.date(1951, 10, 25), 'type': 'General Election'}, '1955': {'dissolution': datetime.date(1955, 5, 6), 'election': datetime.date(1955, 5, 26), 'type': 'General Election'}, '1959': {'dissolution': datetime.date(1959, 9, 18), 'election': datetime.date(1959, 10, 8), 'type': 'General Election'}, '1964': {'dissolution': datetime.date(1964, 9, 25), 'election': datetime.date(1964, 10, 15), 'type': 'General Election'}, '1966': {'dissolution': datetime.date(1966, 3, 10), 'election': datetime.date(1966, 3, 31), 'type': 'General Election'}, '1970': {'dissolution': datetime.date(1970, 5, 29), 'election': datetime.date(1970, 6, 18), 'type': 'General Election'}, '1974 (Feb)': {'dissolution': datetime.date(1974, 2, 8), 'election': datetime.date(1974, 2, 28), 'type': 'General Election'}, '1974 (Oct)': {'dissolution': datetime.date(1974, 9, 20), 'election': datetime.date(1974, 10, 10), 'type': 'General Election'}, '1979': {'dissolution': datetime.date(1979, 4, 7), 'election': datetime.date(1979, 5, 3), 'type': 'General Election'}, '1983': {'dissolution': datetime.date(1983, 5, 13), 'election': datetime.date(1983, 6, 9), 'type': 'General Election'}, '1987': {'dissolution': datetime.date(1987, 5, 18), 'election': datetime.date(1987, 6, 11), 'type': 'General Election'}, '1992': {'dissolution': datetime.date(1992, 3, 16), 'election': datetime.date(1992, 4, 9), 'type': 'General Election'}, '1997': {'dissolution': datetime.date(1997, 4, 8), 'election': datetime.date(1997, 5, 1), 'type': 'General Election'}, '2001': {'dissolution': datetime.date(2001, 5, 14), 'election': datetime.date(2001, 6, 7), 'type': 'General Election'}, '2005': {'dissolution': datetime.date(2005, 4, 11), 'election': datetime.date(2005, 5, 5), 'type': 'General Election'}, '2010': {'dissolution': datetime.date(2010, 4, 12), 'election': datetime.date(2010, 5, 6), 'type': 'General Election'}, '2015': {'dissolution': datetime.date(2015, 3, 30), 'election': datetime.date(2015, 5, 7), 'type': 'General Election'}, '2017': {'dissolution': datetime.date(2017, 5, 3), 'election': datetime.date(2017, 6, 8), 'type': 'General Election'}, '2019': {'dissolution': datetime.date(2019, 11, 6), 'election': datetime.date(2019, 12, 12), 'type': 'General Election'}}
2025/03/04 03:19 INFO:Election Dates Loaded Successfully.
2025/03/04 03:19 DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 03:19 DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 03:19 INFO:load_election_dates executed successfully
2025/03/04 03:19 DEBUG:Clean Data Prep 353: Election dates: 65278
2025/03/04 03:19 DEBUG:Clean Data Prep 386: End of clean: 65278
2025/03/04 03:19 INFO:Cleaned Data completed, shape: (65278, 57)
2025/03/04 03:19 INFO:load_cleaned_data executed successfully
2025/03/04 03:19 INFO:get_cleaned_data executed successfully
2025/03/04 03:19 INFO:load_data_to_session executed successfully
2025/03/04 03:19 DEBUG:st.session_state.raw_data: 65278
2025/03/04 03:19 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling get_donor_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling load_donorList_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Original file path: output\cleaned_data.csv
2025/03/04 03:19 INFO:Saved file path: output\cleaned_donorlist.csv
2025/03/04 03:19 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 03:19 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 03:19 INFO:get_file_modification_time executed successfully
2025/03/04 03:19 INFO:Current modification time: 1741101576.1501572
2025/03/04 03:19 INFO:Last modification time: None
2025/03/04 03:19 INFO:is_file_updated executed successfully
2025/03/04 03:19 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:19 INFO:Donor data saved to output\cleaned_donorlist.csv
2025/03/04 03:19 INFO:Donor Data summary completed
2025/03/04 03:19 INFO:Data shape: (25576, 5)
2025/03/04 03:19 INFO:load_donorList_data executed successfully
2025/03/04 03:19 INFO:get_donor_data executed successfully
2025/03/04 03:19 INFO:load_data_to_session executed successfully
2025/03/04 03:19 DEBUG:st.session_state.data_donor: 25576
2025/03/04 03:19 DEBUG:st.session_state.data_clean: 65278
2025/03/04 03:19 DEBUG:Calling load_data_to_session with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling get_regentity_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling load_regulated_entity_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling try_to_use_preprocessed_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Original file path: output\cleaned_data.csv
2025/03/04 03:19 INFO:Saved file path: output\cleaned_regentity.csv
2025/03/04 03:19 DEBUG:Calling is_file_updated with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Checking if output\cleaned_data.csv has been updated.
2025/03/04 03:19 DEBUG:Calling get_file_modification_time with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Getting modification time for output\cleaned_data.csv
2025/03/04 03:19 INFO:get_file_modification_time executed successfully
2025/03/04 03:19 INFO:Current modification time: 1741101576.1501572
2025/03/04 03:19 INFO:Last modification time: 1741101576.1501572
2025/03/04 03:19 INFO:is_file_updated executed successfully
2025/03/04 03:19 INFO:Loading preprocessed data. Using output\cleaned_regentity.csv dated load_donorlist_data_last_modified instead of output\cleaned_data.csv
2025/03/04 03:19 INFO:try_to_use_preprocessed_data executed successfully
2025/03/04 03:19 INFO:load_regulated_entity_data executed successfully
2025/03/04 03:19 INFO:get_regentity_data executed successfully
2025/03/04 03:19 INFO:load_data_to_session executed successfully
2025/03/04 03:19 DEBUG:st.session_state.data_regentity: 1364
2025/03/04 03:19 DEBUG:st.session_state.data_donor: 25576
2025/03/04 03:19 DEBUG:st.session_state.data_clean: 65278
2025/03/04 03:19 INFO:firstload executed successfully
2025/03/04 03:19 INFO:Data first load completed successfully.
2025/03/04 03:19 INFO:initialise_data executed successfully
2025/03/04 03:19 INFO:App is fully loaded and ready!
2025/03/04 03:19 INFO:Streamlit App Starting...
2025/03/04 03:19 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 03:19 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 03:19 INFO:Running App setup...
2025/03/04 03:19 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Setting up the package
2025/03/04 03:19 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 03:19 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:get_git_version executed successfully
2025/03/04 03:19 INFO:Version: v20.143
2025/03/04 03:19 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:19 DEBUG:LOG_LEVEL already exists in session state
2025/03/04 03:19 DEBUG:BASE_DIR already exists in session state
2025/03/04 03:19 DEBUG:filenames already exists in session state
2025/03/04 03:19 DEBUG:PLACEHOLDER_DATE already exists in session state
2025/03/04 03:19 DEBUG:PLACEHOLDER_ID already exists in session state
2025/03/04 03:19 DEBUG:thresholds already exists in session state
2025/03/04 03:19 DEBUG:data_remappings already exists in session state
2025/03/04 03:19 DEBUG:filter_def already exists in session state
2025/03/04 03:19 DEBUG:security already exists in session state
2025/03/04 03:19 DEBUG:perc_target already exists in session state
2025/03/04 03:19 DEBUG:RERUN_MP_PARTY_MEMBERSHIP already exists in session state
2025/03/04 03:19 DEBUG:directories already exists in session state
2025/03/04 03:19 DEBUG:reference_dir already exists in session state
2025/03/04 03:19 DEBUG:data_dir already exists in session state
2025/03/04 03:19 DEBUG:output_dir already exists in session state
2025/03/04 03:19 DEBUG:logs_dir already exists in session state
2025/03/04 03:19 DEBUG:components_dir already exists in session state
2025/03/04 03:19 DEBUG:app_pages_dir already exists in session state
2025/03/04 03:19 DEBUG:utils_dir already exists in session state
2025/03/04 03:19 DEBUG:Donor_dedupe_cleaned_fname already exists in session state
2025/03/04 03:19 DEBUG:ListofPoliticalPeople_fname already exists in session state
2025/03/04 03:19 DEBUG:mppartymemb_fname already exists in session state
2025/03/04 03:19 DEBUG:donor_map_fname already exists in session state
2025/03/04 03:19 DEBUG:politician_party_fname already exists in session state
2025/03/04 03:19 DEBUG:regentity_map_fname already exists in session state
2025/03/04 03:19 DEBUG:original_data_fname already exists in session state
2025/03/04 03:19 DEBUG:CREDENTIALS_FILE already exists in session state
2025/03/04 03:19 DEBUG:TEXT_FILE already exists in session state
2025/03/04 03:19 DEBUG:ELECTION_DATES already exists in session state
2025/03/04 03:19 DEBUG:cleaned_data_fname already exists in session state
2025/03/04 03:19 DEBUG:cleaned_donations_fname already exists in session state
2025/03/04 03:19 DEBUG:cleaned_donorlist_fname already exists in session state
2025/03/04 03:19 DEBUG:cleaned_regentity_fname already exists in session state
2025/03/04 03:19 DEBUG:party_summary_fname already exists in session state
2025/03/04 03:19 DEBUG:imported_raw_fname already exists in session state
2025/03/04 03:19 DEBUG:source_data_fname already exists in session state
2025/03/04 03:19 DEBUG:Cash_ftr already exists in session state
2025/03/04 03:19 INFO:Session_state variables initialized
2025/03/04 03:19 DEBUG:election_dates_last_modified: 1740757862.6744745
2025/03/04 03:19 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 03:19 DEBUG:menu_selection: {'title': 'Notes on Data and Manipulations', 'function': <function notesondataprep_body at 0x000001972FA964D0>}
2025/03/04 03:19 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 03:19 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 03:19 DEBUG:perc_target: 0.5
2025/03/04 03:19 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:19 DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 03:19 DEBUG:utils_dir: utils
2025/03/04 03:19 DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 03:19 DEBUG:reference_dir: reference_files
2025/03/04 03:19 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:19 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 03:19 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 03:19 DEBUG:LOG_LEVEL: ERROR
2025/03/04 03:19 DEBUG:components_dir: components
2025/03/04 03:19 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 03:19 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 03:19 DEBUG:load_donorlist_data_last_modified: 1741101576.1501572
2025/03/04 03:19 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 03:19 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:19 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:19 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:19 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:19 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 03:19 DEBUG:load_raw_data_last_modified: 1741101571.8603563
2025/03/04 03:19 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 03:19 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 03:19 DEBUG:app_pages_dir: app_pages
2025/03/04 03:19 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:19 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 03:19 DEBUG:data_donor:          DonorId                          Donor Name  Donations Value  Donation Events  Donation Mean
0            1.0    Joseph Rowntree Refrom Trust Ltd         53000.00                2   26500.000000
1            2.0    Birkenhead North End Labour Club        118680.84                2   59340.420000
2            3.0                Bord Institute Trust         26625.00                3    8875.000000
3            4.0        Branksome Liberal Club Trust         74495.89               14    5321.135000
4            5.0                    Bridgwater Trust          7700.00                3    2566.666667
...          ...                                 ...              ...              ...            ...
25571    87478.0                       Martin Thomas          3529.41                2    1764.705000
25572    87479.0                    Ishbel A Mcneill         11520.00                1   11520.000000
25573    87480.0                           Ann C Hay        157350.07                1  157350.070000
25574    87482.0  Glasgow Unionist Association Trust         50000.00                1   50000.000000
25575  1000001.0                  Unidentified Donor        697021.67               84    8297.877024

[25576 rows x 5 columns]
2025/03/04 03:19 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:19 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:19 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 03:19 DEBUG:data_dir: data
2025/03/04 03:19 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 03:19 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:19 DEBUG:logs_dir: logs
2025/03/04 03:19 DEBUG:data_regentity:       RegulatedEntityId                              Regulated Entity Name  Regulated Entity Group  Donations Value  Donation Events  Donation Mean
0                  17.0                                  English Democrats            Small Entity         99000.00               11    9000.000000
1                  19.0                         Legalise Cannabis Alliance            Small Entity         35500.00               13    2730.769231
2                  30.0        Upminster And Cranham Residents Association  Single Donation Entity         10000.00                1   10000.000000
3                  39.0                                          Sinn FÃ©in     Medium Large Entity       2506699.11              359    6982.448774
4                  44.0  Independent Kidderminster Hospital And Health ...            Small Entity         31949.00                8    3993.625000
...                 ...                                                ...                     ...              ...              ...            ...
1359            10263.0                                    Jonathan Gullis  Single Donation Entity          2500.00                1    2500.000000
1360            10264.0                                      Robert Largan  Single Donation Entity          2000.00                1    2000.000000
1361            10265.0                                         Jane Dodds       Very Small Entity          3529.41                2    1764.705000
1362            10266.0                                        Phil Wilson  Single Donation Entity          2000.00                1    2000.000000
1363            10267.0                Scottish Unionist Association Trust       Very Small Entity        218870.07                3   72956.690000

[1364 rows x 6 columns]
2025/03/04 03:19 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:19 DEBUG:raw_data_clean:            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns]
2025/03/04 03:19 DEBUG:output_dir: output
2025/03/04 03:19 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:19 DEBUG:data_clean:            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... QtrsTillNextElection QtrsSinceLastElection YrsTillNextElection YrsSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                  2.0                 363.0                 1.0                 91.0
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                  2.0                 363.0                 1.0                 91.0
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                  2.0                 363.0                 1.0                 91.0
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                  2.0                 363.0                 1.0                 91.0
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                  2.0                 363.0                 1.0                 91.0
...          ...                              ...                    ...        ...  ...                  ...                   ...                 ...                  ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                  5.0                 349.0                 2.0                 87.0
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                  6.0                 348.0                 2.0                 87.0
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                  4.0                 350.0                 1.0                 88.0
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                  1.0                 354.0                 1.0                 89.0
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                  1.0                 354.0                 1.0                 89.0

[65278 rows x 57 columns]
2025/03/04 03:19 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:19 DEBUG:raw_data:            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...                 CleanedDonorName CleanedDonorId  DonorId                        DonorName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
...          ...                              ...                    ...        ...  ...                              ...            ...      ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...      Shaftesbury Investments Ltd        74198.0  74198.0      Shaftesbury Investments Ltd
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                Mr Jeremy Hosking        74184.0  74184.0                Mr Jeremy Hosking
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    Anthony Clake        23556.0  23556.0                    Anthony Clake
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                Mr Peter A Dubens         2146.0   2146.0                Mr Peter A Dubens
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                 Mr Ravi S Kailas        74743.0  74743.0                 Mr Ravi S Kailas

[65278 rows x 37 columns]
2025/03/04 03:19 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:19 INFO:Session state Setup complete
2025/03/04 03:19 INFO:initialize_session_state executed successfully
2025/03/04 03:19 INFO:Package setup complete
2025/03/04 03:19 INFO:setup_package executed successfully
2025/03/04 03:19 INFO:Setup completed successfully.
2025/03/04 03:19 INFO:Running Menu setup...
2025/03/04 03:19 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:get_git_version executed successfully
2025/03/04 03:19 INFO:App Version: v20.164
2025/03/04 03:19 INFO:Switched to page: Notes on Data and Manipulations
2025/03/04 03:19 INFO:pagesetup executed successfully
2025/03/04 03:19 INFO:Menu setup completed successfully.
2025/03/04 03:19 INFO:Data already loaded in session state.
2025/03/04 03:19 INFO:App is fully loaded and ready!
2025/03/04 03:19 INFO:Streamlit App Starting...
2025/03/04 03:19 INFO:Current Working Directory: H:\VScode\dashboard_demo-1
2025/03/04 03:19 INFO:running H:\VScode\dashboard_demo-1, H:\VScode\dashboard_demo-1\PoliticalPartyAnalysisDashboard.py
2025/03/04 03:19 INFO:Running App setup...
2025/03/04 03:19 DEBUG:Calling setup_package with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:Setting up the package
2025/03/04 03:19 INFO:Module directory: H:\VScode\dashboard_demo-1
2025/03/04 03:19 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:get_git_version executed successfully
2025/03/04 03:19 INFO:Version: v20.143
2025/03/04 03:19 DEBUG:Calling initialize_session_state with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:19 DEBUG:LOG_LEVEL already exists in session state
2025/03/04 03:19 DEBUG:BASE_DIR already exists in session state
2025/03/04 03:19 DEBUG:filenames already exists in session state
2025/03/04 03:19 DEBUG:PLACEHOLDER_DATE already exists in session state
2025/03/04 03:19 DEBUG:PLACEHOLDER_ID already exists in session state
2025/03/04 03:19 DEBUG:thresholds already exists in session state
2025/03/04 03:19 DEBUG:data_remappings already exists in session state
2025/03/04 03:19 DEBUG:filter_def already exists in session state
2025/03/04 03:19 DEBUG:security already exists in session state
2025/03/04 03:19 DEBUG:perc_target already exists in session state
2025/03/04 03:19 DEBUG:RERUN_MP_PARTY_MEMBERSHIP already exists in session state
2025/03/04 03:19 DEBUG:directories already exists in session state
2025/03/04 03:19 DEBUG:reference_dir already exists in session state
2025/03/04 03:19 DEBUG:data_dir already exists in session state
2025/03/04 03:19 DEBUG:output_dir already exists in session state
2025/03/04 03:19 DEBUG:logs_dir already exists in session state
2025/03/04 03:19 DEBUG:components_dir already exists in session state
2025/03/04 03:19 DEBUG:app_pages_dir already exists in session state
2025/03/04 03:19 DEBUG:utils_dir already exists in session state
2025/03/04 03:19 DEBUG:Donor_dedupe_cleaned_fname already exists in session state
2025/03/04 03:19 DEBUG:ListofPoliticalPeople_fname already exists in session state
2025/03/04 03:19 DEBUG:mppartymemb_fname already exists in session state
2025/03/04 03:19 DEBUG:donor_map_fname already exists in session state
2025/03/04 03:19 DEBUG:politician_party_fname already exists in session state
2025/03/04 03:19 DEBUG:regentity_map_fname already exists in session state
2025/03/04 03:19 DEBUG:original_data_fname already exists in session state
2025/03/04 03:19 DEBUG:CREDENTIALS_FILE already exists in session state
2025/03/04 03:19 DEBUG:TEXT_FILE already exists in session state
2025/03/04 03:19 DEBUG:ELECTION_DATES already exists in session state
2025/03/04 03:19 DEBUG:cleaned_data_fname already exists in session state
2025/03/04 03:19 DEBUG:cleaned_donations_fname already exists in session state
2025/03/04 03:19 DEBUG:cleaned_donorlist_fname already exists in session state
2025/03/04 03:19 DEBUG:cleaned_regentity_fname already exists in session state
2025/03/04 03:19 DEBUG:party_summary_fname already exists in session state
2025/03/04 03:19 DEBUG:imported_raw_fname already exists in session state
2025/03/04 03:19 DEBUG:source_data_fname already exists in session state
2025/03/04 03:19 DEBUG:Cash_ftr already exists in session state
2025/03/04 03:19 INFO:Session_state variables initialized
2025/03/04 03:19 DEBUG:election_dates_last_modified: 1740757862.6744745
2025/03/04 03:19 DEBUG:cleaned_data_fname: output\cleaned_data.csv
2025/03/04 03:19 DEBUG:menu_selection: {'title': 'Head Line Figures', 'function': <function hlf_body at 0x000001972FA96440>}
2025/03/04 03:19 DEBUG:PLACEHOLDER_ID: 1000001
2025/03/04 03:19 DEBUG:cleaned_regentity_fname: output\cleaned_regentity.csv
2025/03/04 03:19 DEBUG:perc_target: 0.5
2025/03/04 03:19 DEBUG:ELECTION_DATES: reference_files\elections.csv
2025/03/04 03:19 DEBUG:ElectionDatesDescend: [datetime.date(2019, 12, 12), datetime.date(2017, 6, 8), datetime.date(2015, 5, 7), datetime.date(2010, 5, 6), datetime.date(2005, 5, 5), datetime.date(2001, 6, 7), datetime.date(1997, 5, 1), datetime.date(1992, 4, 9), datetime.date(1987, 6, 11), datetime.date(1983, 6, 9), datetime.date(1979, 5, 3), datetime.date(1974, 10, 10), datetime.date(1974, 2, 28), datetime.date(1970, 6, 18), datetime.date(1966, 3, 31), datetime.date(1964, 10, 15), datetime.date(1959, 10, 8), datetime.date(1955, 5, 26), datetime.date(1951, 10, 25), datetime.date(1950, 2, 23), datetime.date(1945, 7, 5), datetime.date(1935, 11, 14), datetime.date(1931, 10, 27), datetime.date(1929, 5, 30)]
2025/03/04 03:19 DEBUG:utils_dir: utils
2025/03/04 03:19 DEBUG:ElectionDatesAscend: [datetime.date(1929, 5, 30), datetime.date(1931, 10, 27), datetime.date(1935, 11, 14), datetime.date(1945, 7, 5), datetime.date(1950, 2, 23), datetime.date(1951, 10, 25), datetime.date(1955, 5, 26), datetime.date(1959, 10, 8), datetime.date(1964, 10, 15), datetime.date(1966, 3, 31), datetime.date(1970, 6, 18), datetime.date(1974, 2, 28), datetime.date(1974, 10, 10), datetime.date(1979, 5, 3), datetime.date(1983, 6, 9), datetime.date(1987, 6, 11), datetime.date(1992, 4, 9), datetime.date(1997, 5, 1), datetime.date(2001, 6, 7), datetime.date(2005, 5, 5), datetime.date(2010, 5, 6), datetime.date(2015, 5, 7), datetime.date(2017, 6, 8), datetime.date(2019, 12, 12)]
2025/03/04 03:19 DEBUG:reference_dir: reference_files
2025/03/04 03:19 DEBUG:regentity_map_fname: reference_files\PoliticalEntityDeDuped.csv
2025/03/04 03:19 DEBUG:cleaned_donations_fname: output\cleaned_donations.csv
2025/03/04 03:19 DEBUG:cleaned_donorlist_fname: output\cleaned_donorlist.csv
2025/03/04 03:19 DEBUG:LOG_LEVEL: ERROR
2025/03/04 03:19 DEBUG:components_dir: components
2025/03/04 03:19 DEBUG:original_data_fname: reference_files\original_data.csv
2025/03/04 03:19 DEBUG:imported_raw_fname: output\imported_raw.csv
2025/03/04 03:19 DEBUG:load_donorlist_data_last_modified: 1741101576.1501572
2025/03/04 03:19 DEBUG:Cash_ftr: {'DonationType': 'Cash'}
2025/03/04 03:19 DEBUG:BASE_DIR: H:\VScode\dashboard_demo-1
2025/03/04 03:19 DEBUG:donor_map_fname: reference_files\PoliticalDonorsDeduped.csv
2025/03/04 03:19 DEBUG:Donor_dedupe_cleaned_fname: reference_files\Donor_dedupe_cleaned_data.csv
2025/03/04 03:19 DEBUG:filter_def: {'Sponsorships_ftr': {'NatureOfDonation': 'Sponsorship', 'IsSponsorshipInt': 1}, 'ReturnedDonations_ftr': {'DonationAction': ['Returned', 'Forfeited'], 'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonors_ftr': {'DubiousDonor': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'DubiousDonations_ftr': {'DubiousData': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]}, 'AggregatedDonations_ftr': {'IsAggregationInt': 1, 'NatureOfDonation': 'Aggregated Donation', 'DonationType': 'Aggregated Donation'}, 'SafeDonors_ftr': {'DonorType': ['Trade Union', 'Registered Political Party', 'Friendly Society', 'Public Fund']}, 'DubiousDonationType_ftr': {'NatureOfDonation': ['Impermissible Donor', 'Unidentified Donor', 'Total value of donations not reported individually', 'Aggregated Donation'], 'DonorStatus': ['Impermissible Donor', 'Unidentified Donor', 'Unidentifiable Donor']}, 'BlankDate_ftr': {'ReceivedDate': ['PLACEHOLDER_DATE', None]}, 'BlankDonor_ftr': {'DonorId': [1000001]}, 'BlankRegEntity_ftr': {'RegulatedEntityId': [1000001]}, 'DonatedVisits_ftr': {'DonationType': 'Visit', 'NatureOfDonation': 'Visit'}, 'Bequests_ftr': {'IsBequestInt': 1, 'NatureOfDonation': 'Bequest', 'DonationType': 'Bequest'}, 'CorporateDonations_ftr': {'DonorStatus': ['Company', 'Partnership', 'Limited Liability Partnership']}, 'RegulatedEntity_ftr': {'RegulatedEntityType': ['Political Party', 'Regulated Donee', 'Permitted Participant', 'Third Party']}, 'PoliticalParty_ftr': {'DonorStatus': 'Registered Political Party'}, 'Cash_ftr': {'DonationType': 'Cash'}, 'NonCash_ftr': {'DonationType': 'Non Cash'}}
2025/03/04 03:19 DEBUG:RERUN_MP_PARTY_MEMBERSHIP: False
2025/03/04 03:19 DEBUG:load_raw_data_last_modified: 1741101571.8603563
2025/03/04 03:19 DEBUG:mppartymemb_fname: reference_files\mppartymemb_pypd.csv
2025/03/04 03:19 DEBUG:TEXT_FILE: reference_files\admin_text.json
2025/03/04 03:19 DEBUG:app_pages_dir: app_pages
2025/03/04 03:19 DEBUG:security: {'is_admin': False, 'is_authenticated': False, 'username': '', 'password': ''}
2025/03/04 03:19 DEBUG:CREDENTIALS_FILE: reference_files\admin_credentials.json
2025/03/04 03:19 DEBUG:data_donor:          DonorId                          Donor Name  Donations Value  Donation Events  Donation Mean
0            1.0    Joseph Rowntree Refrom Trust Ltd         53000.00                2   26500.000000
1            2.0    Birkenhead North End Labour Club        118680.84                2   59340.420000
2            3.0                Bord Institute Trust         26625.00                3    8875.000000
3            4.0        Branksome Liberal Club Trust         74495.89               14    5321.135000
4            5.0                    Bridgwater Trust          7700.00                3    2566.666667
...          ...                                 ...              ...              ...            ...
25571    87478.0                       Martin Thomas          3529.41                2    1764.705000
25572    87479.0                    Ishbel A Mcneill         11520.00                1   11520.000000
25573    87480.0                           Ann C Hay        157350.07                1  157350.070000
25574    87482.0  Glasgow Unionist Association Trust         50000.00                1   50000.000000
25575  1000001.0                  Unidentified Donor        697021.67               84    8297.877024

[25576 rows x 5 columns]
2025/03/04 03:19 DEBUG:directories: {'BASE_DIR': WindowsPath('H:/VScode/dashboard_demo-1'), 'data_dir': 'data', 'output_dir': 'output', 'logs_dir': 'logs', 'reference_dir': 'reference_files', 'components_dir': 'components', 'app_pages_dir': 'app_pages', 'utils_dir': 'utils', 'source_dir': 'source', 'tests_dir': 'tests'}
2025/03/04 03:19 DEBUG:filenames: {'reference_dir': {'Donor_dedupe_cleaned_fname': 'Donor_dedupe_cleaned_data.csv', 'ListofPoliticalPeople_fname': 'ListOfPoliticalPeople.csv', 'mppartymemb_fname': 'mppartymemb_pypd.csv', 'donor_map_fname': 'PoliticalDonorsDeduped.csv', 'politician_party_fname': 'ListOfPoliticalPeople_Final.csv', 'regentity_map_fname': 'PoliticalEntityDeDuped.csv', 'original_data_fname': 'original_data.csv', 'CREDENTIALS_FILE': 'admin_credentials.json', 'TEXT_FILE': 'admin_text.json', 'ELECTION_DATES': 'elections.csv'}, 'output_dir': {'cleaned_data_fname': 'cleaned_data.csv', 'cleaned_donations_fname': 'cleaned_donations.csv', 'cleaned_donorlist_fname': 'cleaned_donorlist.csv', 'cleaned_regentity_fname': 'cleaned_regentity.csv', 'party_summary_fname': 'party_summary.csv', 'imported_raw_fname': 'imported_raw.csv'}, 'source_dir': {'source_data_fname': 'Donations_accepted_by_political_parties.csv'}}
2025/03/04 03:19 DEBUG:PLACEHOLDER_DATE: 1900-01-01 00:00:00
2025/03/04 03:19 DEBUG:data_dir: data
2025/03/04 03:19 DEBUG:party_summary_fname: output\party_summary.csv
2025/03/04 03:19 DEBUG:source_data_fname: source\Donations_accepted_by_political_parties.csv
2025/03/04 03:19 DEBUG:logs_dir: logs
2025/03/04 03:19 DEBUG:data_regentity:       RegulatedEntityId                              Regulated Entity Name  Regulated Entity Group  Donations Value  Donation Events  Donation Mean
0                  17.0                                  English Democrats            Small Entity         99000.00               11    9000.000000
1                  19.0                         Legalise Cannabis Alliance            Small Entity         35500.00               13    2730.769231
2                  30.0        Upminster And Cranham Residents Association  Single Donation Entity         10000.00                1   10000.000000
3                  39.0                                          Sinn FÃ©in     Medium Large Entity       2506699.11              359    6982.448774
4                  44.0  Independent Kidderminster Hospital And Health ...            Small Entity         31949.00                8    3993.625000
...                 ...                                                ...                     ...              ...              ...            ...
1359            10263.0                                    Jonathan Gullis  Single Donation Entity          2500.00                1    2500.000000
1360            10264.0                                      Robert Largan  Single Donation Entity          2000.00                1    2000.000000
1361            10265.0                                         Jane Dodds       Very Small Entity          3529.41                2    1764.705000
1362            10266.0                                        Phil Wilson  Single Donation Entity          2000.00                1    2000.000000
1363            10267.0                Scottish Unionist Association Trust       Very Small Entity        218870.07                3   72956.690000

[1364 rows x 6 columns]
2025/03/04 03:19 DEBUG:thresholds: {(0, 0): 'No Relevant Donations', (1, 1): 'Single Donation Entity', (2, 5): 'Very Small Entity', (6, 15): 'Small Entity', (16, 100): 'Small Medium Entity', (101, 200): 'Medium Entity', (201, 500): 'Medium Large Entity', (501, 1000): 'Large Entity'}
2025/03/04 03:19 DEBUG:raw_data_clean:            ECRef              RegulatedEntityName    RegulatedEntityType      Value AcceptedDate AccountingUnitName  ... RegulatedEntityId AccountingUnitId  DonorId CampaigningName   RegisterName IsIrishSource
index                                                                                                                ...                                                                                         
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00   02/09/2019                     ...              8015                   86310.0                  Great Britain         False
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00   30/08/2019                     ...              8015                   86310.0                  Great Britain         False
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05   29/08/2019                     ...              8015                   86310.0                  Great Britain         False
...          ...                              ...                    ...        ...          ...                ...  ...               ...              ...      ...             ...            ...           ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00          NaN                     ...              3945                   74198.0                          Other         False
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00          NaN                     ...              3945                   74184.0                          Other         False
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00          NaN                     ...              3945                   74576.0                          Other         False
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00          NaN      Central Party  ...                52                   34241.0                  Great Britain         False
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00          NaN      Central Party  ...                52                   74743.0                  Great Britain         False

[65278 rows x 29 columns]
2025/03/04 03:19 DEBUG:output_dir: output
2025/03/04 03:19 DEBUG:ListofPoliticalPeople_fname: reference_files\ListOfPoliticalPeople.csv
2025/03/04 03:19 DEBUG:data_clean:            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ... QtrsTillNextElection QtrsSinceLastElection YrsTillNextElection YrsSinceLastElection
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...                  2.0                 363.0                 1.0                 91.0
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...                  2.0                 363.0                 1.0                 91.0
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...                  2.0                 363.0                 1.0                 91.0
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...                  2.0                 363.0                 1.0                 91.0
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...                  2.0                 363.0                 1.0                 91.0
...          ...                              ...                    ...        ...  ...                  ...                   ...                 ...                  ...
78740   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...                  5.0                 349.0                 2.0                 87.0
78741   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                  6.0                 348.0                 2.0                 87.0
78742   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                  4.0                 350.0                 1.0                 88.0
78743   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                  1.0                 354.0                 1.0                 89.0
78744   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                  1.0                 354.0                 1.0                 89.0

[65278 rows x 57 columns]
2025/03/04 03:19 DEBUG:politician_party_fname: reference_files\ListOfPoliticalPeople_Final.csv
2025/03/04 03:19 DEBUG:raw_data:            ECRef      OriginalRegulatedEntityName    RegulatedEntityType      Value  ...                 CleanedDonorName CleanedDonorId  DonorId                        DonorName
0      NC0408174                   Mr Andy Street        Regulated Donee    1876.56  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
1      NC0408173                   Mr Andy Street        Regulated Donee    2700.00  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
2      NC0408177                   Mr Andy Street        Regulated Donee    4852.58  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
3      NC0408176                   Mr Andy Street        Regulated Donee    2500.00  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
4      NC0408170                   Mr Andy Street        Regulated Donee    4524.05  ...  Conservative And Unionist Party        86310.0  86310.0  Conservative And Unionist Party
...          ...                              ...                    ...        ...  ...                              ...            ...      ...                              ...
65273   C0242478               Vote Leave Limited  Permitted Participant   10000.00  ...      Shaftesbury Investments Ltd        74198.0  74198.0      Shaftesbury Investments Ltd
65274   C0242461               Vote Leave Limited  Permitted Participant  100000.00  ...                Mr Jeremy Hosking        74184.0  74184.0                Mr Jeremy Hosking
65275   C0243560               Vote Leave Limited  Permitted Participant   40000.00  ...                    Anthony Clake        23556.0  23556.0                    Anthony Clake
65276   C0319710  Conservative And Unionist Party        Political Party   50000.00  ...                Mr Peter A Dubens         2146.0   2146.0                Mr Peter A Dubens
65277   C0319727  Conservative And Unionist Party        Political Party   15000.00  ...                 Mr Ravi S Kailas        74743.0  74743.0                 Mr Ravi S Kailas

[65278 rows x 37 columns]
2025/03/04 03:19 DEBUG:data_remappings: {'NatureOfDonation': {'IsBequest': 'Is A Bequest', 'IsAggregation': 'Aggregated Donation', 'IsSponsorship': 'Sponsorship', 'Donation to nan': 'Other', 'Other Payment': 'Other'}, 'PartyParents': {'Conservatives': 52, 'Labour': 53, 'Liberal Democrats': 90, 'Scottish National Party': 102, 'Green Party': 63, 'Plaid Cymru': 77, 'UKIP': 85, 'Unknown': 0}}
2025/03/04 03:19 INFO:Session state Setup complete
2025/03/04 03:19 INFO:initialize_session_state executed successfully
2025/03/04 03:19 INFO:Package setup complete
2025/03/04 03:19 INFO:setup_package executed successfully
2025/03/04 03:19 INFO:Setup completed successfully.
2025/03/04 03:19 INFO:Running Menu setup...
2025/03/04 03:19 DEBUG:Calling pagesetup with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling get_git_version with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:get_git_version executed successfully
2025/03/04 03:19 INFO:App Version: v20.164
2025/03/04 03:19 INFO:Switched to page: Head Line Figures
2025/03/04 03:19 DEBUG:Calling hlf_body with args={args}, kwargs={kwargs}
2025/03/04 03:19 DEBUG:Calling load_and_filter_data with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:load_and_filter_data executed successfully
2025/03/04 03:19 DEBUG:Calling display_summary_statistics with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:display_summary_statistics executed successfully
2025/03/04 03:19 DEBUG:Calling plot_bar_line_by_year with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:plot_bar_line_by_year executed successfully
2025/03/04 03:19 DEBUG:Calling plot_bar_line_by_year with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:plot_bar_line_by_year executed successfully
2025/03/04 03:19 DEBUG:Calling plot_bar_line_by_year with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:plot_bar_line_by_year executed successfully
2025/03/04 03:19 DEBUG:Calling plot_bar_line_by_year with args={args}, kwargs={kwargs}
2025/03/04 03:19 INFO:plot_bar_line_by_year executed successfully
2025/03/04 03:19 INFO:hlf_body executed successfully
2025/03/04 03:19 INFO:pagesetup executed successfully
2025/03/04 03:19 INFO:Menu setup completed successfully.
2025/03/04 03:19 INFO:Data already loaded in session state.
2025/03/04 03:19 INFO:App is fully loaded and ready!
